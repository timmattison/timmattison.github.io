<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Tim Mattison]]></title>
  <link href="http://blog.timmattison.com/atom.xml" rel="self"/>
  <link href="http://blog.timmattison.com/"/>
  <updated>2014-06-18T09:55:34-04:00</updated>
  <id>http://blog.timmattison.com/</id>
  <author>
    <name><![CDATA[Tim Mattison]]></name>
    <email><![CDATA[tim (at) mattison (dot) org]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Use Git to Figure Out What You Did Yesterday]]></title>
    <link href="http://blog.timmattison.com/archives/2014/06/18/use-git-to-figure-out-what-you-did-yesterday/"/>
    <updated>2014-06-18T09:10:21-04:00</updated>
    <id>http://blog.timmattison.com/archives/2014/06/18/use-git-to-figure-out-what-you-did-yesterday</id>
    <content type="html"><![CDATA[<p>Are you a developer?  Do you have trouble remembering what you did yesterday when it is time for your daily standup?  Do you use git?  Do you commit regularly?  If you answered yes to those questions you can now quickly figure out what you did yesterday with the help of <a href="https://github.com/timmattison/gitrdun">gitrdun</a>.</p>

<p>gitrdun simply looks for git repos in your home directory, lists all of the commits in those repos from yesterday, and then prints that on the screen.  The current iteration is the &ldquo;5 minute version&rdquo;.  It literally took 5 minutes to write.  The &ldquo;5 hour version&rdquo; may make the formatting a bit nicer and add some features but don&rsquo;t hold your breath for that to come out.</p>

<p>Don&rsquo;t want to fork the repo?  No problem, it&rsquo;s just a one liner anyway.  Use this alias&hellip;</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>alias gitrdun="clear ; PAGER=\"cat\" find ~ -name \".git\" -type d -exec sh -c \"cd '{}' ; echo '{}'; git log --all --since='yesterday'\" \; | less"</span></code></pre></td></tr></table></div></figure>


<p>This clears the screen, uses &ldquo;cat&rdquo; as the pager so that the pager doesn&rsquo;t clear the screen between repo checks, finds all git repos, goes into their directory that is under version control, and then lists all commits on all branches from yesterday.</p>

<p>Enjoy!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Octal and Hexadecimal IP Addresses With Ping]]></title>
    <link href="http://blog.timmattison.com/archives/2014/06/18/octal-and-hexadecimal-ip-addresses-with-ping/"/>
    <updated>2014-06-18T07:12:14-04:00</updated>
    <id>http://blog.timmattison.com/archives/2014/06/18/octal-and-hexadecimal-ip-addresses-with-ping</id>
    <content type="html"><![CDATA[<p>Have you ever seen a system print out an IP address like this?</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Disconnected from 010.000.001.133</span></code></pre></td></tr></table></div></figure>


<p>If you try to ping this IP address you&rsquo;ll get quite interesting results.  What the IP address should be is 10.0.1.133 but what ping reports that it is if you run the command with those leading zeroes included looks very odd.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>timmattison$ ping 010.000.001.133
</span><span class='line'>PING 010.000.001.133 (8.0.1.133): 56 data bytes
</span><span class='line'>Request timeout for icmp_seq 0</span></code></pre></td></tr></table></div></figure>


<p>See that <code>8.0.1.133</code> IP address that it is trying to reach?  It turns out that if you put leading zeroes into an IP address that you pass to <code>ping</code>, and possibly other network tools, it treats those numbers as <a href="https://en.wikipedia.org/wiki/Octal">octal</a>.  Octal isn&rsquo;t something most end-users deal with unless they&rsquo;re reminiscing about their old <a href="https://en.wikipedia.org/wiki/CompuServe">Compuserve</a> addresses.</p>

<p>In any case, if you find yourself trying to ping a machine with an IP address that has leading zeroes make sure you remove them!</p>

<p>This got me wondering what other weird things ping might do with IP addresses so I played around a bit and saw that it actually allows you to enter them in hex as well.  This is useful for IPv6 but really strange for IPv4.  Try it out and try to ping the above address with the first octet in hex:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>timmattison$ ping 0xa.0.1.133
</span><span class='line'>PING 0xa.0.1.133 (10.0.1.133): 56 data bytes</span></code></pre></td></tr></table></div></figure>


<p>Sure enough it converts <code>0xa</code> into <code>10</code>.  I&rsquo;m not sure I&rsquo;ll ever use that feature but its good to know what ping does to its input in the even that some other weird situation pops up.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[My Problem With 'the Problem With Altcoins']]></title>
    <link href="http://blog.timmattison.com/archives/2014/06/18/my-problem-with-the-problem-with-altcoins/"/>
    <updated>2014-06-18T00:00:00-04:00</updated>
    <id>http://blog.timmattison.com/archives/2014/06/18/my-problem-with-the-problem-with-altcoins</id>
    <content type="html"><![CDATA[<p>TL;DR &ndash; The author&rsquo;s strongest argument is that some altcoins are junk.  This unfortunately then morphs into saying that all altcoins are junk and none of them can ever be good.  In my opinion that is going too far.</p>

<p>On the Google Plus Bitcoin community someone posted a link to <a href="http://themisescircle.org/blog/2013/08/22/the-problem-with-altcoins/">The Problem with Altcoins</a>.  I think this article is complete link bait based on the fact that the first paragraph is titled &ldquo;Why no altcoin can succeed&rdquo; but nevertheless I&rsquo;d like to address a few of the things in it because they could be confusing to people new to the cryptocurrency space.</p>

<p>I&rsquo;ll preface this post by saying that I hold a few Bitcoins, some Litecoins, and some Feathercoins.  I bought most of them to play around with and not as a serious investment so I&rsquo;m not here to tell you that any of these things are a solid investment.  If you are like me you want to get into cryptocurrencies because they&rsquo;re interesting and understanding them gives me new ways to approach problems that I see in software development.</p>

<p>Issue #1:</p>

<blockquote><p>Quite simply, a medium of exchange that is more widely accepted on the market is more useful than one which is not. This is known as the network effect. Thus, an initial imbalance between two nearly equal media of exchange will benefit whichever is more widely accepted until a single one overwhelms the rest.</p></blockquote>

<p>This paragraph does quite a good job of shooting itself down unknowingly.  I agree with the statement &ldquo;a medium of exchange that is more widely accepted on the market is more useful than one that is not&rdquo;.  The leap that it then goes to make isn&rsquo;t very well thought out.  Just because something is better does not mean that eventually it will be the only thing.  If that was the case then why are there so many different brands of any product you can think of?</p>

<p>The end of this paragraph is its complete downfall.  It states &ldquo;until a single one overwhelms the rest&rdquo;.  There is no example of this happening as far as I know.  Is there only one currency in the world?  You might think the world currency is the US Dollar but I can assure you it isn&rsquo;t.  Admittedly it does say it will &ldquo;overwhelm&rdquo; the rest and not &ldquo;extinguish&rdquo; the rest but I believe overwhelm here was meant to imply that the others would disappear.</p>

<p>My stance: There is room for more than one physical currency.  There is room for more than one digital currency.</p>

<p>Issue #2:</p>

<blockquote><p>Furthermore, a truly great innovation would much better serve people by being incorporated into future versions of Bitcoin rather than by requiring them to switch to something else</p></blockquote>

<p>This makes the assumption that just because a feature benefits someone that it will be incorporated.  Since the interests of each individual are different you could have features that benefit some (shorter confirmation times, lower transaction fees, anonymity, etc) that do not benefit others.  In fact, one of these features mentioned later is Zerocoin which provides anonymous transactions.  Some would argue that if this was incorporated into Bitcoin that it would set it back a few years as the media picked it up again as the anonymous currency used by drug dealers and terrorists.</p>

<p>Other kinds of transactions like creating &ldquo;<a href="http://bitcoin.stackexchange.com/questions/10986/what-is-meant-by-bitcoin-dust">dust</a>&rdquo; to sign arbitrary bits of data to use the block chain as a kind of digital notary are probably best implemented in a different system altogether.</p>

<p>My stance: Not all features should be incorporated into Bitcoin.  Blockchain bloat is already a bit of a problem and I think we need to minimize it.</p>

<p>Issue #3:</p>

<blockquote><p>Can anyone really expect to create something of value by rereleasing Bitcoin under a new name and with a few tiny changes to its source code?</p></blockquote>

<p>Actually, I&rsquo;m in total agreement here.  There are altcoins that are just knockoffs that don&rsquo;t add any value.  Don&rsquo;t translate my issue with the statement &ldquo;Why no altcoin can succeed&rdquo; into &ldquo;All altcoins should succeed&rdquo;.  I think the market is the place to decide that.</p>

<p>My stance: Some altcoins are useful and interesting.  Some altcoins are not.  I doubt <a href="https://en.wikipedia.org/wiki/Dogecoin">Dogecoin</a> will survive as long as Litecoin.</p>

<p>Issue #4:</p>

<blockquote><p>What is a cryptocurrency actually for? I say that its purpose is to become money. It is obvious that creating altcoins impedes that purpose. Altcoins can only be explained if we believe the purpose of cryptocurrencies is to make money rather than to become money.</p></blockquote>

<p>(Premining)[<a href="https://bitcointalk.org/index.php?topic=194023.0">https://bitcointalk.org/index.php?topic=194023.0</a>] has rightly tainted people&rsquo;s views of altcoins.  If you premine your new cryptocurrency then you are probably just in it for the money.  Granted maybe not enough people knew about your coin when it started but with a public announcement and some planning you can avoid this.  Going back to my previous point I don&rsquo;t understand why Bitcoin gets a pass on this.  What if the original motivation was exactly the same as the altcoins that are guilty of premining?  We can&rsquo;t know if that was or was not the case until we know the true identity of Satoshi Nakamoto.</p>

<p>A lot of the time when people tell me something is &ldquo;obvious&rdquo; it&rsquo;s because they&rsquo;re trying to glaze over the fact that their explanation and understanding of the concept is lacking.  I prefer proof rather than assertions.</p>

<p>My stance: Same as issue #3.  Some altcoins are junk, some altcoins are not.  The market will decide which ones are the winners.  The author references the Wikipedia page for &ldquo;<a href="https://en.wikipedia.org/wiki/Motivated_reasoning">motivated reasoning</a>.  Indeed either side of the argument could say the other is doing this especially when they assert the obviousness of the fact that they are right.</p>

<p>Issue #5:</p>

<blockquote><p>If you try to compete with the best currency with another one that’s exactly the same, that makes yours the worse currency, so you really should not have bothered.</p></blockquote>

<p>Another partial agreement here so this is a quick one.  If your currency is exactly the same as Bitcoin then you shouldn&rsquo;t have bothered.  There are people who are trying to differentiate and that&rsquo;s the kind of competition we should welcome.  Starting a new altcoin gives you the freedom to try out these new ideas and see if they stick.  Getting a feature into Bitcoin takes a lot of work and an altcoin can be a proving ground for that work.</p>

<p>My stance: Altcoins that don&rsquo;t innovate are junk. If you&rsquo;re going to create an altcoin it better have a few differentiators to be taken seriously.</p>

<p>Issue #6:</p>

<blockquote><p>Scrypt was designed to be a memory hog and is consequently unsuited to mining with a machine consisting almost entirely of ASIC chips, like those used for Bitcoin, and it was assumed that Scrypt-coin mining would therefore always remain in the hands of the GPU owners. This, by the way, is false. If it ever became profitable enough, an ASIC machine could be produced with a shared memory, and it would make GPUs obsolete for Scrypt-mining too.</p></blockquote>

<p>I have another post that touches this topic and explains <a href="http://blog.timmattison.com/archives/2014/06/17/why-proof-of-work-algorithms-need-to-use-memory-bound-functions/">why all proof of work algorithms need to use memory bound functions</a>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Why Proof of Work Algorithms Need to Use Memory Bound Functions]]></title>
    <link href="http://blog.timmattison.com/archives/2014/06/17/why-proof-of-work-algorithms-need-to-use-memory-bound-functions/"/>
    <updated>2014-06-17T20:09:15-04:00</updated>
    <id>http://blog.timmattison.com/archives/2014/06/17/why-proof-of-work-algorithms-need-to-use-memory-bound-functions</id>
    <content type="html"><![CDATA[<p>Recently I read an article called <a href="http://en.wikipedia.org/wiki/Memory_bound_function">&ldquo;The Problem with Altcoins&rdquo;</a> and the author states this about Litecoin:</p>

<blockquote><p>Scrypt was designed to be a memory hog and is consequently unsuited to mining with a machine consisting almost entirely of ASIC chips, like those used for Bitcoin, and it was assumed that Scrypt-coin mining would therefore always remain in the hands of the GPU owners. This, by the way, is false. If it ever became profitable enough, an ASIC machine could be produced with a shared memory, and it would make GPUs obsolete for Scrypt-mining too.</p></blockquote>

<p>This is something that I hear a lot and it needs to be cleared up.  There are some things <a href="http://en.wikipedia.org/wiki/Application-specific_integrated_circuit">ASICs</a> are not good at.  Where ASICs really shine are problems where you can design a pipeline that the data goes through in a mostly fixed order.  <a href="http://en.wikipedia.org/wiki/SHA-2">SHA256</a> is perfect for ASICs.  Each step of the algorithm requires very little storage.  If I&rsquo;m counting correctly you need 64 32-bit words, 16 16-bit words, and somewhere around 22 32-bit registers.</p>

<p>We&rsquo;re talking about a really small amount of storage here.  ((64 * 4) + (16 * 2) + (22 * 4)) == 376 bytes</p>

<p>Even if we bump it up to 512 bytes it is still a miniscule amount of storage in the grand scheme of all of the kinds of storage that we use today (registers, L1 cache, L2 cache, L3 cache, RAM, and hard drive space).  Because of this it is cheap to make it very, very fast to read and write this data.  Physically it occupies little space so you can put the components for this storage exactly where it needs to go on the chip.</p>

<p>Litecoin, and several other cryptocurrencies, use <a href="http://en.wikipedia.org/wiki/scrypt">scrypt</a> instead of SHA256.  This algorithm was supposed to make mining only feasibly on CPUs.  Modern GPUs though were found to have a bit of an edge over CPUs and the memory requirements weren&rsquo;t high enough to really take GPUs out of the running.</p>

<p>Now there is <a href="http://cpucoinlist.com/cryptocurrency-algorithms/x11/">X11</a>, and <a href="http://cpucoinlist.com/cryptocurrency-algorithms/cryptonight/">CryptoNight</a> which are even harder to implement on ASICs&hellip;</p>

<p>But anyway what I really want to address is this particular section of the statement:</p>

<blockquote><p>an ASIC machine could be produced with a shared memory</p></blockquote>

<p>This is a fundamental misunderstanding of computer architecture.  An ASIC is super fast because it doesn&rsquo;t have a pool of shared memory.  The memory is exactly where it needs to be for each stage.</p>

<p>Do you know what the technical term for &ldquo;ASICs with shared memory&rdquo; is?  A general purpose CPU.  :)  Yes, an ASIC with a pool of memory like this would still have some advantage but not the orders of magnitude we see now.  This is because it would be bound to the same limits a CPU is bound to which is the relatively slow access time of RAM versus the CPU&rsquo;s clock speed.</p>

<p>What can we do to make sure mining stays CPU bound?  We should be using <a href="https://en.wikipedia.org/wiki/Memory_bound_function">memory bound functions</a> which are sometimes also called memory hard problems.  These memory bound functions should require enormous amounts of memory.  More than a Raspberry Pi has, more than a BeagleBone Black, more than a GPU.  I mean ridiculous gobs of memory.  Why not?  If the proof of work function can be adjusted, and it has to be to keep up with Moore&rsquo;s law, we can adjust the work to be easy in the sense that it requires few iterations but tons of memory.  As CPUs and memory get faster and people join the network we just adjust it as we always have.</p>

<p>X11 and CryptoNight seem like a good start but there are still problems with them.  It turns out there is one big benefit from algorithms that are not profitable on CPUs and that is that bot net operators are much less likely to waste their bot net time on mining those currencies.  I have a feeling that X11 and CryptoNight are very profitable to mine on bot nets right now.</p>

<p>Is there a solution to level the playing field?  Considering the bot net angle what does that even mean?  I believe that there is a solution that would allow people to participate with CPUs, not require GPU and ASIC investments, and would prevent bot net operators from profiting on mining.  I&rsquo;ve been thinking about this for over a year and I&rsquo;m getting very close to having what I think is a workable solution.  There still is one hole in it but I think that it may be better than what is out there.  Stay tuned and when I&rsquo;m ready I&rsquo;ll post it on my blog.</p>

<p>BTW, I started this blog post on 2014-01-10 and just finished it on 2014-06-17 so it may be a while before I release something.  Be patient!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[True Remote Debugging With Chrome's Remote Debugging Feature]]></title>
    <link href="http://blog.timmattison.com/archives/2014/06/17/true-remote-debugging-with-chromes-remote-debugging-feature/"/>
    <updated>2014-06-17T09:19:34-04:00</updated>
    <id>http://blog.timmattison.com/archives/2014/06/17/true-remote-debugging-with-chromes-remote-debugging-feature</id>
    <content type="html"><![CDATA[<p>Have you used <a href="http://blog.chromium.org/2011/05/remote-debugging-with-chrome-developer.html">Chrome&rsquo;s remote debugging feature</a>?  It is a handy tool for debugging JavaScript in another tab/window.</p>

<p>That&rsquo;s nice, but have you ever wanted to debug JavaScript that was running on another machine running Chrome?  If so, and you&rsquo;re running on Mac OS, you&rsquo;ve come to the right place.</p>

<p>The first step in this process is to disable <a href="http://joshuamcginnis.com/2011/02/28/how-to-disable-same-origin-policy-in-chrome/">Chrome&rsquo;s same origin policy</a>.  This may not be necessary in your application but I&rsquo;ve always found I needed to do it in mine.</p>

<p>Now you&rsquo;ll need to make sure you have <a href="http://www.dest-unreach.org/socat/">socat</a> installed.  The easiest way to do this is with <a href="http://brew.sh/">Homebrew</a>.  Install Homebrew, and then run this command:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>brew install socat</span></code></pre></td></tr></table></div></figure>


<p>That will install socat if it isn&rsquo;t installed already.</p>

<p>Now start Chrome remote debugging on the system that you want to connect to.</p>

<p>Next, get socat to relay traffic from port 9223 to port 9222 using this command:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>socat tcp-listen:9223,fork tcp:localhost:9222</span></code></pre></td></tr></table></div></figure>


<p>Finally, try to connect to the remote computer using <em>its IP address, not localhost</em> with a URL like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>http://IP_ADDRESS:9223</span></code></pre></td></tr></table></div></figure>


<p>You should be connected to the remote system&rsquo;s debugger using port 9223.</p>

<p>When you are done be sure to do this to stop socat:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>killall socat</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[How to: Execute a Command on a Remote Server That Requires You to Su or Sudo]]></title>
    <link href="http://blog.timmattison.com/archives/2014/02/13/how-to-execute-a-command-on-a-remote-server-that-requires-you-to-su-or-sudo/"/>
    <updated>2014-02-13T14:28:49-05:00</updated>
    <id>http://blog.timmattison.com/archives/2014/02/13/how-to-execute-a-command-on-a-remote-server-that-requires-you-to-su-or-sudo</id>
    <content type="html"><![CDATA[<p>Recently I ran into a situation where I had to reboot a ton of machines remotely.  I couldn&rsquo;t ssh as root, and you really shouldn&rsquo;t do that anyway, so I thought I might be stuck trying to SSH in, &ldquo;sudo reboot&rdquo;, enter the password, and go on to the next machine.  One snag was that some machines supported sudo and some required me to su.</p>

<p>I didn&rsquo;t want to have to do this for all of the machines I was working on so I searched around and found <a href="https://github.com/paramiko/paramiko">Paramiko</a>.  Paramiko is an SSH library for Python that lets you tell Python the login password and also gives you direct access to the terminal stream from your SSH session.  This means that I can send su or sudo and then send the password without the user doing anything.</p>

<p>Security wise this is an obvious hole in many ways.  First of all if you do this for a machine and specify the password on the command-line it is going to end up in your history file.  So without going through the exhaustive list of reasons why this is generally a bad idea lets just say that you should use this sparingly.</p>

<p>Set the variable <code>root_command</code> to the command that you want to execute as root, set <code>root_command_result</code> to the expected result of the command.  The command needs to have <code>\n</code> on the end of it because it simulates the user pressing enter.  Without it the system will never execute the command.  Pass these command-line parameters in this order:</p>

<ul>
<li>The IP of the system you want to connect to</li>
<li>The username of the user that can su to root</li>
<li>The password of the user that can su to root</li>
<li>The password required to su to root</li>
</ul>


<p>This particular version of the script just performs the &ldquo;su&rdquo; command.  It can be modified to do a &ldquo;sudo&rdquo; with just a few tweaks.  If there&rsquo;s demand I&rsquo;ll post a version that lets you swap between both and does some additional error handling.</p>

<p>And here&rsquo;s the script&hellip; don&rsquo;t forget to install Paramiko!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#!/usr/bin/env python
</span><span class='line'>
</span><span class='line'>__author__ = 'timmattison'
</span><span class='line'>
</span><span class='line'>import paramiko
</span><span class='line'>import sys
</span><span class='line'>import time
</span><span class='line'>
</span><span class='line'>root_command = "whoami\n"
</span><span class='line'>root_command_result = "root"
</span><span class='line'>
</span><span class='line'>def send_string_and_wait(command, wait_time, should_print):
</span><span class='line'>    # Send the su command
</span><span class='line'>    shell.send(command)
</span><span class='line'>
</span><span class='line'>    # Wait a bit, if necessary
</span><span class='line'>    time.sleep(wait_time)
</span><span class='line'>
</span><span class='line'>    # Flush the receive buffer
</span><span class='line'>    receive_buffer = shell.recv(1024)
</span><span class='line'>
</span><span class='line'>    # Print the receive buffer, if necessary
</span><span class='line'>    if should_print:
</span><span class='line'>        print receive_buffer
</span><span class='line'>
</span><span class='line'>def send_string_and_wait_for_string(command, wait_string, should_print):
</span><span class='line'>    # Send the su command
</span><span class='line'>    shell.send(command)
</span><span class='line'>
</span><span class='line'>    # Create a new receive buffer
</span><span class='line'>    receive_buffer = ""
</span><span class='line'>
</span><span class='line'>    while not wait_string in receive_buffer:
</span><span class='line'>        # Flush the receive buffer
</span><span class='line'>        receive_buffer += shell.recv(1024)
</span><span class='line'>
</span><span class='line'>    # Print the receive buffer, if necessary
</span><span class='line'>    if should_print:
</span><span class='line'>        print receive_buffer
</span><span class='line'>
</span><span class='line'># Get the command-line arguments
</span><span class='line'>system_ip = sys.argv[1]
</span><span class='line'>system_username = sys.argv[2]
</span><span class='line'>system_ssh_password = sys.argv[3]
</span><span class='line'>system_su_password = sys.argv[4]
</span><span class='line'>
</span><span class='line'># Create an SSH client
</span><span class='line'>client = paramiko.SSHClient()
</span><span class='line'>
</span><span class='line'># Make sure that we add the remote server's SSH key automatically
</span><span class='line'>client.set_missing_host_key_policy(paramiko.AutoAddPolicy())
</span><span class='line'>
</span><span class='line'># Connect to the client
</span><span class='line'>client.connect(system_ip, username=system_username, password=system_ssh_password)
</span><span class='line'>
</span><span class='line'># Create a raw shell
</span><span class='line'>shell = client.invoke_shell()
</span><span class='line'>
</span><span class='line'># Send the su command
</span><span class='line'>send_string_and_wait("su\n", 1, True)
</span><span class='line'>
</span><span class='line'># Send the client's su password followed by a newline
</span><span class='line'>send_string_and_wait(system_su_password + "\n", 1, True)
</span><span class='line'>
</span><span class='line'># Send the install command followed by a newline and wait for the done string
</span><span class='line'>send_string_and_wait_for_string(root_command, root_command_result, True)
</span><span class='line'>
</span><span class='line'># Close the SSH connection
</span><span class='line'>client.close()</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Port 32764 - a Router Backdoor That You Need to Take Seriously]]></title>
    <link href="http://blog.timmattison.com/archives/2014/01/16/port-32764-a-router-backdoor-that-you-need-to-take-seriously/"/>
    <updated>2014-01-16T08:50:19-05:00</updated>
    <id>http://blog.timmattison.com/archives/2014/01/16/port-32764-a-router-backdoor-that-you-need-to-take-seriously</id>
    <content type="html"><![CDATA[<p>TL;DR Several routers have been found to have a backdoor installed on them that is accessible via the LAN and WAN connections by default.  If you have Internet access at home or at a client location you care about then you should be testing to see if they are vulnerable with <a href="https://www.grc.com/x/portprobe=32764">ShieldsUP</a>.</p>

<p>I would recommend running this test ASAP.  The <a href="https://github.com/elvanderb/TCP-32764">list of affected routers</a> includes Netgear, Linksys, and even “real” Cisco hardware.  That list is not exhaustive.</p>

<p>If you need to run this test via SSH I’ve whipped up a script that will spit out whether you’re vulnerable or not based on the ShieldsUP results.  It was designed to run on Mac OS (because their version of sed is busted) and tested on Mavericks and Debian Linux.  Here’s what you can run:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>curl -L http://bit.ly/port32764 2&gt;&amp;1 | <span class="se">\</span>
</span><span class='line'>  tr <span class="s2">&quot;\n&quot;</span> <span class="s2">&quot; &quot;</span> | <span class="se">\</span>
</span><span class='line'>  tr <span class="s2">&quot;\r&quot;</span> <span class="s2">&quot; &quot;</span> | <span class="se">\</span>
</span><span class='line'>  sed <span class="s1">&#39;s/&lt;[^&gt;][^&gt;]*&gt;/ /g&#39;</span> | <span class="se">\</span>
</span><span class='line'>  sed <span class="s1">&#39;s/^.*32764/32764/&#39;</span> | <span class="se">\</span>
</span><span class='line'>  sed <span class="s1">&#39;s/Unknown.*$//&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The response should look like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>32764 Stealth
</span></code></pre></td></tr></table></div></figure>


<p>Or this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>32764 Closed
</span></code></pre></td></tr></table></div></figure>


<p>If you get anything else then you are vulnerable.  Even if you run this test I recommend running it in a browser on the connection you’re testing just in case the script has an issue.</p>

<p>If you are vulnerable then the following pieces of information about your connection may have already been compromised:</p>

<ul>
<li>Your wireless key (in the clear, not hashed)</li>
<li>Your router admin username and password (in the clear, not hashed)</li>
<li>Your router’s SSID and MAC address (this can be used to add your router to a database of access points with passwords)</li>
<li>Any custom settings you have on your router (port mapping to interesting devices, tunnels you thought would be hidden on a high port number, etc)</li>
</ul>


<p>People have written plenty of applications that do scans of the entire Internet in days <a href="http://zmap.io/">or even hours</a>.  This is being scanned for constantly right now and you cannot hide in the four billion addresses out there.</p>

<p>If you are not vulnerable but you have used the same wireless password on an older router it is probably a good idea to change your password.  Nobody knows how long this has been in the wild.  It has been in the firmware for a long time.</p>

<p>If you need help post in the comments.  Good luck!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Fixing In-Page Analytics With Google Analytics]]></title>
    <link href="http://blog.timmattison.com/archives/2014/01/10/fixing-in-page-analytics-with-google-analytics/"/>
    <updated>2014-01-10T08:40:24-05:00</updated>
    <id>http://blog.timmattison.com/archives/2014/01/10/fixing-in-page-analytics-with-google-analytics</id>
    <content type="html"><![CDATA[<p>After migrating to Octopress I started getting interested in my site&rsquo;s analytics again.  A co-worker told me about in-page analytics with Google Analytics and how it would show you what people were doing on your site so you could tune your layout.  We tried loading it and ran into some problems.</p>

<p>First, we got the &ldquo;Loading&hellip;&rdquo; spinner for a long time:</p>

<p><img src="images/in-page-analytics/loading.png"></p>

<p>Then we got the &ldquo;Still loading&hellip;&rdquo; message that didn&rsquo;t inspire much confidence:</p>

<p><img src="images/in-page-analytics/still-loading.png"></p>

<p>Finally, we got a popup that said &ldquo;Problem loading In-Page Analytics&rdquo;:</p>

<p><img src="images/in-page-analytics/problem-loading-in-page-analytics.png"></p>

<p>What the problem was in my case was that I told Google Analytics that I wanted to track timmattison.com but my site redirects to blog.timmattison.com.  My two options were to make my site actually be served from timmattison.com or to change my tracking code.  I opted to change my tracking code.  I&rsquo;ll walk you through how I did it.</p>

<p>NOTE: <em>You will lose your existing tracking data if you do this!</em>  If you want to keep your tracking data you&rsquo;ll need to find another way.  For me it wasn&rsquo;t a big deal because I just moved my site anyway and my analytics were reset a week or two ago already.</p>

<p>Here are the steps:</p>

<ul>
<li>Log into your analytics account</li>
</ul>


<p><img src="images/in-page-analytics/log-into-your-analytics-account.png"></p>

<ul>
<li>Click the admin button</li>
</ul>


<p><img src="images/in-page-analytics/click-the-admin-button.png"></p>

<ul>
<li>Click &ldquo;View Settings&rdquo;</li>
</ul>


<p><img src="images/in-page-analytics/click-view-settings.png"></p>

<ul>
<li><p>Scroll all the way to the bottom of the page</p></li>
<li><p>Click &ldquo;Delete View&rdquo;</p></li>
</ul>


<p><img src="images/in-page-analytics/click-delete-view.png"></p>

<ul>
<li>Click &ldquo;Delete View&rdquo; again.  <em>At this point you&rsquo;ll lose all of your analytics history!</em></li>
</ul>


<p><img src="images/in-page-analytics/click-delete-view-again.png"></p>

<ul>
<li>Click the admin button</li>
</ul>


<p><img src="images/in-page-analytics/click-the-admin-button.png"></p>

<ul>
<li>Click the property drop down and then click &ldquo;Create new property&rdquo;</li>
</ul>


<p><img src="images/in-page-analytics/click-property-drop-down-and-click-create-new-property.png"></p>

<ul>
<li><p>Re-create your property and make sure you use the site you redirect to.  In my case &ldquo;blog.timmattison.com&rdquo;, not &ldquo;timmattison.com&rdquo;.</p></li>
<li><p>Put your new tracking code into your site.  <em>Don&rsquo;t forget to do this or tracking won&rsquo;t work at all!</em></p></li>
</ul>


<p>And that should do it.  Let me know if it works for you or if you need some help.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Testing a Video Plugin]]></title>
    <link href="http://blog.timmattison.com/archives/2014/01/04/testing-a-video-plugin/"/>
    <updated>2014-01-04T13:54:46-05:00</updated>
    <id>http://blog.timmattison.com/archives/2014/01/04/testing-a-video-plugin</id>
    <content type="html"><![CDATA[<p>Just testing an Octopress plugin from github called <a href="https://github.com/optikfluffel/octopress-responsive-video-embed">Octopress responsive video embed</a>.</p>

<p>A Vimeo video:</p>

<div class="embed-video-container"><iframe src="http://player.vimeo.com/video/82648212 "></iframe></div>


<p>A YouTube video:</p>

<div class="embed-video-container"><iframe src="http://www.youtube.com/embed/T3gacnHb9TI "></iframe></div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[BeagleBone Black and Raspberry Pi SD Card Gotchas on Mac OS]]></title>
    <link href="http://blog.timmattison.com/archives/2014/01/02/beaglebone-black-and-raspberry-pi-sd-card-gotchas-on-mac-os/"/>
    <updated>2014-01-02T19:18:24-05:00</updated>
    <id>http://blog.timmattison.com/archives/2014/01/02/beaglebone-black-and-raspberry-pi-sd-card-gotchas-on-mac-os</id>
    <content type="html"><![CDATA[<p>If you&rsquo;re using dd on the command-line to write SD card images in Mac OS then you may have run into a weird issue where the image is starting to write and then dd comes back and says:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>dd: /dev/diskX: Resource busy
</span></code></pre></td></tr></table></div></figure>


<p>I ran into this multiple times when building Raspberry Pi and BeagleBone Black images.  What it turned out to be was that Mac OS needed me to set the block size for some reason.  I arbitrarily chose 1 MiB so my command looks like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo dd <span class="k">if</span><span class="o">=</span>image-file.img <span class="nv">of</span><span class="o">=</span>/dev/disk3 <span class="nv">bs</span><span class="o">=</span>1048576
</span></code></pre></td></tr></table></div></figure>


<p>After specifying the bs parameter it never happened to me again.  Let me know if you ran into the same thing and whether or not this fixed it on your system.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Building Asterisk With Support for SIPML5]]></title>
    <link href="http://blog.timmattison.com/archives/2014/01/02/building-asterisk-with-support-for-sipml5/"/>
    <updated>2014-01-02T19:06:58-05:00</updated>
    <id>http://blog.timmattison.com/archives/2014/01/02/building-asterisk-with-support-for-sipml5</id>
    <content type="html"><![CDATA[<p>If you are trying to use SIPML5 with Asterisk there are some gotchas that often come up.  If you&rsquo;re running it on Debian these tips below may help.</p>

<p>If you haven&rsquo;t gotten that far with Asterisk and don&rsquo;t care about your current configuration you can try this procedure that I use to build Asterisk myself:</p>

<ul>
<li>Download latest Asterisk, extract it, and cd into the directory it was extracted into</li>
<li>Install some necessary dependencies</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo apt-get install build-essential libncurses5-dev libxml2-dev libsqlite3-dev libssl-dev libsrtp0-dev
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Run the configuration script</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>./configure
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Build Asterisk.  NOTE: I have only had problems running a multi-job make so I would suggest you do not include a -jX option to take advantage of all of your cores.</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>make
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Install Asterisk</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo make install
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Build the samples and <strong>overwrite your current configuration</strong>.  <strong>You lose everything here so skip this step if you want to keep your config</strong>.</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo make samples
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Start Asterisk with crazy verbosity so you can see what is going on</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo /usr/sbin/asterisk -vvvvvvvvvvvvvvg
</span></code></pre></td></tr></table></div></figure>


<p>There are two issues I ran into when trying to use SIPML5.</p>

<h1>Error #1: no protocols out of &lsquo;sip&rsquo; supported &ndash; in Asterisk console</h1>

<p>In this case chan_sip.so probably isn&rsquo;t built.  Check in make menuconfig, add libssl-dev via apt-get, re-run ./configure, make menuselect, verify that resource module res_crypto is enabled.</p>

<h1>Error #2: SRTP issues</h1>

<p>If you are having SRTP issues you probably get one or more of these messages:</p>

<ul>
<li>In the browser &ndash; Not acceptable here</li>
<li>In the Asterisk console &ndash; Received SAVPF profile in audio offer but AVPF is not enabled</li>
<li>In the Asterisk console &ndash; Insufficient information in SDP</li>
<li>In the Asterisk console &ndash; No SRTP module loaded, can&rsquo;t setup SRTP session</li>
<li>In the Asterisk console &ndash; Rejecting secure audio stream without encryption details</li>
</ul>


<p>In this case res_srtp.so probably isn&rsquo;t built.  Check in make menuconfig, add libsrtp0-dev via apt-get, re-run ./configure, make menuselect, verify that resource module res_srtp is enabled.</p>

<p>Good luck and post in the comments if it worked for you or if you need some help.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[How to Get SIPML5 Working With Asterisk]]></title>
    <link href="http://blog.timmattison.com/archives/2014/01/02/how-to-get-sipml5-working-with-asterisk/"/>
    <updated>2014-01-02T18:59:44-05:00</updated>
    <id>http://blog.timmattison.com/archives/2014/01/02/how-to-get-sipml5-working-with-asterisk</id>
    <content type="html"><![CDATA[<p>Another &ldquo;all business&rdquo; post that has been sitting in Evernote for months.  Enjoy!</p>

<p>Assume Asterisk is running on localhost and Apache is installed and running with /var/www at the htdocs directory</p>

<p>http.conf changes:</p>

<ul>
<li>Set &ldquo;enabled=yes&rdquo; OR uncomment &ldquo;;enabled=yes&rdquo;</li>
<li>Set &ldquo;bindport=8088&rdquo; OR uncomment &ldquo;;bindport=8088&rdquo;</li>
</ul>


<p>sip.conf changes:</p>

<ul>
<li>Get the SIP code listening via TCP &ndash; set &ldquo;tcpenable=yes&rdquo;</li>
<li>Add web socket support for SIP &ndash; set &ldquo;transport=udp,ws&rdquo; OR add &ldquo;,ws&rdquo; to existing transport list</li>
<li>Uncomment xlite1 account</li>
<li>Add &ldquo;avpf=yes&rdquo; to xlite1 account</li>
<li>Add &ldquo;icesupport=yes&rdquo; to xlite1 account</li>
</ul>


<p>Steps to perform test call:</p>

<ul>
<li>Restart Asterisk</li>
<li>Get the source from Subversion</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>svn checkout http://sipml5.googlecode.com/svn/trunk/ sipml5-read-only</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Move the sipml5 source into /var/www</li>
<li>Open Chrome and point it to the SIPML5 index.html in /var/www (or the subdirectory you put it in)</li>
<li>Click &ldquo;Enjoy our live demo&rdquo;</li>
<li>Set these values in the &ldquo;Registration&rdquo; panel

<ul>
<li>Display Name: xlite1</li>
<li>Private Identity: xlite1</li>
<li>Public Identity: sip:xlite1@localhost</li>
<li>Realm: localhost</li>
<li>Password is left blank</li>
</ul>
</li>
<li>Click &ldquo;Expert Mode&rdquo;</li>
<li>Set these values in &ldquo;Expert settings&rdquo;

<ul>
<li>Disable Video: Checked</li>
<li>Enable RTCWeb Breaker: Unchecked</li>
<li>WebSocket Server URL: ws://localhost:8088/ws</li>
<li>SIP outbound Proxy URL: udp://localhost:5060</li>
<li>Click &ldquo;Save&rdquo;</li>
<li>Close &ldquo;Expert settings&rdquo; tab</li>
</ul>
</li>
<li>Enter &ldquo;sip:2@localhost&rdquo; in the &ldquo;Call control&rdquo; field</li>
<li>Click &ldquo;Call&rdquo;</li>
</ul>


<p>At this point you should hear audio coming from Asterisk in a few seconds and your first call is complete.  Now you can build out your server as you&rsquo;d want!</p>

<p>Here are some screenshots of the SIPML5 settings just in case you want to visually double-check.</p>

<p><img src="images/sipml5-asterisk/registration-and-call-control.png"></p>

<p><img src="images/sipml5-asterisk/expert-settings.png"></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Installing Unison on a Synology NAS]]></title>
    <link href="http://blog.timmattison.com/archives/2014/01/02/installing-unison-on-a-synology-nas/"/>
    <updated>2014-01-02T18:53:31-05:00</updated>
    <id>http://blog.timmattison.com/archives/2014/01/02/installing-unison-on-a-synology-nas</id>
    <content type="html"><![CDATA[<p>This is all business.  I wrote this up a long time ago and never got a chance to put it online.  Enjoy!</p>

<p>First, install SSH:</p>

<ol>
<li>Go to Synology web GUI</li>
<li>Open Control Panel</li>
<li>Click &ldquo;Terminal&rdquo;</li>
<li>Check &ldquo;Enable SSH service&rdquo;</li>
<li>Click &ldquo;Apply&rdquo;</li>
</ol>


<p>Set up your users so they have a home directory:</p>

<ol>
<li>Go to Synology web GUI</li>
<li>Open Control Panel</li>
<li>Click &ldquo;User&rdquo;</li>
<li>Click &ldquo;User Home&rdquo; button at the top</li>
<li>Check &ldquo;Enable user home service&rdquo;</li>
<li>Select the volume on which the home directories should be stored</li>
<li>Click &ldquo;OK&rdquo;</li>
</ol>


<p>Connect via SSH and make sure it works:</p>

<ol>
<li>ssh as admin to the Synology box.  Use the same password you use as admin on the web GUI.  <strong>If you leave it blank, even if your password is blank, it will always fail.  You must have a non-blank password!</strong> This is to protect against your device getting compromised from having no password.</li>
<li>If you get the &ldquo;Diskstation>&rdquo; prompt then it is working</li>
</ol>


<p>Connect via SSH and make sure non-admin/non-root logins work:</p>

<ol>
<li>Connect as a regular user.  If you get permission denied SSH back in as root and change the desired user&rsquo;s shell from /sbin/nologin to /bin/ash in /etc/passwd.</li>
<li>Try logging in again as that user</li>
</ol>


<p>Bootstrap for ipkg:</p>

<ol>
<li><a href="http://forum.synology.com/wiki/index.php/Overview_on_modifying_the_Synology_Server,_bootstrap,_ipkg_etc">http://forum.synology.com/wiki/index.php/Overview_on_modifying_the_Synology_Server,_bootstrap,_ipkg_etc</a></li>
<li>Log in as root</li>
<li>If you have DSM 4 or greater:</li>
<li> Edit /root/.profile and comment out the lines that set and export the PATH variable</li>
<li> Log out</li>
<li> Log back in as root</li>
<li>Run &ldquo;ipkg&rdquo;.  You should see the options come up and not an error message that ipkg can&rsquo;t be found.</li>
</ol>


<p>Compile and install Unison &ndash; <a href="http://www.multigesture.net/articles/how-to-compile-unison-for-a-synology-ds212/">http://www.multigesture.net/articles/how-to-compile-unison-for-a-synology-ds212/</a>
This error is expected:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>if [ -f `which etags` ]; then \
</span><span class='line'>    etags *.mli */*.mli *.ml */*.ml */*.m *.c */*.c *.txt \
</span><span class='line'>          ; fi
</span><span class='line'>/bin/sh: etags: not found
</span><span class='line'>make[1]: [tags] Error 127 (ignored)</span></code></pre></td></tr></table></div></figure>


<p>Good luck and post success stories and issues in the comments and I&rsquo;ll help if I can.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Compiling Bitcoind on the BeagleBone Black]]></title>
    <link href="http://blog.timmattison.com/archives/2014/01/02/compiling-bitcoind-on-the-beaglebone-black/"/>
    <updated>2014-01-02T18:29:05-05:00</updated>
    <id>http://blog.timmattison.com/archives/2014/01/02/compiling-bitcoind-on-the-beaglebone-black</id>
    <content type="html"><![CDATA[<p>I am running Debian on a BeagleBone Black at home as a toy server/sandbox.  One application that I thought would be interesting to run on it was the standard Bitcoin client.  I think it is a bit strange that the latest version of the Bitcoin client (0.8.6 at the time I wrote this) doesn&rsquo;t use &ldquo;configure&rdquo; like most other Linux/Unix applications because it leads to having to track down dependencies during a build rather than before them.  On a normal system this might not be a big deal because Bitcoin compiles in just a minute or so.  On a smaller device like the BeagleBone Black though it means you&rsquo;ll end up checking in on it periodically over a long period of time only to find that it needs another dependency.</p>

<p>In their defense the github version DOES use a &ldquo;configure&rdquo; script.  I found that out after going through a manual build on 0.8.6 so for completeness I&rsquo;ll show how to compile both and you can use whichever one suits your needs.  The configure script on a lean device like the BeagleBone Black still takes quite a while to run though so this should get you through doing the process just once.</p>

<p>You can use either the current stable version today which is 0.8.6 or you can use the bleeding edge github source.  I would recommend 0.8.6 if you want something that is as stable as possible.  When compiling from source you should keep in mind that your build may not be compatible with old wallet formats.</p>

<p>I cannot stress this enough &ndash; IF YOU HAVE AN OLD WALLET YOU ARE BEST OFF USING THE OFFICIAL BINARIES INSTEAD OF BUILDING FROM SOURCE!</p>

<h1>Using version 0.8.6</h1>

<p>If you want to use version 0.8.6 here&rsquo;s what you need to do:</p>

<ul>
<li>Install the necessary dependencies</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo apt-get install g++ libboost-dev libdb-dev
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><p>Download the <a href="http://sourceforge.net/projects/bitcoin/files/Bitcoin/bitcoin-0.8.6/bitcoin-0.8.6-linux.tar.gz/download">Bitcoin 0.8.6 source</a></p></li>
<li><p>Extract the source</p></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>tar xzvf bitcoin-0.8.6-linux.tar.gz
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Remove the binaries, these are Intel binaries and won&rsquo;t work on the BeagleBone Black anyway</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>rm bitcoin-0.8.6-linux/bin/*/*
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Go to the src directory</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">cd </span>bitcoin-0.8.6-linux/src/src
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Build the source</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>make -f makefile.unix
</span></code></pre></td></tr></table></div></figure>


<p>If you follow these instructions you should get Bitcoin up and running in just one build cycle.  Here are the commands that you should run:</p>

<h1>Using the latest Bitcoin development version (NOT RECOMMENDED!)</h1>

<p>NOTE: I do not recommend that you use this version.  Currently Debian does not have libdb4.8 in its default repository and the Bitcoin client requires it to maintain compatibility with existing wallet files.</p>

<p>If you want to use the latest development version here&rsquo;s what you need to do:</p>

<ul>
<li>Install the necessary dependencies</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo apt-get install g++ libboost-dev libdb-dev git automake pkg-config
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Clone the Bitcoin repository</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git clone https://github.com/bitcoin/bitcoin.git
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Configure the source</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">cd </span>bitcoin
</span><span class='line'>./autogen.sh
</span><span class='line'>./configure --with-incompatible-bdb
</span><span class='line'>make
</span></code></pre></td></tr></table></div></figure>


<p>Now you&rsquo;ll have the bitcoind executable sitting on your BeagleBone Black.  When you try to run it the first time it will complain that some variables aren&rsquo;t set and that your config is incomplete.  The output will look something like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>debian@arm:~/bitcoin/src/src<span class="nv">$ </span>./bitcoind
</span><span class='line'>Error: To use bitcoind, you must <span class="nb">set </span>a rpcpassword in the configuration file:
</span><span class='line'>/home/debian/.bitcoin/bitcoin.conf
</span><span class='line'>It is recommended you use the following random password:
</span><span class='line'><span class="nv">rpcuser</span><span class="o">=</span>bitcoinrpc
</span><span class='line'><span class="nv">rpcpassword</span><span class="o">=</span>XxXXxXXxxxXxXXxXXXXXXxxxxXxxxxxXxXXXXXxXxxXx
</span><span class='line'><span class="o">(</span>you <span class="k">do </span>not need to remember this password<span class="o">)</span>
</span><span class='line'>The username and password MUST NOT be the same.
</span><span class='line'>If the file does not exist, create it with owner-readable-only file permissions.
</span><span class='line'>It is also recommended to <span class="nb">set </span>alertnotify so you are notified of problems;
</span><span class='line'><span class="k">for </span>example: <span class="nv">alertnotify</span><span class="o">=</span><span class="nb">echo</span> %s | mail -s <span class="s2">&quot;Bitcoin Alert&quot;</span> admin@foo.com
</span></code></pre></td></tr></table></div></figure>


<p>What you&rsquo;ll need to do is put these values into the ~/.bitcoin/bitcoin.conf.  Then you can restart bitcoind and it&rsquo;ll run and start grabbing the blockchain.  IT IS INCREDIBLY IMPORTANT THAT YOU DO NOT COPY THE VALUES THAT I PUT HERE.  Your file will look like this (except the rpcpassword will be whatever bitcoind told you):</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">rpcuser</span><span class="o">=</span>bitcoinrpc
</span><span class='line'><span class="nv">rpcpassword</span><span class="o">=</span>XxXXxXXxxxXxXXxXXXXXXxxxxXxxxxxXxXXXXXxXxxXx
</span></code></pre></td></tr></table></div></figure>


<p>This password gives someone complete access to your bitcoind instance.  If you store money there and use the rpcpassword value that I put above you can and probably will lose it.</p>

<p>Unless you have a giant SD card on your BeagleBone Black you&rsquo;ll probably want to put your blockchain on a different disk.  I have my Synology home directory mounted on my BeagleBone Black via NFS (as explained in another post).  It is mounted at ~/synology.  In order to make sure my blockchain is on my Synology I did the following:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mkdir ~/synology/bitcoind
</span><span class='line'>mv ~/.bitcoin/blocks ~/.bitcoin/chainstate ~/.bitcoin/database ~/.bitcoin/db.log ~/.bitcoin/debug.log ~/synology/bitcoind/
</span><span class='line'>ln -s ~/synology/bitcoind/blocks ~/.bitcoin/blocks
</span><span class='line'>ln -s ~/synology/bitcoind/chainstate ~/.bitcoin/chainstate
</span><span class='line'>mkdir -p ~/synology/bitcoind/database
</span><span class='line'>ln -s ~/synology/bitcoind/database ~/.bitcoin/database
</span><span class='line'>ln -s ~/synology/bitcoind/db.log ~/.bitcoin/db.log
</span><span class='line'>ln -s ~/synology/bitcoind/debug.log ~/.bitcoin/debug.log
</span></code></pre></td></tr></table></div></figure>


<p>You may get a few errors about files not existing when you run this.  This is normal and you should try to proceed and see if it works for you.  I was very careful here to not put bitcoin.conf or the wallet.dat file on the Synology.  You should also avoid putting those files on there.  Since the remote file system is potentially a shared resource an attacker can get into that and modify or steal data.  It&rsquo;s best to keep the wallet.dat, peers.dat, and bitcoin.conf local to your BeagleBone Black.</p>

<p>At this point you can restart bitcoind.  I did this in a screen session rather than make it a true service since I&rsquo;m still playing around with it.  Once I set it up as a service I&rsquo;ll post an update and include that information as well.  I am a bit skeptical that it will stay stable since after just a few hours it is already taking up 50% of the BeagleBone Black&rsquo;s RAM.  I guess I&rsquo;ll just have to wait and see.</p>

<p>Periodically check your free file system space and make sure that the blockchain isn&rsquo;t on your SD card.  In my case I can do this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># Show the amount of free space on my SD card</span>
</span><span class='line'>du -sh /
</span><span class='line'>
</span><span class='line'><span class="c"># Show the amount of free space on my Synology NAS</span>
</span><span class='line'>du -sh ~/synology/
</span></code></pre></td></tr></table></div></figure>


<p>Good luck and post in the comments if this helps you out or if you need any assistance.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Connecting a BeagleBone Black to a Synology NAS With NFS]]></title>
    <link href="http://blog.timmattison.com/archives/2014/01/02/connecting-a-beaglebone-black-to-a-synology-nas-with-nfs/"/>
    <updated>2014-01-02T06:52:06-05:00</updated>
    <id>http://blog.timmattison.com/archives/2014/01/02/connecting-a-beaglebone-black-to-a-synology-nas-with-nfs</id>
    <content type="html"><![CDATA[<p>I originally purchased my Synology NAS because of all of the packages that it offers and the fact that it was supposed to give me one less thing to manage.  After a few failed attempts at getting OpenVPN to work and some Plex issues I decided that I needed to have something a little less opaque that I could install different packages on.  I wanted something small, low power, and solid state so I decided to use the BeagleBone Black.</p>

<p>I tried using both CIFS/Samba and sshfs to mount the Synology&rsquo;s filesystem but both of them had extremely strange issues with the applications I planned on using.  I wouldn&rsquo;t recommend either of them for production work involving Linux and NAS.  Often it would tell me that files didn&rsquo;t exist even though I could clearly see they were there.  After moving to NFS none of this happened anymore.</p>

<p>NOTE: Security here is all done by IP address so this is not suitable for a sensitive environment!</p>

<p>Here are the steps I went through to connect my first enable and configure NFS on my Synoloy NAS:</p>

<ol>
<li>Make sure your BeagleBone Black has a static IP and that you know what it is</li>
<li>Log into the Synology web GUI as an admin</li>
<li>Click &ldquo;Control Panel&rdquo;</li>
<li>Click &ldquo;Win/Mac/NFS&rdquo;</li>
<li>Click &ldquo;NFS Service&rdquo;</li>
<li>Make sure that &ldquo;Enable NFS&rdquo; and &ldquo;Enable NFSv4 support&rdquo; are checked</li>
<li>Click the link that says &ldquo;Shared Folder&rdquo;</li>
<li>Find and select the directory you want to share.  In my case it was my user account&rsquo;s home directory so I selected &ldquo;homes&rdquo;.</li>
<li>Click the &ldquo;Privileges&rdquo; drop down</li>
<li>Select &ldquo;NFS Privileges&rdquo;</li>
<li>Click &ldquo;Create&rdquo;</li>
<li>Enter your BeagleBone Black&rsquo;s IP address into the &ldquo;Hostname or IP&rdquo; field</li>
<li>Make sure that the &ldquo;Privilege&rdquo; field is set to &ldquo;Read/Write&rdquo;</li>
<li>Make sure that the &ldquo;Root squash&rdquo; field is set to &ldquo;No mapping&rdquo;</li>
<li>Make sure that &ldquo;Enable asynchronous&rdquo; is checked</li>
<li>Make sure that &ldquo;Allow connections from non-privileged ports (ports higher than 1024&rdquo; is NOT checked</li>
<li>Click &ldquo;OK&rdquo; in the &ldquo;Create an NFS rule&rdquo; popup</li>
<li>Take note of the &ldquo;Mount path&rdquo; field in the &ldquo;Edit NFS privileges of homes&rdquo; window, you&rsquo;ll need this later</li>
<li>Click &ldquo;OK&rdquo; in the &ldquo;Edit NFS privileges of homes&rdquo; window</li>
<li>Log out of the Synology web GUI</li>
</ol>


<p>Now you have your Synology all set up to accept NFS connections from your BeagleBone Black.  Here are the steps to do that:</p>

<ol>
<li>Connect to your BeagleBone Black via SSH as a user that can run sudo</li>
<li>Install the NFS utilities and client by running &ldquo;sudo apt-get install nfs-common&rdquo;</li>
<li>Go to your home directory</li>
<li>Create a directory for your Synology mount point.  I chose &ldquo;synology&rdquo;.</li>
<li>Mount your directory using the &ldquo;Mount path&rdquo; from above along with any additional paths to get you to the desired directory you want.  My mount path was &ldquo;/volume1/homes&rdquo; but I wanted &ldquo;/volume1/homes/tim&rdquo; for my actual home directory.  The command I used was &ldquo;sudo mount -t nfs synology:/volume1/homes/tim /home/tim/synology/&rdquo;</li>
<li>Test out your newly mounted Synology NAS</li>
</ol>


<p>You can now add this to your /etc/fstab file if you&rsquo;d like but I prefer to keep it in a script.  I have a script called mount-nfs.sh in my home directory that I run when necessary since I&rsquo;m still testing out NFSv4.  Once I get it stable I&rsquo;ll make sure that I get it to mount automatically the proper way and update this post.</p>

<h1>Potential issues</h1>

<p>If you receive an error message that says &ldquo;mount.nfs: access denied by server while mounting synology&rdquo; you probably have the wrong IP for your BeagleBone Black in the Synology configuration.</p>

<p>If it appears to mount the volume but no files show up try unmounting it and re-mounting it.  If you unmount it successfully and when re-mounting it again it complains that the device is busy it is possible that your BeagleBone Black&rsquo;s IP address changed.  This happened on my test machine when its IP went from 192.168.1.109 to 192.168.1.110.  It didn&rsquo;t give me the access denied error message but instead exhibited this weird behavior.  If this is the case make sure you have your IP assigned statically, reboot the BeagleBone Black, verify the static IP in the Synology configuration again, and then try re-mounting the path.  After that mine started working again.</p>

<p>Good luck!  Post any success stories or issues in the comments.  I&rsquo;ll do my best to help out if possible.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Reading Resources in Java]]></title>
    <link href="http://blog.timmattison.com/archives/2013/12/30/reading-resources-in-java/"/>
    <updated>2013-12-30T11:02:52-05:00</updated>
    <id>http://blog.timmattison.com/archives/2013/12/30/reading-resources-in-java</id>
    <content type="html"><![CDATA[<p>Reading resources in Java has always been a mystery to me.  It&rsquo;s not because I don&rsquo;t understand how to do it but more that I do it so infrequently that
I always forget what I need to do.  In Java&rsquo;s defense once you understand what you need to do it&rsquo;s actually very simple.  I&rsquo;ve run into this issue
many times in a professional context.  Usually it is just trying to load a simple resource so I can keep it inside the JAR file I&rsquo;m delivering to a
client.</p>

<p>The sixty second explanation of how to do this is as follows.  If you&rsquo;re using an IDE and have a standard project layout you can simply follow these steps:</p>

<ol>
<li>Under your src/main directory create a new directory called &ldquo;resources&rdquo;</li>
<li>Put your static file in the &ldquo;resources&rdquo; directory.  For example, &ldquo;jquery-1.10.2.min.js&rdquo; if you want to serve this file from an embedded web server.</li>
<li>When you want to load the file do this:</li>
</ol>


<p>The long way:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">URL</span> <span class="n">jqueryUrl</span> <span class="o">=</span> <span class="n">getClass</span><span class="o">().</span><span class="na">getResource</span><span class="o">(</span><span class="s">&quot;/jquery-1.10.2.min.js&quot;</span><span class="o">);</span>
</span><span class='line'><span class="n">InputStream</span> <span class="n">jqueryInputStream</span> <span class="o">=</span> <span class="n">jqueryUrl</span><span class="o">.</span><span class="na">openStream</span><span class="o">();</span>
</span><span class='line'><span class="n">String</span> <span class="n">jquery</span> <span class="o">=</span> <span class="n">IOUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">jqueryInputStream</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>The short way:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">String</span> <span class="n">jquery</span> <span class="o">=</span> <span class="n">IOUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">getClass</span><span class="o">().</span><span class="na">getResource</span><span class="o">(</span><span class="s">&quot;/jquery-1.10.2.min.js&quot;</span><span class="o">).</span><span class="na">openStream</span><span class="o">());</span>
</span></code></pre></td></tr></table></div></figure>


<p>And that&rsquo;s it!  I recommend the long way because you can step through it if the file isn&rsquo;t found and get some insight into what happened rather than
just getting an opaque NullPointerException.  If you don&rsquo;t have the file in the directory, or you have the wrong file name, after attempting to get
the jqueryUrl it&rsquo;ll just be NULL.  If that happens just check to make sure that you have the file name correct, resources is spelled correctly, and
it is in the right location.</p>

<p>Good luck!  Post in the comments if you find this useful or if you have trouble.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Migrated From Wordpress to Octopress]]></title>
    <link href="http://blog.timmattison.com/archives/2013/12/30/migrated-from-wordpress-to-octopress/"/>
    <updated>2013-12-30T10:10:22-05:00</updated>
    <id>http://blog.timmattison.com/archives/2013/12/30/migrated-from-wordpress-to-octopress</id>
    <content type="html"><![CDATA[<p>I finally got tired of dealing with Wordpress and all of the baggage that comes along with it.  I&rsquo;ve migrated to Octopress and it feels nice.
We&rsquo;ll see if it makes me post any more or not though.  It appears that this is my only post for the entire year so far.</p>

<p>If you can recommend any themes that look a bit nicer than this please post in the comments.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Coming Soon: How to Easily Enable PoE (Power Over Ethernet) in Your Homebrew Projects]]></title>
    <link href="http://blog.timmattison.com/archives/2012/05/25/coming-soon-how-to-easily-enable-poe-power-over-ethernet-in-your-homebrew-projects/"/>
    <updated>2012-05-25T09:14:20-04:00</updated>
    <id>http://blog.timmattison.com/archives/2012/05/25/coming-soon-how-to-easily-enable-poe-power-over-ethernet-in-your-homebrew-projects</id>
    <content type="html"><![CDATA[<p>UPDATE 2013-12-30: This is on hold permanently.  I never ended up having the time (this post is from way over a year ago) and PoE just isn&rsquo;t on my radar lately as I&rsquo;ve shifted more towards security and software testing.</p>

<p>PoE (<a href="http://en.wikipedia.org/wiki/Power_over_Ethernet">Power over Ethernet</a>) is an exciting and promising technology.  I think that a lot of people take it for granted now that you can plug your IP phone into an Ethernet jack and it gets data and power over that single connection.  It&rsquo;s easy to forget that your IP phone isn&rsquo;t a real landline with convenience like this.</p>

<p>One thing that has been frustrating about PoE over the years is not supply side availability but consumption side hardware for hobbyists.  You can find very cheap PoE switches online and that&rsquo;s great for all of your pre-fab gadgets (IP phones, WiFi access points, even video cameras) but implementing PoE in your own projects has been tough to say the least.</p>

<p>There is now <a href="http://canakit.webstorepowered.com/Arduino-Ethernet-Power-over-Ethernet-PoE-Module/dp/B005D22FR6">an Arduino board that supports PoE</a> but if you&rsquo;re using an existing Arduino board (Mega, etc), a Netduino Plus, or a single board computer you are still out of luck if you want to use PoE so far.  Don&rsquo;t get me wrong you can do it but it takes significant electronics experience, a multitude of components, and even some luck since not all PoE mid-span devices follow the standard perfectly.  When using PoE with a non-compliant mid-span device you will certainly run into grounding issues that can range from a minor hassle to project killing either from noise or <a href="http://en.wikipedia.org/wiki/Magic_smoke">magic smoke</a>.  I haven&rsquo;t experienced magic smoke yet but I&rsquo;ve definitely seen issues with noise and FTDI boards connecting and disconnecting from USB when hooked into a PoE circuit powered by a non-compliant device.</p>

<p>As far as the mid-span devices go you&rsquo;ll have to do your homework to find one that is compliant and that might even mean buying a few devices to test them out.  So far I&rsquo;ve had some luck with a <a href="http://www.phihong.com/html/psa16u-480_15_4w_1-port_poe.html">Phihong PSA16U-480</a> although there have been a few times where I&rsquo;ve gotten the network TX/RX to stop working while the PoE portion still works.  I never did conclude whether it was a circuit problem, a Phihong problem, or a cabling problem though so I would say that so far the Phihong has been the best.  On the other hand my <a href="http://www.intellinet-network.com/en-US/products/6897-power-over-ethernet-poe-injector">Intellinet 524179</a> has consistently caused my <a href="http://www.sparkfun.com/products/9873">Sparkfun FTDI basic module</a> to disconnect from USB each time power is disconnected.  The Phihong does not do that and I have concluded that it must be a grounding problem.  To be clear my FTDI module in this case is being used to connect to a circuit that is powered by PoE but the FTDI module derives its power from a USB port, not the PoE adapter, on a computer that is connected to the same ground as the Intellinet 524179.  Because of this I would steer clear of this mid-span device if possible.</p>

<p>Now a company called <a href="http://silvertel.com">Silvertel</a> has released <a href="http://www.silvertel.com/poe_products.htm">a line of PoE modules</a> that finally make adding PoE to your circuits a much easier proposition.  With these new modules you only need 1 or 2 extra components to get yourself up and running which is a far cry from the 10 or more components I&rsquo;ve seen in previous designs.  Naturally you&rsquo;ll need to have direct, board level access to the magnetics for the Ethernet connection so it won&rsquo;t work in all circuits.  There are some embedded modules that don&rsquo;t expose the two taps needed on the TX and RX coil to make this all work so those modules will still be unable to use PoE right in their circuitry.</p>

<p>However, if you find that you&rsquo;re working with a module that doesn&rsquo;t have the proper taps you can always get a <a href="http://www.cisco.com/en/US/prod/collateral/voicesw/ps6788/phones/ps10042/ps10044/data_sheet_c78-502433.html">PoE splitter</a>.  These devices extract PoE power and either provide 48V or some lower regulated voltage and put that into a standard barrel connector.  It&rsquo;s not elegant but it works.  You must avoid any hacks where you put raw voltage on spare Ethernet lines as tempting as they might be.  Some people can get away with it during testing but there&rsquo;s always the risk that you&rsquo;ll fry something when you unexpectedly hook up the wrong port.  Do yourself a favor and stick with the standards for consistency and safety.</p>

<p>I&rsquo;m hoping to get some time next week to try Silvertel&rsquo;s modules out.  Once I do I&rsquo;ll be posting my results and, if I&rsquo;m successful, some information on how to convert your Netduino Plus into a Netduino Plus with PoE.  Either way I&rsquo;ll post updates next week and keep everyone up to date on my progress.  I expect that if it works PoE will be a major player in most or all of my future projects.</p>

<p>What projects do you have that you would like to add PoE to?  What has stopped you from doing it so far other than a lack of time?  Post in the comments and let me know.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[How-To: Fix VMware Kernel Module Compile Issues With VMware Workstation 8.0.3 and Linux Kernel 3.2.0]]></title>
    <link href="http://blog.timmattison.com/archives/2012/05/04/how-to-fix-vmware-kernel-module-compile-issues-with-vmware-workstation-8-0-3-and-linux-kernel-3-2-0/"/>
    <updated>2012-05-04T09:06:30-04:00</updated>
    <id>http://blog.timmattison.com/archives/2012/05/04/how-to-fix-vmware-kernel-module-compile-issues-with-vmware-workstation-8-0-3-and-linux-kernel-3-2-0</id>
    <content type="html"><![CDATA[<p><strong>Update 2012-06-16</strong>: This still happens on the 8.0.4 update so change the values that read &ldquo;8.0.3&rdquo; to &ldquo;8.0.4&rdquo; if you are using 8.0.4.  Also, if you have patched previously and try to run the script again after an upgrade you need to remove a file called &ldquo;/usr/lib/vmware/modules/source/.patched&rdquo; first.  The script will let you know that it won&rsquo;t patch because it has already been done if you forget.  Just delete it and re-run the script.</p>

<p>Today I upgraded to VMware Workstation 8.0.3 and immediately I ran into the following error message:</p>

<pre><code>make[1]: Entering directory `/usr/src/linux-headers-3.2.0-2-amd64'
  CC [M]  /tmp/vmware-root/modules/vmnet-only/userif.o
  CC [M]  /tmp/vmware-root/modules/vmnet-only/netif.o
  CC [M]  /tmp/vmware-root/modules/vmnet-only/filter.o
/tmp/vmware-root/modules/vmnet-only/userif.c: In function ‘VNetCsumCopyDatagram’:
/tmp/vmware-root/modules/vmnet-only/userif.c:520:3: error: incompatible type for argument 1 of ‘kmap’
/usr/src/linux-headers-3.2.0-2-common/include/linux/highmem.h:48:21: note: expected ‘struct page *’ but argument is of type ‘const struct &lt;anonymous&gt;’
/tmp/vmware-root/modules/vmnet-only/userif.c:523:3: error: incompatible type for argument 1 of ‘kunmap’
/usr/src/linux-headers-3.2.0-2-common/include/linux/highmem.h:54:20: note: expected ‘struct page *’ but argument is of type ‘const struct &lt;anonymous&gt;’
/tmp/vmware-root/modules/vmnet-only/netif.c: In function ‘VNetNetIfSetup’:
/tmp/vmware-root/modules/vmnet-only/netif.c:134:7: error: unknown field ‘ndo_set_multicast_list’ specified in initializer
/tmp/vmware-root/modules/vmnet-only/netif.c:134:7: warning: initialization from incompatible pointer type [enabled by default]
/tmp/vmware-root/modules/vmnet-only/netif.c:134:7: warning: (near initialization for ‘vnetNetifOps.ndo_validate_addr’) [enabled by default]
make[4]: *** [/tmp/vmware-root/modules/vmnet-only/userif.o] Error 1
make[4]: *** Waiting for unfinished jobs....
make[4]: *** [/tmp/vmware-root/modules/vmnet-only/netif.o] Error 1
</code></pre>

<p>After lots of Googling I found <a href="http://weltall.heliohost.org/wordpress/2012/01/26/vmware-workstation-8-0-2-player-4-0-2-fix-for-linux-kernel-3-2-and-3-3/">a blog post with a patch for kernels 3.2.0 and 3.3.0</a>.  Unfortunately when I tried to run the patch it failed and said:</p>

<pre><code>Sorry, this script is only for VMWare WorkStation 8.0.2 or VMWare Player 4.0.2. Exiting
</code></pre>

<p>In order to fix this open up the script after you download it and change the line this line:</p>

<pre><code>vmreqver=8.0.2
</code></pre>

<p>To this:</p>

<pre><code>vmreqver=8.0.3
</code></pre>

<p>Re-run the script and you should be good to go.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Tips for Debugging Spring's @Transactional Annotation]]></title>
    <link href="http://blog.timmattison.com/archives/2012/04/19/tips-for-debugging-springs-transactional-annotation/"/>
    <updated>2012-04-19T10:31:14-04:00</updated>
    <id>http://blog.timmattison.com/archives/2012/04/19/tips-for-debugging-springs-transactional-annotation</id>
    <content type="html"><![CDATA[<p>For over a week now I&rsquo;ve been cleaning up some legacy code that uses Spring and Hibernate to persist and process data in a SQL database.  The code works but it doesn&rsquo;t follow the strict philosophy of service oriented architecture in the sense that there are several places that Spring and Hibernate weren&rsquo;t doing what they were expected to do and a few workarounds had to be implemented.  Since we were bringing more programmers on board I wanted to make sure that everything played by the rules and was easy to update so I had to learn a lot that I had glossed over in the past.</p>

<p>With some creative Googling I found two invaluable resources that I need to give credit to:</p>

<ul>
<li><p><a href="http://java.dzone.com/articles/monitoring-declarative-transac?page=0,1">Monitoring Declarative Transactions in Spring</a></p></li>
<li><p><a href="http://stackoverflow.com/questions/3037006/starting-new-transaction-in-spring-bean">Starting new transactions in Spring bean</a></p></li>
</ul>


<p>Here&rsquo;s what I distilled out of everything I went through:</p>

<ol>
<li><p> @Transactional annotations only work on public methods.  If you have a private or protected method with this annotation there&rsquo;s no (easy) way for Spring AOP to see the annotation.  It doesn&rsquo;t go crazy trying to find them so make sure all of your annotated methods are public.</p></li>
<li><p> Transaction boundaries are only created when properly annotated (see above) methods are called through a Spring proxy.  This means that you need to call your annotated method directly through an @Autowired bean or the transaction will never start.  If you call a method on an @Autowired bean that isn&rsquo;t annotated which itself calls a public method that is annotated <strong><em>YOUR ANNOTATION IS IGNORED</em></strong>.  This is because Spring AOP is only checking annotations when it first enters the @Autowired code.</p></li>
<li><p> Never blindly trust that your @Transactional annotations are actually creating transaction boundaries.  When in doubt test whether a transaction really is active (see below)</p></li>
</ol>


<p>My first problem was that the code was annotated improperly like this:</p>

<pre><code>/**
 * This code example is BAD code, do not use it!
 */
class NonWorkingMyClass {

  @Autowired
  protected MyService myService;

  public void calledFirst() {
    // Do some setup work...

    // Call our internal method
    calledSecond();
  }

  @Transactional
  private void calledSecond() {
    MyObject myObject = myService.retrieveLatest();

    // Update some object fields
    myObject.setName("New Name");
  }
}
</code></pre>

<p>In this case someone would call NonWorkingMyClass.calledFirst(), it would then call calledSecond() and try to update the name field.  This works if your XML configuration is set up properly but it will not be in a transaction.  This can cause concurrency issues that won&rsquo;t show up until it&rsquo;s really inconvenient.</p>

<p>Here&rsquo;s the working version of that code:</p>

<pre><code>/**
 * This code example works
 */
class WorkingMyClass {

  @Autowired
  protected MyService myService;

  @Transactional
  public void calledFirst() {
    // Do some setup work...

    // Call our internal method
    calledSecond();
  }

  private void calledSecond() {
    MyObject myObject = myService.retrieveLatest();

    // Update some object fields
    myObject.setName("New Name");
  }
}
</code></pre>

<p>Now when someone called WorkingMyClass.calledFirst() it would do what you expect in a transaction and the transaction boundaries are properly respected.</p>

<p>This looks like a simple fix that should only take a few minutes but finding out that was the problem involved turning on lots of Spring DEBUG level logging, Googling, and actually testing to make sure the transactions were active.  Before I knew what I know now I used some code from the first site I listed to show if I was inside a transaction or not.  I was shocked and relieved when it showed that I wasn&rsquo;t because it meant the concurrency issues weren&rsquo;t due to bad programming, just bad configuration.  Here are the methods that I came up with that you can use to see if you are in a transaction and even force your code to throw an exception if it isn&rsquo;t.  This can be invaluable if someone messes up an annotation in the future or breaks your XML configuration.</p>

<p>This code belongs in a utility class that is accessible from anywhere.  There are two flags you will need to put somewhere:</p>

<p>transactionDebugging &ndash; Indicates we should do the transaction tests
verboseTransactionDebugging &ndash; Indicates we should print debug messages with the transaction tests</p>

<p>verboseTransactionDebugging has no effect if transactionDebugging is false.</p>

<pre><code>class DebugUtils {
    private static final transactionDebugging = true;
    private static final verboseTransactionDebugging = true;

    public static void showTransactionStatus(String message) {
        System.out.println(((transactionActive()) ? "[+] " : "[-] ") + message);
    }

    // Some guidance from: http://java.dzone.com/articles/monitoring-declarative-transac?page=0,1
    public static boolean transactionActive() {
        try {
            ClassLoader contextClassLoader = Thread.currentThread().getContextClassLoader();
            Class tsmClass = contextClassLoader.loadClass("org.springframework.transaction.support.TransactionSynchronizationManager");
            Boolean isActive = (Boolean) tsmClass.getMethod("isActualTransactionActive", null).invoke(null, null);

            return isActive;
        } catch (ClassNotFoundException e) {
            e.printStackTrace();
        } catch (IllegalArgumentException e) {
            e.printStackTrace();
        } catch (SecurityException e) {
            e.printStackTrace();
        } catch (IllegalAccessException e) {
            e.printStackTrace();
        } catch (InvocationTargetException e) {
            e.printStackTrace();
        } catch (NoSuchMethodException e) {
            e.printStackTrace();
        }

        // If we got here it means there was an exception
        throw new IllegalStateException("ServerUtils.transactionActive was unable to complete properly");
    }

    public static void transactionRequired(String message) {
        // Are we debugging transactions?
        if (!transactionDebugging) {
            // No, just return
            return;
        }

        // Are we doing verbose transaction debugging?
        if (verboseTransactionDebugging) {
            // Yes, show the status before we get to the possibility of throwing an exception
            showTransactionStatus(message);
        }

        // Is there a transaction active?
        if (!transactionActive()) {
            // No, throw an exception
            throw new IllegalStateException("Transaction required but not active [" + message + "]");
        }
    }
}
</code></pre>

<p>In our previous code example we could use these new methods like this:</p>

<pre><code>/**
 * This code example works
 */
class WorkingMyClass {

  @Autowired
  protected MyService myService;

  @Transactional
  public void calledFirst() {
    // Make sure we're using transactions.  Include the name of the class and method
    //   so it is easier to track down later if there are problems.
    DebugUtils.transactionRequired("WorkingMyClass.calledFirst");

    // Do some setup work...

    // Call our internal method
    calledSecond();
  }

  private void calledSecond() {
    MyObject myObject = myService.retrieveLatest();

    // Update some object fields
    myObject.setName("New Name");
  }
}
</code></pre>

<p>That&rsquo;s it.  Post in the comments if this helps you out or if you want to add to the code.</p>
]]></content>
  </entry>
  
</feed>
