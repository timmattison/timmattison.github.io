<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Tim Mattison]]></title>
  <link href="http://blog.timmattison.com/atom.xml" rel="self"/>
  <link href="http://blog.timmattison.com/"/>
  <updated>2014-07-18T18:40:27-04:00</updated>
  <id>http://blog.timmattison.com/</id>
  <author>
    <name><![CDATA[Tim Mattison]]></name>
    <email><![CDATA[tim (at) mattison (dot) org]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Fenced Code Blocks in Ordered Lists in Octopress]]></title>
    <link href="http://blog.timmattison.com/archives/2014/07/17/fenced-code-blocks-in-ordered-lists-in-octopress/"/>
    <updated>2014-07-17T06:54:17-04:00</updated>
    <id>http://blog.timmattison.com/archives/2014/07/17/fenced-code-blocks-in-ordered-lists-in-octopress</id>
    <content type="html"><![CDATA[<p>While writing an article yesterday I ran into an issue getting fenced code blocks to work in markdown.  I searched around and came across <a href="https://gist.github.com/clintel/1155906">a gist that showed how to do it</a> but I still couldn&rsquo;t get it to work.</p>

<p>It turns out that the parser used in Octopress is slightly different than some of the other parsers out there and treats this markdown differently.  There is <a href="https://github.com/imathis/octopress/issues/488">an issue filed for this</a> but the issue resolution is to use a workaround.</p>

<p>After some experimentation I came up with some simple steps that cover all the scenarios for putting code blocks or formatted text into an ordered list while writing my blog posts.</p>

<p>It is organized so that the two main scenarios include four different snippets of code.  The first snippet of code is put directly before the entire block you want to format.  The second snippet of code is put before each line of code.  The third snippet of code is put after each line of code.  The fourth snippet of code is put at the end of the entire block.</p>

<ol>
<li>No line numbers, no syntax highlighting.  I use this when including snippets of commands that I have run from the console.

<ol>
<li>Before the block &ndash; <code>&lt;div class="highlight"&gt;&lt;pre&gt;&lt;code&gt;</code></li>
<li>Before each line &ndash; <code>&lt;span class="line”&gt;</code></li>
<li>After each line &ndash; <code>&lt;/span&gt;</code></li>
<li>After the block &ndash; <code>&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</code></li>
</ol>
</li>
</ol>


<br/>


<ol>
<li>No line numbers, syntax highlighting.  I use this for regular code if I don&rsquo;t care about line numbers.  Replace <code>LANGUAGE</code> with the language you are using.  For example, <code>c</code> or <code>python</code> (see the <a href="http://pygments.org/docs/lexers/">supported language list</a> for more).

<ol>
<li>Before the block &ndash; <code>&lt;div class="highlight"&gt;&lt;pre&gt;&lt;code class="LANGUAGE"&gt;</code></li>
<li>Before each line &ndash; <code>&lt;span class="line”&gt;</code></li>
<li>After each line &ndash; <code>&lt;/span&gt;</code></li>
<li>After the block &ndash; <code>&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</code></li>
</ol>
</li>
</ol>


<p>If you want to do line numbers when syntax highlighting it gets messy.  You need to build a table to have the line number &ldquo;gutter&rdquo; in there.  You can do it but it is a bit more work.</p>

<p>Line numbers and syntax highlighting:</p>

<ol>
<li><p>Start a table that holds everything.  This is the block you&rsquo;ll use:</p>

<p> <div class="highlight"><pre><code class="html">
 <span class="line">&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&ldquo;gutter&rdquo;&gt;&lt;pre class=&ldquo;line-numbers&rdquo;&gt;</span>
 </code></pre></div></p></li>
<li><p>Determine how many lines are in your code snippet.  Now create a line number row for each of them.  Assuming you have five lines of code that would look like this:</p>

<p> <div class="highlight"><pre><code class="html">
 <span class="line">&lt;span class=&ldquo;line-number&rdquo;&gt;1&lt;/span&gt;</span>
 <span class="line">&lt;span class=&ldquo;line-number&rdquo;&gt;2&lt;/span&gt;</span>
 <span class="line">&lt;span class=&ldquo;line-number&rdquo;&gt;3&lt;/span&gt;</span>
 <span class="line">&lt;span class=&ldquo;line-number&rdquo;&gt;4&lt;/span&gt;</span>
 <span class="line">&lt;span class=&ldquo;line-number&rdquo;&gt;5&lt;/span&gt;</span>
 </code></pre></div></p></li>
<li><p>Close this column of the table and start the column for the code:</p>

<p> <div class="highlight"><pre><code class="html">
 <span class="line">&lt;/pre&gt;&lt;/td&gt;&lt;td class=&ldquo;code&rdquo;&gt;&lt;pre&gt;&lt;code class=&ldquo;LANGUAGE&rdquo;&gt;
 </code></pre></div></p></li>
<li><p>Before each line of code &ndash; <code>&lt;span class="line"&gt;</code></p></li>
<li>After each line of code &ndash; <code>&lt;/span&gt;</code></li>
<li>After the block &ndash; <code>&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;</code></li>
</ol>


<p>That should do it.  Good luck!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Common Android Wear Tasks for Developers]]></title>
    <link href="http://blog.timmattison.com/archives/2014/07/16/common-android-wear-tasks-for-developers/"/>
    <updated>2014-07-16T06:59:56-04:00</updated>
    <id>http://blog.timmattison.com/archives/2014/07/16/common-android-wear-tasks-for-developers</id>
    <content type="html"><![CDATA[<p>Getting started with development on the Android Wear platform can be challenging.  Here are my notes on how to get started quickly.</p>

<p>Before you do anything!
1. Back up your IntelliJ configuration if you use IntelliJ at all.
2. Install Android Studio.  Do NOT try to use IntelliJ to do Android Wear development.</p>

<p>Once you&rsquo;ve got Android Studio installed you&rsquo;ll need to do some setup on your devices (watch and phone) to get them working.  Here I assume you&rsquo;re using physical devices for your phone and your watch, no emulators.</p>

<p><strong>Enabling debugging on your Android Wear device</strong></p>

<p>The first time you set up your watch for remote debugging do the following:</p>

<ol>
<li>Tap your watch face to get the &ldquo;Speak now&rdquo; prompt</li>
<li>Tap the screen again to get the list of options</li>
<li>Scroll down to &ldquo;Settings&rdquo; and tap it</li>
<li>Scroll down to &ldquo;About&rdquo; and tap it.  If you see &ldquo;Developer options&rdquo; in this list already you do not need to do this procedure since it has already been done.</li>
<li>Scroll down to &ldquo;Build number&rdquo; and tap it 7 times.  You should get a message that says &ldquo;You are now a developer!&rdquo;.</li>
<li>Swipe to the right to get the previous menu</li>
<li>Scroll down to &ldquo;Developer options&rdquo; and tap it</li>
<li>Tap &ldquo;ADB debugging&rdquo; if it says it is disabled</li>
<li>Tap &ldquo;Debug over Bluetooth&rdquo; if it says it is disabled</li>
</ol>


<p>After your Android Wear device has been set up once you&rsquo;ll only need to follow these steps to re-enable debugging if you ever disable it:</p>

<ol>
<li>Tap your watch face to get the &ldquo;Speak now&rdquo; prompt</li>
<li>Tap the screen again to get the list of options</li>
<li>Scroll down to &ldquo;Settings&rdquo; and tap it</li>
<li>Scroll down to &ldquo;Developer options&rdquo; and tap it</li>
<li>Tap &ldquo;ADB debugging&rdquo; if it says it is disabled</li>
<li>Tap &ldquo;Debug over Bluetooth&rdquo; if it says it is disabled</li>
</ol>


<p><strong>Enabling debugging over Bluetooth from your Android phone to your Android Wear device</strong></p>

<ol>
<li>Open the &ldquo;Android Wear&rdquo; app</li>
<li><p>Tap the settings icon at the top of the screen (the two gears that look like the icon below)</p>

<p>  <img src="http://blog.timmattison.com/images/android-wear-for-developers/settings-icon.png" alt="two small gears" /></p></li>
<li>Make sure &ldquo;Debugging over Bluetooth&rdquo; is checked</li>
<li>Once it is checked two fields will appear below it.  They are &ldquo;Host&rdquo; and &ldquo;Target&rdquo;.  &ldquo;Target&rdquo; will say &ldquo;connected&rdquo; when your watch is connected to your phone.  &ldquo;Host&rdquo; will say &ldquo;connected&rdquo; when ADB is connected to your watch.</li>
</ol>


<p><strong>Setting up ADB for Android Wear debugging over Bluetooth</strong></p>

<p>Make sure ADB sees your phone:</p>

<ol>
<li>Connect your phone via USB and make sure USB debugging is enabled</li>
<li><p>Run <code>adb devices</code> from the command line.  You should get some output like this:</p>

<p> <div class="highlight"><pre><code>
 <span class="line">$ adb devices</span>
 <span class="line">List of devices attached</span>
 <span class="line">01234567890abcdef    device</span>
 </code></pre></div></p></li>
<li><p>Check to see if there is a device in the list called &ldquo;localhost:4444&rdquo;.  If so, you are already paired and ready to go.  You do not need to do this procedure.</p></li>
<li><p>To connect ADB to your watch run <code>adb forward tcp:4444 localabstract:/adb-hub; adb connect localhost:4444</code> and you should see this:</p>

<p> <div class="highlight"><pre><code>
 <span class="line">$ adb forward tcp:4444 localabstract:/adb-hub; adb connect localhost:4444</span>
 <span class="line">connected to localhost:4444</span>
 </code></pre></div></p></li>
<li><p>Run <code>adb devices</code> again and you should see this:</p>

<p> <div class="highlight"><pre><code>
 <span class="line">$ adb devices</span>
 <span class="line">List of devices attached</span>
 <span class="line">01234567890abcdef    device</span>
 <span class="line">localhost:4444       device</span>
 </code></pre></div></p></li>
<li><p>If you do not see the <code>localhost:4444</code> entry then double check that ADB debugging and Bluetooth debugging are enabled on your watch.  Then check to make sure Bluetooth debugging is enabled in the Android Wear app on your phone.  Once those are verified you can run this command again and it will try to reconnect.</p></li>
</ol>


<p>Now that you&rsquo;ve done all of that Android Studio should give you a dialog like this when you try to run or debug an application:</p>

<p><img src="http://blog.timmattison.com/images/android-wear-for-developers/choose-device-dialog.png" alt="&quot;Choose Device&quot; dialog" /></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Tip: Bringing Your Working Directory (Pwd) to Another Terminal Window in Mac OS]]></title>
    <link href="http://blog.timmattison.com/archives/2014/07/15/tip-bringing-your-working-directory-pwd-to-another-terminal-window-in-mac-os/"/>
    <updated>2014-07-15T18:37:23-04:00</updated>
    <id>http://blog.timmattison.com/archives/2014/07/15/tip-bringing-your-working-directory-pwd-to-another-terminal-window-in-mac-os</id>
    <content type="html"><![CDATA[<p>Mac OS, as far as I can remember, used to start tabbed Terminal sessions and put you into the working directory of your last tab.  New Terminal windows didn&rsquo;t do this but recently new Terminal tabs stopped doing it too.</p>

<p>I got tired of renavigating to the paths in the projects I was working on and I didn&rsquo;t want to launch a Terminal from within a Terminal so I came up with something else.  I added a few lines to my <code>.bash_profile</code> and now I have two new commands.  <code>ccd</code> copies your current directory to the clipboard, and <code>pcd</code> pastes your clipboard into the <code>cd</code> command.</p>

<p>Now when I&rsquo;m in a deep directory tree like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>super-dooper-long-path/with/other-path/stuff/in/it $</span></code></pre></td></tr></table></div></figure>


<p>I can do this in the existing Terminal:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>super-dooper-long-path/with/other-path/stuff/in/it $ ccd</span></code></pre></td></tr></table></div></figure>


<p>And this in the new Terminal:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ pcd
</span><span class='line'>super-dooper-long-path/with/other-path/stuff/in/it $</span></code></pre></td></tr></table></div></figure>


<p>And there you have it.  Back into my beloved directory in no time.  Here&rsquo;s what I added to <code>.bash_profile</code>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>alias ccd="pwd | pbcopy"
</span><span class='line'>alias pcd="paste_cd"
</span><span class='line'>
</span><span class='line'>function paste_cd() {
</span><span class='line'>        cd "`pbpaste`"
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>The <code>ccd</code> alias just pipes <code>pwd</code> into <code>pbcopy</code>, which is one of the best tools ever, so that it ends up in the clipboard.</p>

<p>The <code>pcd</code> alias is a little more complex.  If you try to do this without a bash function your alias will get evaluated as soon as your shell starts.  This means that when you open your shell whatever is in your clipboard will be what <code>pcd</code> tries to <code>cd</code> to.  Using a function we let it run <code>pbpaste</code> when it is called so it always uses the up-to-date info.</p>

<p>Enjoy!  Let me know if you find it useful!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Automating Cisco Switch Interactions]]></title>
    <link href="http://blog.timmattison.com/archives/2014/06/25/automating-cisco-switch-interactions/"/>
    <updated>2014-06-25T19:03:09-04:00</updated>
    <id>http://blog.timmattison.com/archives/2014/06/25/automating-cisco-switch-interactions</id>
    <content type="html"><![CDATA[<p>Recently I needed to find a way to reboot an embedded device remotely.  The trick was that we didn&rsquo;t have a handy <a href="http://www.digital-loggers.com/lpc.html">Web Power Switch</a> and the device was PoE.  I figured that I&rsquo;d just quickly slap together a script to telnet to the switch&rsquo;s management interface and simulate a few simple commands.  To make a long story short SSH was the only option which complicated things a bit.</p>

<p>Fortunately for me <a href="http://blog.timmattison.com/archives/2014/02/13/how-to-execute-a-command-on-a-remote-server-that-requires-you-to-su-or-sudo/">I had already written an article about this</a> but that turned out only to be a starting point as the script just wouldn&rsquo;t work out of the box with Cisco&rsquo;s SSH server.</p>

<p>In the end I found a few very interesting things out about Paramiko and Cisco&rsquo;s SSH server.  Using Paramiko with a Cisco switch through out a bunch of errors like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Traceback (most recent call last):
</span><span class='line'>  File "/Applications/PyCharm.app/helpers/pydev/pydevd.py", line 1733, in &lt;module&gt;
</span><span class='line'>    debugger.run(setup['file'], None, None)
</span><span class='line'>  File "/Applications/PyCharm.app/helpers/pydev/pydevd.py", line 1226, in run
</span><span class='line'>    pydev_imports.execfile(file, globals, locals)  # execute the script
</span><span class='line'>  File "poe-state.py", line 69, in &lt;module&gt;
</span><span class='line'>    client.connect(switch_ip_address, username=username, password=password, look_for_keys=True)
</span><span class='line'>  File "/usr/local/lib/python2.7/site-packages/paramiko/client.py", line 273, in connect
</span><span class='line'>    self._auth(username, password, pkey, key_filenames, allow_agent, look_for_keys)
</span><span class='line'>  File "/usr/local/lib/python2.7/site-packages/paramiko/client.py", line 456, in _auth
</span><span class='line'>    raise saved_exception
</span><span class='line'>paramiko.ssh_exception.AuthenticationException: Authentication failed.</span></code></pre></td></tr></table></div></figure>


<p>If you are seeing <code>Authentication failed</code> messages while using Paramiko and you are certain your credentials are correct you may be running into the same problem I was.  The issue is that Paramiko tries to use your SSH keys to do public key authentication before it tries to use your password.  Normally, this doesn&rsquo;t cause an issue because if it fails one authentication method it just moves onto trying the next authentication method.  Due to a quirk in both Paramiko and Cisco&rsquo;s SSH server implementation Paramiko gets confused after the public key authentication failure and gives up.  I figured this out by turning on full debugging in Paramiko like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>paramiko.common.logging.basicConfig(level=paramiko.common.DEBUG)</span></code></pre></td></tr></table></div></figure>


<p>This is an incredibly handy flag if you ever need to debug Paramiko yourself so keep it around!</p>

<p>Anyway, the solution is normally to add the <code>look_for_keys=False</code> option to your Paramiko connect call.  However, as I found out that works on some systems and not others.  To be certain that it only tried password authentication I needed to also add the <code>allow_agent=False</code> flag.</p>

<p>The other quirk I hit was that my script initially waited forever for a response when I sent it commands that had a lot of output.  This was because the Cisco shell&rsquo;s pager was on.  Turning it off meant sending one additional command <code>terminal length 0\n</code>.</p>

<p>In the end I ended up with a script that lets me check the PoE state of a port and enable/disable PoE on a per port basis.  If you need a script that does that it is included below.  Two important points to remember are that I only needed to use this on interfaces that start with <code>Gi1/0/</code> so that value is hardcoded and you&rsquo;ll need to change it if your switch is different.  You will also need to install my little Python library called <a href="https://pypi.python.org/pypi/pyuda/0.1dev">pyuda</a> because I use it to process the command-line arguments.  Rip that out if you want to simplify things.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/env python</span>
</span><span class='line'>
</span><span class='line'><span class="n">__author__</span> <span class="o">=</span> <span class="s">&#39;timmattison&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">pyuda</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">re</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">paramiko</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">sys</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">time</span>
</span><span class='line'>
</span><span class='line'><span class="c"># For debugging only</span>
</span><span class='line'><span class="c"># paramiko.common.logging.basicConfig(level=paramiko.common.DEBUG)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># This is part of the regex we use to look for the interfaces we care about</span>
</span><span class='line'><span class="n">interface_regex</span> <span class="o">=</span> <span class="s">&quot;Gi1\/0\/&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c"># These are the operation we support</span>
</span><span class='line'><span class="n">status_operation</span> <span class="o">=</span> <span class="s">&quot;status&quot;</span>
</span><span class='line'><span class="n">on_operation</span> <span class="o">=</span> <span class="s">&quot;on&quot;</span>
</span><span class='line'><span class="n">off_operation</span> <span class="o">=</span> <span class="s">&quot;off&quot;</span>
</span><span class='line'><span class="n">valid_operations</span> <span class="o">=</span> <span class="p">[</span><span class="n">status_operation</span><span class="p">,</span> <span class="n">on_operation</span><span class="p">,</span> <span class="n">off_operation</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">send_string_and_wait_for_string</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">wait_string</span><span class="p">,</span> <span class="n">should_print</span><span class="p">):</span>
</span><span class='line'>    <span class="c"># Send the su command</span>
</span><span class='line'>    <span class="n">shell</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Create a new receive buffer</span>
</span><span class='line'>    <span class="n">receive_buffer</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">while</span> <span class="ow">not</span> <span class="n">wait_string</span> <span class="ow">in</span> <span class="n">receive_buffer</span><span class="p">:</span>
</span><span class='line'>        <span class="c"># Flush the receive buffer</span>
</span><span class='line'>        <span class="n">receive_buffer</span> <span class="o">+=</span> <span class="n">shell</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Print the receive buffer, if necessary</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">should_print</span><span class="p">:</span>
</span><span class='line'>        <span class="k">print</span> <span class="n">receive_buffer</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">receive_buffer</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">validate_operation</span><span class="p">(</span><span class="n">operation</span><span class="p">):</span>
</span><span class='line'>    <span class="c"># Is this an operation we support?</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="ow">not</span> <span class="n">operation</span> <span class="ow">in</span> <span class="n">valid_operations</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># No, tell them and bail out</span>
</span><span class='line'>        <span class="k">print</span> <span class="n">operation</span> <span class="o">+</span> <span class="s">&quot; is not a valid operation&quot;</span>
</span><span class='line'>        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Get the command-line arguments</span>
</span><span class='line'><span class="n">switch_ip_address</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">operation</span><span class="p">,</span> <span class="n">port_number</span> <span class="o">=</span> <span class="n">pyuda</span><span class="o">.</span><span class="n">get_command_line_arguments</span><span class="p">([</span><span class="s">&quot;Switch IP address&quot;</span><span class="p">,</span> <span class="s">&quot;Admin username&quot;</span><span class="p">,</span> <span class="s">&quot;Admin password&quot;</span><span class="p">,</span> <span class="n">status_operation</span> <span class="o">+</span> <span class="s">&quot;, &quot;</span> <span class="o">+</span> <span class="n">on_operation</span> <span class="o">+</span> <span class="s">&quot;, or &quot;</span> <span class="o">+</span> <span class="n">off_operation</span><span class="p">,</span> <span class="s">&quot;Port number&quot;</span><span class="p">])</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Make sure the operation makes sense</span>
</span><span class='line'><span class="n">validate_operation</span><span class="p">(</span><span class="n">operation</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Create an SSH client</span>
</span><span class='line'><span class="n">client</span> <span class="o">=</span> <span class="n">paramiko</span><span class="o">.</span><span class="n">SSHClient</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Make sure that we add the remote server&#39;s SSH key automatically</span>
</span><span class='line'><span class="n">client</span><span class="o">.</span><span class="n">set_missing_host_key_policy</span><span class="p">(</span><span class="n">paramiko</span><span class="o">.</span><span class="n">AutoAddPolicy</span><span class="p">())</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Connect to the client</span>
</span><span class='line'><span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">switch_ip_address</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">,</span> <span class="n">allow_agent</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">look_for_keys</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Create a raw shell</span>
</span><span class='line'><span class="n">shell</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">invoke_shell</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Wait for the prompt</span>
</span><span class='line'><span class="n">send_string_and_wait_for_string</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;#&quot;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Disable more</span>
</span><span class='line'><span class="n">send_string_and_wait_for_string</span><span class="p">(</span><span class="s">&quot;terminal length 0</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;#&quot;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Which command are we trying to run?</span>
</span><span class='line'><span class="k">if</span><span class="p">((</span><span class="n">operation</span> <span class="o">==</span> <span class="n">on_operation</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">operation</span> <span class="o">==</span> <span class="n">off_operation</span><span class="p">)):</span>
</span><span class='line'>    <span class="c"># Trying to do on or off</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Send the &quot;conf t&quot; command</span>
</span><span class='line'>    <span class="n">send_string_and_wait_for_string</span><span class="p">(</span><span class="s">&quot;conf t</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;(config)#&quot;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Send the interface command</span>
</span><span class='line'>    <span class="n">send_string_and_wait_for_string</span><span class="p">(</span><span class="s">&quot;interface Gi1/0/&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">port_number</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;(config-if)#&quot;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Build the power command</span>
</span><span class='line'>    <span class="n">power_command</span> <span class="o">=</span> <span class="s">&quot;power inline &quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># What kind of operation is this?</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">operation</span> <span class="o">==</span> <span class="n">off_operation</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># Power off, &quot;never&quot; means off</span>
</span><span class='line'>        <span class="n">power_command</span> <span class="o">+=</span> <span class="s">&quot;never&quot;</span>
</span><span class='line'>    <span class="k">else</span><span class="p">:</span>
</span><span class='line'>        <span class="c"># Power on, &quot;auto&quot; means on (there are other options but this is the simplest)</span>
</span><span class='line'>        <span class="n">power_command</span> <span class="o">+=</span> <span class="s">&quot;auto&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Add the carriage return</span>
</span><span class='line'>    <span class="n">power_command</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Send the power command</span>
</span><span class='line'>    <span class="n">send_string_and_wait_for_string</span><span class="p">(</span><span class="n">power_command</span><span class="p">,</span> <span class="s">&quot;(config-if)#&quot;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
</span><span class='line'><span class="k">elif</span><span class="p">(</span><span class="n">operation</span> <span class="o">==</span> <span class="n">status_operation</span><span class="p">):</span>
</span><span class='line'>    <span class="c"># Get the status of all of the PoE ports</span>
</span><span class='line'>    <span class="n">power_data</span> <span class="o">=</span> <span class="n">send_string_and_wait_for_string</span><span class="p">(</span><span class="s">&quot;show power inline</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;#&quot;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Split the data into lines</span>
</span><span class='line'>    <span class="n">power_data_lines</span> <span class="o">=</span> <span class="n">power_data</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># We haven&#39;t found what we&#39;re looking for yet</span>
</span><span class='line'>    <span class="n">found</span> <span class="o">=</span> <span class="bp">False</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Loop through all of the lines</span>
</span><span class='line'>    <span class="k">for</span> <span class="n">power_data_line</span> <span class="ow">in</span> <span class="n">power_data_lines</span><span class="p">:</span>
</span><span class='line'>        <span class="c"># Does this look like the interface we want?</span>
</span><span class='line'>        <span class="k">if</span><span class="p">(</span><span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&quot;^&quot;</span> <span class="o">+</span> <span class="n">interface_regex</span> <span class="o">+</span> <span class="n">port_number</span> <span class="o">+</span> <span class="s">&quot;\s&quot;</span><span class="p">,</span> <span class="n">power_data_line</span><span class="p">)):</span>
</span><span class='line'>            <span class="c"># No, keep going</span>
</span><span class='line'>            <span class="k">continue</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Found the interface we want, split up the fields</span>
</span><span class='line'>        <span class="n">power_data_fields</span> <span class="o">=</span> <span class="n">power_data_line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Get the second field which is the power state field and print it</span>
</span><span class='line'>        <span class="k">print</span> <span class="n">power_data_fields</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># We found what we needed</span>
</span><span class='line'>        <span class="n">found</span> <span class="o">=</span> <span class="bp">True</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># Get out of the for loop</span>
</span><span class='line'>        <span class="k">break</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Did we find what we needed?</span>
</span><span class='line'>    <span class="k">if</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
</span><span class='line'>        <span class="c"># No, let the user know</span>
</span><span class='line'>        <span class="k">print</span> <span class="s">&quot;Did not find port &quot;</span> <span class="o">+</span> <span class="n">port_number</span>
</span><span class='line'>
</span><span class='line'><span class="k">else</span><span class="p">:</span>
</span><span class='line'>    <span class="c"># This is an operation we didn&#39;t handle</span>
</span><span class='line'>    <span class="k">print</span> <span class="n">operation</span> <span class="o">+</span> <span class="s">&quot; not handled&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Close the SSH connection</span>
</span><span class='line'><span class="n">client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Advanced Port Forwarding With SSH]]></title>
    <link href="http://blog.timmattison.com/archives/2014/06/20/advanced-port-forwarding-with-ssh/"/>
    <updated>2014-06-20T06:38:14-04:00</updated>
    <id>http://blog.timmattison.com/archives/2014/06/20/advanced-port-forwarding-with-ssh</id>
    <content type="html"><![CDATA[<p><strong><em>NOTE</em></strong>: This has all been done on a Mac running OS 10.9.  YMMV on other operating systems or versions.</p>

<p>If you&rsquo;ve ever had to use an SSH server as a jump off point, possibly to get to machines that don&rsquo;t have a public IP address, then you know that it can be complicated to set up, manage, and annoying if you need to access a lot of machines and/or a lot of different services.  Typically, using local port forwarding you can do something like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ssh -L8080:REMOTE_PRIVATE_SERVER:80 USER@REMOTE_PUBLIC_SERVER</span></code></pre></td></tr></table></div></figure>


<p>That will let you connect to localhost on port 8080 to get to <code>REMOTE_PRIVATE_SERVER</code>&rsquo;s port 80 service.  What if you needed to get to two services?  You start stacking them up:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ssh -L8080:REMOTE_PRIVATE_SERVER:80 -L8181:ANOTHER_REMOTE_PRIVATE_SERVER:80 USER@REMOTE_PUBLIC_SERVER</span></code></pre></td></tr></table></div></figure>


<p>Now you can get to <code>REMOTE_PRIVATE_SERVER</code>&rsquo;s port 80 service and <code>ANOTHER_REMOTE_PRIVATE_SERVER</code>&rsquo;s port 80 service.  You just have to configure your applications to use ports 8080 and 8181 on localhost instead of port 80 on the two remote hosts.</p>

<p>Wouldn&rsquo;t it be nice if you could not worry about re-mapping ports and could just connect to <code>REMOTE_PRIVATE_SERVER</code> and <code>ANOTHER_REMOTE_PRIVATE_SERVER</code> as if they were hosts on your network?  SSH does offer you a way to do this but I have never seen it documented anywhere.  There is <a href="http://www.securitybulletins.com/mediawiki/index.php/SSH_Tunnelling#Using_SSH_to_build_a_Virtual_Private_Network_.28VPN.29">a way to create a VPN using pppd</a> and <a href="http://www.securitybulletins.com/mediawiki/index.php/SSH_Tunnelling#Using_SSH_to_emulate_a_SOCKS_proxy">a way to use SOCKS</a> but those are no fun.  I don&rsquo;t want to use pppd and I have applications that don&rsquo;t support SOCKS.</p>

<p>rsync and other applications that depend on SSH can be particularly tricky.  On top of the command-line options you need to pass to your main application you need to pass options to SSH directly (not so bad), use each applications special syntax to pass those options to SSH (really bad), or convince the application to shell out to the OS with a specific command-line you&rsquo;ve concocted for SSH (also really bad).</p>

<p>Instead, what I do is I make use of the 127.0.0.0/8 address space that is available to everyone but rarely used.  You can always use 127.0.0.1 to access your local machine but you may not realize that you can bind to all of the rest of the addresses in that space.</p>

<p>I need to set up some terminology so this will be easier to discuss.  The machine that you&rsquo;re SSHing will be the &ldquo;source machine&rdquo;.  The machine that is publicly accessible on the remote network that you SSH into will be called the &ldquo;gateway machine&rdquo;.  The machine that provides the remote service that only has a private IP address will be called the &ldquo;destination machine&rdquo;.</p>

<p>My first use case is that the source machine wants to connect to a web server on the destination machine but I want to do it on port 80.  We can do this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo ifconfig lo0 alias 127.0.0.2
</span><span class='line'>sudo ssh -L127.0.0.2:80:DESTINATION_MACHINE:80 user@GATEWAY_MACHINE</span></code></pre></td></tr></table></div></figure>


<p>That first line creates an alias IP address of <code>127.0.0.2</code> on your <code>lo0</code> interface.  Then we ssh to the gateway machine and port forward the destination machine&rsquo;s port 80 to <code>127.0.0.1</code>.  Since 80 is a privileged port you need to sudo your ssh session.</p>

<p>Now instead of having to point our browser to something like <code>localhost:9000</code> we can point our browser directly to <code>127.0.0.2</code>.  What can we do this to make it even better?  Create a host entry for <code>127.0.0.2</code> that gives it a descriptive name like <code>remote_application_server</code>.</p>

<p>Is that not enough?  How about this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo ifconfig lo0 alias 127.0.0.2
</span><span class='line'>sudo ssh -L127.0.0.2:22:DESTINATION_MACHINE:22 user@GATEWAY_MACHINE</span></code></pre></td></tr></table></div></figure>


<p>All that changed here is the port number.  It was 80 and now it is 22 which is the ssh port.  Now you can ssh to this machine in one step like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ssh user@127.0.0.2</span></code></pre></td></tr></table></div></figure>


<p>This also means that you can sftp, scp, and rsync directly to that IP address.  Without this trick to rsync you&rsquo;d need to do something like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rsync -rvz -e 'ssh -p 2222' ./dir user@host:/dir</span></code></pre></td></tr></table></div></figure>


<p>It may not seem like much but if you have to do it a lot it can get ugly.  Especially since it is one of those options you always forget since you don&rsquo;t use it that often.</p>

<p>I&rsquo;m thinking about scripting the IP aliasing and port forwarding so that it can be specified in a simple configuration file.  If you&rsquo;re interested in that post in the comments below and let me know!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Forcing Java's Logger to Work, Even When It Doesn't Want To]]></title>
    <link href="http://blog.timmattison.com/archives/2014/06/19/forcing-javas-logger-to-work-even-when-it-doesnt-want-to/"/>
    <updated>2014-06-19T18:31:42-04:00</updated>
    <id>http://blog.timmattison.com/archives/2014/06/19/forcing-javas-logger-to-work-even-when-it-doesnt-want-to</id>
    <content type="html"><![CDATA[<p>If you do any Java development I&rsquo;m sure you&rsquo;ve run into a situation where the logger just does not do what you want it to do.  Sometimes you can&rsquo;t get it to print messages other than <code>INFO</code> level messages, sometimes you can&rsquo;t get it to print anything to the console at all.</p>

<p>In order to get around this I have a few convenience methods that I&rsquo;ve migrated from project to project that I wanted to share.  Soon I&rsquo;ll put them in <a href="https://github.com/timmattison/jayuda">Jayuda</a> when I revamp it.  For now, you can just copy them from the blocks below.</p>

<p><strong><em>NOTE:</em></strong> All of this info is for plain <code>java.util.logging</code>.  If you are using another logging system this probably won&rsquo;t work for you.</p>

<p>The first function makes sure that there is at least one console logger in your logging system.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public static void forceConsoleLogging() {
</span><span class='line'>    // Get the root logger instance
</span><span class='line'>    LogManager logManager = LogManager.getLogManager();
</span><span class='line'>    Logger rootLogger = logManager.getLogger("");
</span><span class='line'>    
</span><span class='line'>    // Set the default logging level to all
</span><span class='line'>    rootLogger.setLevel(Level.ALL);
</span><span class='line'>
</span><span class='line'>    // Loop and see if a console handler is already installed
</span><span class='line'>    boolean consoleHandlerInstalled = false;
</span><span class='line'>
</span><span class='line'>    for (Handler handler : rootLogger.getHandlers()) {
</span><span class='line'>        if (handler instanceof ConsoleHandler) {
</span><span class='line'>            consoleHandlerInstalled = true;
</span><span class='line'>            break;
</span><span class='line'>        }
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    // Is a console handler already installed?
</span><span class='line'>    if (consoleHandlerInstalled) {
</span><span class='line'>        // Yes, do nothing
</span><span class='line'>        return;
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    // No console handler installed, install one
</span><span class='line'>    rootLogger.addHandler(new ConsoleHandler());
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>The second function is a bit more aggressive.  It iterates over your console loggers and makes sure all of them log everything.  You can use this in a pinch when you&rsquo;re having serious issues and you need to see everything.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>   public static void logEverything() {
</span><span class='line'>        // Get the logger instance
</span><span class='line'>        LogManager logManager = LogManager.getLogManager();
</span><span class='line'>        Logger rootLogger = logManager.getLogger("");
</span><span class='line'>
</span><span class='line'>        // Set the default logging level to all
</span><span class='line'>        rootLogger.setLevel(Level.ALL);
</span><span class='line'>
</span><span class='line'>        // Loop and see if any console handlers are already installed
</span><span class='line'>        List&lt;ConsoleHandler&gt; consoleHandlers = new ArrayList&lt;ConsoleHandler&gt;();
</span><span class='line'>
</span><span class='line'>        for (Handler handler : rootLogger.getHandlers()) {
</span><span class='line'>            if (handler instanceof ConsoleHandler) {
</span><span class='line'>                consoleHandlers.add((ConsoleHandler) handler);
</span><span class='line'>            }
</span><span class='line'>        }
</span><span class='line'>
</span><span class='line'>        // Is a console handler already installed?
</span><span class='line'>        if (consoleHandlers.size() == 0) {
</span><span class='line'>            // No, create one.  Add it to the list and to the root logger.
</span><span class='line'>            Handler consoleHandler = new ConsoleHandler();
</span><span class='line'>            consoleHandlers.add((ConsoleHandler) consoleHandler);
</span><span class='line'>            rootLogger.addHandler(consoleHandler);
</span><span class='line'>        }
</span><span class='line'>
</span><span class='line'>        // Loop through all console handlers and make them log everything
</span><span class='line'>        for (ConsoleHandler consoleHandler : consoleHandlers) {
</span><span class='line'>            consoleHandler.setLevel(Level.ALL);
</span><span class='line'>        }
</span><span class='line'>    }</span></code></pre></td></tr></table></div></figure>


<p>If you do this be prepared to see TONS of output including output from all of the libraries you use.  Most of the time this is overkill.  But sometimes when the logger just won&rsquo;t do what you want no matter how hard you try this will save your sanity.</p>

<p>Have better ways to do this?  Did this get you out of a jam?  Please post in the comments below.</p>

<p>UPDATE: <a href="https://github.com/timmattison/jayuda/commit/1484b47d72c6f5943340eebc8d78fafaa9604485">Added to Jayuda</a>!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[A Collection of Software Testing and Dependency Injection Videos That All Developers Should Watch]]></title>
    <link href="http://blog.timmattison.com/archives/2014/06/19/a-collection-of-software-testing-and-dependency-injection-videos-that-all-developers-should-watch/"/>
    <updated>2014-06-19T07:06:23-04:00</updated>
    <id>http://blog.timmattison.com/archives/2014/06/19/a-collection-of-software-testing-and-dependency-injection-videos-that-all-developers-should-watch</id>
    <content type="html"><![CDATA[<p>I often get asked about what recommendations I would make to people to make them better developers.  After working on a very large project last year I have consistently told people that no matter what platform they use they should work on and think about two things: software testing and dependency injection.</p>

<p>Software testing includes unit tests, integration tests, regression tests, human testing, and a lot more.  It is a broad set of topics that is hard to distill into just a few bits that will always be applicable.</p>

<p>But how about getting people to write code that is testable?  Testability is an easy concept to gloss over.  While there is a stigma associated with writing code that has no test coverage there is nowhere near as much of a stigma for having to jump through endless hoops to get your software to be tested.  In fact, these hoops combined with time pressure are probably why a lot of developers don&rsquo;t do proper testing.</p>

<p>There are three things that you can do immediately to start writing more testable code.  First, <a href="https://en.wikipedia.org/wiki/SOLID_(object-oriented_design">learn the SOLID principle</a> and if you need tighter focus then just start with S (single responsibility principle) and D (dependency inversion principle).  Second, use a <a href="https://en.wikipedia.org/wiki/Dependency_injection">dependency injection</a> framework (AKA &ldquo;DI framework&rdquo;).  Third, try to follow the <a href="https://en.wikipedia.org/wiki/Law_of_Demeter">Law of Demeter</a> as much as possible.</p>

<p>Here are some dependency injection framework recommendations:</p>

<ul>
<li>For Java developers I recommend <a href="https://code.google.com/p/google-guice/">Guice</a>.</li>
<li>For Android developers I recommend <a href="https://square.github.io/dagger/">Dagger</a>.</li>
<li>For .NET developers I recommend <a href="http://www.ninject.org/">Ninject</a>.</li>
</ul>


<p>Those Wikipedia links are only meant for basic information on the topics.  Once you&rsquo;re ready to learn about these principles you can get a serious head start by watching a few videos.  The videos by Misko Hevery are some of my favorites and they&rsquo;re 30 minutes versus 60 minutes which is a little easier to carve out of your day.  I suggest watching those first.</p>

<p>These videos are all part of the <a href="https://www.youtube.com/channel/UCtXKDgv1AVoG88PLl8nGXmw">Google Tech Talk</a> series.</p>

<p>30 minute sessions with Misko:</p>

<ul>
<li><a href="http://www.youtube.com/watch?v=RlfLCWKxHJ0">Don’t look for things</a> &ndash; Discusses how the object model of a system may be broken if you’re not directly handed what your object needs to get its job done.  In the best case this is handled automatically by dependency injection which makes it so you’re never shuffling in and out constructor argument lists as you swap implementations.</li>
<li><a href="http://www.youtube.com/watch?v=-FRm3VPhseI">Global State and Singletons</a> &ndash; Discusses how global state can silently break tests and how to try to avoid it</li>
<li><a href="http://www.youtube.com/watch?v=wEhu57pih5w">Unit Testing</a> &ndash; Discusses how unit tests should be structured and that the goal should be to have unit tests that run so fast that you’re running them all the time.  Integration tests and user simulations will still take longer but you should always try to write unit tests that run in milliseconds when possible.  An interesting fact that he drops in this talk, I think, is that Google’s set of tests for a project are often as large as or even larger than the actual project itself.</li>
<li><a href="http://www.youtube.com/watch?v=4F72VULWFvc">Inheritance, Polymorphism, &amp; Testing</a> &ndash; Discusses how dense code can be unraveled with polymorphism and how that can make it easier to test and get complete testing coverage</li>
</ul>


<p>60 minute sessions:</p>

<ul>
<li><a href="http://www.youtube.com/watch?v=hBVJbzAagfs">Big Modular Java with Guice</a> &ndash; Discusses how to use Guice to write maintainable, large Java projects</li>
<li><a href="http://www.youtube.com/watch?v=0iSB0L9avmg">Java on Guice: Dependency Injection, the Java Way</a> &ndash; One of the earlier Guice talks that compares and contrasts using Guice with the non-DI way</li>
<li><a href="https://www.youtube.com/watch?v=XcT4yYu_TTs">How to Write Clean, Testable Code</a> &ndash; Discusses the Law of Demeter, and getting buried in setup code</li>
</ul>


<p>Have any other recommendations?  Please post them in the comments below!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Use Git to Figure Out What You Did Yesterday]]></title>
    <link href="http://blog.timmattison.com/archives/2014/06/18/use-git-to-figure-out-what-you-did-yesterday/"/>
    <updated>2014-06-18T09:10:21-04:00</updated>
    <id>http://blog.timmattison.com/archives/2014/06/18/use-git-to-figure-out-what-you-did-yesterday</id>
    <content type="html"><![CDATA[<p>Are you a developer?  Do you have trouble remembering what you did yesterday when it is time for your daily standup?  Do you use git?  Do you commit regularly?  If you answered yes to those questions you can now quickly figure out what you did yesterday with the help of <a href="https://github.com/timmattison/gitrdun">gitrdun</a>.</p>

<p>gitrdun simply looks for git repos in your home directory, lists all of the commits in those repos from yesterday, and then prints that on the screen.  The current iteration is the &ldquo;5 minute version&rdquo;.  It literally took 5 minutes to write.  The &ldquo;5 hour version&rdquo; may make the formatting a bit nicer and add some features but don&rsquo;t hold your breath for that to come out.</p>

<p>Don&rsquo;t want to fork the repo?  No problem, it&rsquo;s just a one liner anyway.  Use this alias&hellip;</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>alias gitrdun="clear ; PAGER=\"cat\" find ~ -name \".git\" -type d -exec sh -c \"cd '{}' ; echo '{}'; git log --all --since='yesterday'\" \; | less"</span></code></pre></td></tr></table></div></figure>


<p>This clears the screen, uses &ldquo;cat&rdquo; as the pager so that the pager doesn&rsquo;t clear the screen between repo checks, finds all git repos, goes into their directory that is under version control, and then lists all commits on all branches from yesterday.</p>

<p>Enjoy!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Octal and Hexadecimal IP Addresses With Ping]]></title>
    <link href="http://blog.timmattison.com/archives/2014/06/18/octal-and-hexadecimal-ip-addresses-with-ping/"/>
    <updated>2014-06-18T07:12:14-04:00</updated>
    <id>http://blog.timmattison.com/archives/2014/06/18/octal-and-hexadecimal-ip-addresses-with-ping</id>
    <content type="html"><![CDATA[<p>Have you ever seen a system print out an IP address like this?</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Disconnected from 010.000.001.133</span></code></pre></td></tr></table></div></figure>


<p>If you try to ping this IP address you&rsquo;ll get quite interesting results.  What the IP address should be is 10.0.1.133 but what ping reports that it is if you run the command with those leading zeroes included looks very odd.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>timmattison$ ping 010.000.001.133
</span><span class='line'>PING 010.000.001.133 (8.0.1.133): 56 data bytes
</span><span class='line'>Request timeout for icmp_seq 0</span></code></pre></td></tr></table></div></figure>


<p>See that <code>8.0.1.133</code> IP address that it is trying to reach?  It turns out that if you put leading zeroes into an IP address that you pass to <code>ping</code>, and possibly other network tools, it treats those numbers as <a href="https://en.wikipedia.org/wiki/Octal">octal</a>.  Octal isn&rsquo;t something most end-users deal with unless they&rsquo;re reminiscing about their old <a href="https://en.wikipedia.org/wiki/CompuServe">Compuserve</a> addresses.</p>

<p>In any case, if you find yourself trying to ping a machine with an IP address that has leading zeroes make sure you remove them!</p>

<p>This got me wondering what other weird things ping might do with IP addresses so I played around a bit and saw that it actually allows you to enter them in hex as well.  This is useful for IPv6 but really strange for IPv4.  Try it out and try to ping the above address with the first octet in hex:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>timmattison$ ping 0xa.0.1.133
</span><span class='line'>PING 0xa.0.1.133 (10.0.1.133): 56 data bytes</span></code></pre></td></tr></table></div></figure>


<p>Sure enough it converts <code>0xa</code> into <code>10</code>.  I&rsquo;m not sure I&rsquo;ll ever use that feature but its good to know what ping does to its input in the even that some other weird situation pops up.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[My Problem With 'the Problem With Altcoins']]></title>
    <link href="http://blog.timmattison.com/archives/2014/06/18/my-problem-with-the-problem-with-altcoins/"/>
    <updated>2014-06-18T00:00:00-04:00</updated>
    <id>http://blog.timmattison.com/archives/2014/06/18/my-problem-with-the-problem-with-altcoins</id>
    <content type="html"><![CDATA[<p>TL;DR &ndash; The author&rsquo;s strongest argument is that some altcoins are junk.  This unfortunately then morphs into saying that all altcoins are junk and none of them can ever be good.  In my opinion that is going too far.</p>

<p>On the Google Plus Bitcoin community someone posted a link to <a href="http://themisescircle.org/blog/2013/08/22/the-problem-with-altcoins/">The Problem with Altcoins</a>.  I think this article is complete link bait based on the fact that the first paragraph is titled &ldquo;Why no altcoin can succeed&rdquo; but nevertheless I&rsquo;d like to address a few of the things in it because they could be confusing to people new to the cryptocurrency space.</p>

<p>I&rsquo;ll preface this post by saying that I hold a few Bitcoins, some Litecoins, and some Feathercoins.  I bought most of them to play around with and not as a serious investment so I&rsquo;m not here to tell you that any of these things are a solid investment.  If you are like me you want to get into cryptocurrencies because they&rsquo;re interesting and understanding them gives me new ways to approach problems that I see in software development.</p>

<p>Issue #1:</p>

<blockquote><p>Quite simply, a medium of exchange that is more widely accepted on the market is more useful than one which is not. This is known as the network effect. Thus, an initial imbalance between two nearly equal media of exchange will benefit whichever is more widely accepted until a single one overwhelms the rest.</p></blockquote>

<p>This paragraph does quite a good job of shooting itself down unknowingly.  I agree with the statement &ldquo;a medium of exchange that is more widely accepted on the market is more useful than one that is not&rdquo;.  The leap that it then goes to make isn&rsquo;t very well thought out.  Just because something is better does not mean that eventually it will be the only thing.  If that was the case then why are there so many different brands of any product you can think of?</p>

<p>The end of this paragraph is its complete downfall.  It states &ldquo;until a single one overwhelms the rest&rdquo;.  There is no example of this happening as far as I know.  Is there only one currency in the world?  You might think the world currency is the US Dollar but I can assure you it isn&rsquo;t.  Admittedly it does say it will &ldquo;overwhelm&rdquo; the rest and not &ldquo;extinguish&rdquo; the rest but I believe overwhelm here was meant to imply that the others would disappear.</p>

<p>My stance: There is room for more than one physical currency.  There is room for more than one digital currency.</p>

<p>Issue #2:</p>

<blockquote><p>Furthermore, a truly great innovation would much better serve people by being incorporated into future versions of Bitcoin rather than by requiring them to switch to something else</p></blockquote>

<p>This makes the assumption that just because a feature benefits someone that it will be incorporated.  Since the interests of each individual are different you could have features that benefit some (shorter confirmation times, lower transaction fees, anonymity, etc) that do not benefit others.  In fact, one of these features mentioned later is Zerocoin which provides anonymous transactions.  Some would argue that if this was incorporated into Bitcoin that it would set it back a few years as the media picked it up again as the anonymous currency used by drug dealers and terrorists.</p>

<p>Other kinds of transactions like creating &ldquo;<a href="http://bitcoin.stackexchange.com/questions/10986/what-is-meant-by-bitcoin-dust">dust</a>&rdquo; to sign arbitrary bits of data to use the block chain as a kind of digital notary are probably best implemented in a different system altogether.</p>

<p>My stance: Not all features should be incorporated into Bitcoin.  Blockchain bloat is already a bit of a problem and I think we need to minimize it.</p>

<p>Issue #3:</p>

<blockquote><p>Can anyone really expect to create something of value by rereleasing Bitcoin under a new name and with a few tiny changes to its source code?</p></blockquote>

<p>Actually, I&rsquo;m in total agreement here.  There are altcoins that are just knockoffs that don&rsquo;t add any value.  Don&rsquo;t translate my issue with the statement &ldquo;Why no altcoin can succeed&rdquo; into &ldquo;All altcoins should succeed&rdquo;.  I think the market is the place to decide that.</p>

<p>My stance: Some altcoins are useful and interesting.  Some altcoins are not.  I doubt <a href="https://en.wikipedia.org/wiki/Dogecoin">Dogecoin</a> will survive as long as Litecoin.</p>

<p>Issue #4:</p>

<blockquote><p>What is a cryptocurrency actually for? I say that its purpose is to become money. It is obvious that creating altcoins impedes that purpose. Altcoins can only be explained if we believe the purpose of cryptocurrencies is to make money rather than to become money.</p></blockquote>

<p>(Premining)[<a href="https://bitcointalk.org/index.php?topic=194023.0">https://bitcointalk.org/index.php?topic=194023.0</a>] has rightly tainted people&rsquo;s views of altcoins.  If you premine your new cryptocurrency then you are probably just in it for the money.  Granted maybe not enough people knew about your coin when it started but with a public announcement and some planning you can avoid this.  Going back to my previous point I don&rsquo;t understand why Bitcoin gets a pass on this.  What if the original motivation was exactly the same as the altcoins that are guilty of premining?  We can&rsquo;t know if that was or was not the case until we know the true identity of Satoshi Nakamoto.</p>

<p>A lot of the time when people tell me something is &ldquo;obvious&rdquo; it&rsquo;s because they&rsquo;re trying to glaze over the fact that their explanation and understanding of the concept is lacking.  I prefer proof rather than assertions.</p>

<p>My stance: Same as issue #3.  Some altcoins are junk, some altcoins are not.  The market will decide which ones are the winners.  The author references the Wikipedia page for &ldquo;<a href="https://en.wikipedia.org/wiki/Motivated_reasoning">motivated reasoning</a>.  Indeed either side of the argument could say the other is doing this especially when they assert the obviousness of the fact that they are right.</p>

<p>Issue #5:</p>

<blockquote><p>If you try to compete with the best currency with another one that’s exactly the same, that makes yours the worse currency, so you really should not have bothered.</p></blockquote>

<p>Another partial agreement here so this is a quick one.  If your currency is exactly the same as Bitcoin then you shouldn&rsquo;t have bothered.  There are people who are trying to differentiate and that&rsquo;s the kind of competition we should welcome.  Starting a new altcoin gives you the freedom to try out these new ideas and see if they stick.  Getting a feature into Bitcoin takes a lot of work and an altcoin can be a proving ground for that work.</p>

<p>My stance: Altcoins that don&rsquo;t innovate are junk. If you&rsquo;re going to create an altcoin it better have a few differentiators to be taken seriously.</p>

<p>Issue #6:</p>

<blockquote><p>Scrypt was designed to be a memory hog and is consequently unsuited to mining with a machine consisting almost entirely of ASIC chips, like those used for Bitcoin, and it was assumed that Scrypt-coin mining would therefore always remain in the hands of the GPU owners. This, by the way, is false. If it ever became profitable enough, an ASIC machine could be produced with a shared memory, and it would make GPUs obsolete for Scrypt-mining too.</p></blockquote>

<p>I have another post that touches this topic and explains <a href="http://blog.timmattison.com/archives/2014/06/17/why-proof-of-work-algorithms-need-to-use-memory-bound-functions/">why all proof of work algorithms need to use memory bound functions</a>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Why Proof of Work Algorithms Need to Use Memory Bound Functions]]></title>
    <link href="http://blog.timmattison.com/archives/2014/06/17/why-proof-of-work-algorithms-need-to-use-memory-bound-functions/"/>
    <updated>2014-06-17T20:09:15-04:00</updated>
    <id>http://blog.timmattison.com/archives/2014/06/17/why-proof-of-work-algorithms-need-to-use-memory-bound-functions</id>
    <content type="html"><![CDATA[<p>Recently I read an article called <a href="http://en.wikipedia.org/wiki/Memory_bound_function">&ldquo;The Problem with Altcoins&rdquo;</a> and the author states this about Litecoin:</p>

<blockquote><p>Scrypt was designed to be a memory hog and is consequently unsuited to mining with a machine consisting almost entirely of ASIC chips, like those used for Bitcoin, and it was assumed that Scrypt-coin mining would therefore always remain in the hands of the GPU owners. This, by the way, is false. If it ever became profitable enough, an ASIC machine could be produced with a shared memory, and it would make GPUs obsolete for Scrypt-mining too.</p></blockquote>

<p>This is something that I hear a lot and it needs to be cleared up.  There are some things <a href="http://en.wikipedia.org/wiki/Application-specific_integrated_circuit">ASICs</a> are not good at.  Where ASICs really shine are problems where you can design a pipeline that the data goes through in a mostly fixed order.  <a href="http://en.wikipedia.org/wiki/SHA-2">SHA256</a> is perfect for ASICs.  Each step of the algorithm requires very little storage.  If I&rsquo;m counting correctly you need 64 32-bit words, 16 16-bit words, and somewhere around 22 32-bit registers.</p>

<p>We&rsquo;re talking about a really small amount of storage here.  ((64 * 4) + (16 * 2) + (22 * 4)) == 376 bytes</p>

<p>Even if we bump it up to 512 bytes it is still a miniscule amount of storage in the grand scheme of all of the kinds of storage that we use today (registers, L1 cache, L2 cache, L3 cache, RAM, and hard drive space).  Because of this it is cheap to make it very, very fast to read and write this data.  Physically it occupies little space so you can put the components for this storage exactly where it needs to go on the chip.</p>

<p>Litecoin, and several other cryptocurrencies, use <a href="http://en.wikipedia.org/wiki/scrypt">scrypt</a> instead of SHA256.  This algorithm was supposed to make mining only feasibly on CPUs.  Modern GPUs though were found to have a bit of an edge over CPUs and the memory requirements weren&rsquo;t high enough to really take GPUs out of the running.</p>

<p>Now there is <a href="http://cpucoinlist.com/cryptocurrency-algorithms/x11/">X11</a>, and <a href="http://cpucoinlist.com/cryptocurrency-algorithms/cryptonight/">CryptoNight</a> which are even harder to implement on ASICs&hellip;</p>

<p>But anyway what I really want to address is this particular section of the statement:</p>

<blockquote><p>an ASIC machine could be produced with a shared memory</p></blockquote>

<p>This is a fundamental misunderstanding of computer architecture.  An ASIC is super fast because it doesn&rsquo;t have a pool of shared memory.  The memory is exactly where it needs to be for each stage.</p>

<p>Do you know what the technical term for &ldquo;ASICs with shared memory&rdquo; is?  A general purpose CPU.  :)  Yes, an ASIC with a pool of memory like this would still have some advantage but not the orders of magnitude we see now.  This is because it would be bound to the same limits a CPU is bound to which is the relatively slow access time of RAM versus the CPU&rsquo;s clock speed.</p>

<p>What can we do to make sure mining stays CPU bound?  We should be using <a href="https://en.wikipedia.org/wiki/Memory_bound_function">memory bound functions</a> which are sometimes also called memory hard problems.  These memory bound functions should require enormous amounts of memory.  More than a Raspberry Pi has, more than a BeagleBone Black, more than a GPU.  I mean ridiculous gobs of memory.  Why not?  If the proof of work function can be adjusted, and it has to be to keep up with Moore&rsquo;s law, we can adjust the work to be easy in the sense that it requires few iterations but tons of memory.  As CPUs and memory get faster and people join the network we just adjust it as we always have.</p>

<p>X11 and CryptoNight seem like a good start but there are still problems with them.  It turns out there is one big benefit from algorithms that are not profitable on CPUs and that is that bot net operators are much less likely to waste their bot net time on mining those currencies.  I have a feeling that X11 and CryptoNight are very profitable to mine on bot nets right now.</p>

<p>Is there a solution to level the playing field?  Considering the bot net angle what does that even mean?  I believe that there is a solution that would allow people to participate with CPUs, not require GPU and ASIC investments, and would prevent bot net operators from profiting on mining.  I&rsquo;ve been thinking about this for over a year and I&rsquo;m getting very close to having what I think is a workable solution.  There still is one hole in it but I think that it may be better than what is out there.  Stay tuned and when I&rsquo;m ready I&rsquo;ll post it on my blog.</p>

<p>BTW, I started this blog post on 2014-01-10 and just finished it on 2014-06-17 so it may be a while before I release something.  Be patient!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[True Remote Debugging With Chrome's Remote Debugging Feature]]></title>
    <link href="http://blog.timmattison.com/archives/2014/06/17/true-remote-debugging-with-chromes-remote-debugging-feature/"/>
    <updated>2014-06-17T09:19:34-04:00</updated>
    <id>http://blog.timmattison.com/archives/2014/06/17/true-remote-debugging-with-chromes-remote-debugging-feature</id>
    <content type="html"><![CDATA[<p>Have you used <a href="http://blog.chromium.org/2011/05/remote-debugging-with-chrome-developer.html">Chrome&rsquo;s remote debugging feature</a>?  It is a handy tool for debugging JavaScript in another tab/window.</p>

<p>That&rsquo;s nice, but have you ever wanted to debug JavaScript that was running on another machine running Chrome?  If so, and you&rsquo;re running on Mac OS, you&rsquo;ve come to the right place.</p>

<p>The first step in this process is to disable <a href="http://joshuamcginnis.com/2011/02/28/how-to-disable-same-origin-policy-in-chrome/">Chrome&rsquo;s same origin policy</a>.  This may not be necessary in your application but I&rsquo;ve always found I needed to do it in mine.</p>

<p>Now you&rsquo;ll need to make sure you have <a href="http://www.dest-unreach.org/socat/">socat</a> installed.  The easiest way to do this is with <a href="http://brew.sh/">Homebrew</a>.  Install Homebrew, and then run this command:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>brew install socat</span></code></pre></td></tr></table></div></figure>


<p>That will install socat if it isn&rsquo;t installed already.</p>

<p>Now start Chrome remote debugging on the system that you want to connect to.</p>

<p>Next, get socat to relay traffic from port 9223 to port 9222 using this command:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>socat tcp-listen:9223,fork tcp:localhost:9222</span></code></pre></td></tr></table></div></figure>


<p>Finally, try to connect to the remote computer using <em>its IP address, not localhost</em> with a URL like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>http://IP_ADDRESS:9223</span></code></pre></td></tr></table></div></figure>


<p>You should be connected to the remote system&rsquo;s debugger using port 9223.</p>

<p>When you are done be sure to do this to stop socat:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>killall socat</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[How to: Execute a Command on a Remote Server That Requires You to Su or Sudo]]></title>
    <link href="http://blog.timmattison.com/archives/2014/02/13/how-to-execute-a-command-on-a-remote-server-that-requires-you-to-su-or-sudo/"/>
    <updated>2014-02-13T14:28:49-05:00</updated>
    <id>http://blog.timmattison.com/archives/2014/02/13/how-to-execute-a-command-on-a-remote-server-that-requires-you-to-su-or-sudo</id>
    <content type="html"><![CDATA[<p>Recently I ran into a situation where I had to reboot a ton of machines remotely.  I couldn&rsquo;t ssh as root, and you really shouldn&rsquo;t do that anyway, so I thought I might be stuck trying to SSH in, &ldquo;sudo reboot&rdquo;, enter the password, and go on to the next machine.  One snag was that some machines supported sudo and some required me to su.</p>

<p>I didn&rsquo;t want to have to do this for all of the machines I was working on so I searched around and found <a href="https://github.com/paramiko/paramiko">Paramiko</a>.  Paramiko is an SSH library for Python that lets you tell Python the login password and also gives you direct access to the terminal stream from your SSH session.  This means that I can send su or sudo and then send the password without the user doing anything.</p>

<p>Security wise this is an obvious hole in many ways.  First of all if you do this for a machine and specify the password on the command-line it is going to end up in your history file.  So without going through the exhaustive list of reasons why this is generally a bad idea lets just say that you should use this sparingly.</p>

<p>Set the variable <code>root_command</code> to the command that you want to execute as root, set <code>root_command_result</code> to the expected result of the command.  The command needs to have <code>\n</code> on the end of it because it simulates the user pressing enter.  Without it the system will never execute the command.  Pass these command-line parameters in this order:</p>

<ul>
<li>The IP of the system you want to connect to</li>
<li>The username of the user that can su to root</li>
<li>The password of the user that can su to root</li>
<li>The password required to su to root</li>
</ul>


<p>This particular version of the script just performs the &ldquo;su&rdquo; command.  It can be modified to do a &ldquo;sudo&rdquo; with just a few tweaks.  If there&rsquo;s demand I&rsquo;ll post a version that lets you swap between both and does some additional error handling.</p>

<p>And here&rsquo;s the script&hellip; don&rsquo;t forget to install Paramiko!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#!/usr/bin/env python
</span><span class='line'>
</span><span class='line'>__author__ = 'timmattison'
</span><span class='line'>
</span><span class='line'>import paramiko
</span><span class='line'>import sys
</span><span class='line'>import time
</span><span class='line'>
</span><span class='line'>root_command = "whoami\n"
</span><span class='line'>root_command_result = "root"
</span><span class='line'>
</span><span class='line'>def send_string_and_wait(command, wait_time, should_print):
</span><span class='line'>    # Send the su command
</span><span class='line'>    shell.send(command)
</span><span class='line'>
</span><span class='line'>    # Wait a bit, if necessary
</span><span class='line'>    time.sleep(wait_time)
</span><span class='line'>
</span><span class='line'>    # Flush the receive buffer
</span><span class='line'>    receive_buffer = shell.recv(1024)
</span><span class='line'>
</span><span class='line'>    # Print the receive buffer, if necessary
</span><span class='line'>    if should_print:
</span><span class='line'>        print receive_buffer
</span><span class='line'>
</span><span class='line'>def send_string_and_wait_for_string(command, wait_string, should_print):
</span><span class='line'>    # Send the su command
</span><span class='line'>    shell.send(command)
</span><span class='line'>
</span><span class='line'>    # Create a new receive buffer
</span><span class='line'>    receive_buffer = ""
</span><span class='line'>
</span><span class='line'>    while not wait_string in receive_buffer:
</span><span class='line'>        # Flush the receive buffer
</span><span class='line'>        receive_buffer += shell.recv(1024)
</span><span class='line'>
</span><span class='line'>    # Print the receive buffer, if necessary
</span><span class='line'>    if should_print:
</span><span class='line'>        print receive_buffer
</span><span class='line'>
</span><span class='line'># Get the command-line arguments
</span><span class='line'>system_ip = sys.argv[1]
</span><span class='line'>system_username = sys.argv[2]
</span><span class='line'>system_ssh_password = sys.argv[3]
</span><span class='line'>system_su_password = sys.argv[4]
</span><span class='line'>
</span><span class='line'># Create an SSH client
</span><span class='line'>client = paramiko.SSHClient()
</span><span class='line'>
</span><span class='line'># Make sure that we add the remote server's SSH key automatically
</span><span class='line'>client.set_missing_host_key_policy(paramiko.AutoAddPolicy())
</span><span class='line'>
</span><span class='line'># Connect to the client
</span><span class='line'>client.connect(system_ip, username=system_username, password=system_ssh_password)
</span><span class='line'>
</span><span class='line'># Create a raw shell
</span><span class='line'>shell = client.invoke_shell()
</span><span class='line'>
</span><span class='line'># Send the su command
</span><span class='line'>send_string_and_wait("su\n", 1, True)
</span><span class='line'>
</span><span class='line'># Send the client's su password followed by a newline
</span><span class='line'>send_string_and_wait(system_su_password + "\n", 1, True)
</span><span class='line'>
</span><span class='line'># Send the install command followed by a newline and wait for the done string
</span><span class='line'>send_string_and_wait_for_string(root_command, root_command_result, True)
</span><span class='line'>
</span><span class='line'># Close the SSH connection
</span><span class='line'>client.close()</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Port 32764 - a Router Backdoor That You Need to Take Seriously]]></title>
    <link href="http://blog.timmattison.com/archives/2014/01/16/port-32764-a-router-backdoor-that-you-need-to-take-seriously/"/>
    <updated>2014-01-16T08:50:19-05:00</updated>
    <id>http://blog.timmattison.com/archives/2014/01/16/port-32764-a-router-backdoor-that-you-need-to-take-seriously</id>
    <content type="html"><![CDATA[<p>TL;DR Several routers have been found to have a backdoor installed on them that is accessible via the LAN and WAN connections by default.  If you have Internet access at home or at a client location you care about then you should be testing to see if they are vulnerable with <a href="https://www.grc.com/x/portprobe=32764">ShieldsUP</a>.</p>

<p>I would recommend running this test ASAP.  The <a href="https://github.com/elvanderb/TCP-32764">list of affected routers</a> includes Netgear, Linksys, and even “real” Cisco hardware.  That list is not exhaustive.</p>

<p>If you need to run this test via SSH I’ve whipped up a script that will spit out whether you’re vulnerable or not based on the ShieldsUP results.  It was designed to run on Mac OS (because their version of sed is busted) and tested on Mavericks and Debian Linux.  Here’s what you can run:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>curl -L http://bit.ly/port32764 2&gt;&amp;1 | <span class="se">\</span>
</span><span class='line'>  tr <span class="s2">&quot;\n&quot;</span> <span class="s2">&quot; &quot;</span> | <span class="se">\</span>
</span><span class='line'>  tr <span class="s2">&quot;\r&quot;</span> <span class="s2">&quot; &quot;</span> | <span class="se">\</span>
</span><span class='line'>  sed <span class="s1">&#39;s/&lt;[^&gt;][^&gt;]*&gt;/ /g&#39;</span> | <span class="se">\</span>
</span><span class='line'>  sed <span class="s1">&#39;s/^.*32764/32764/&#39;</span> | <span class="se">\</span>
</span><span class='line'>  sed <span class="s1">&#39;s/Unknown.*$//&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The response should look like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>32764 Stealth
</span></code></pre></td></tr></table></div></figure>


<p>Or this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>32764 Closed
</span></code></pre></td></tr></table></div></figure>


<p>If you get anything else then you are vulnerable.  Even if you run this test I recommend running it in a browser on the connection you’re testing just in case the script has an issue.</p>

<p>If you are vulnerable then the following pieces of information about your connection may have already been compromised:</p>

<ul>
<li>Your wireless key (in the clear, not hashed)</li>
<li>Your router admin username and password (in the clear, not hashed)</li>
<li>Your router’s SSID and MAC address (this can be used to add your router to a database of access points with passwords)</li>
<li>Any custom settings you have on your router (port mapping to interesting devices, tunnels you thought would be hidden on a high port number, etc)</li>
</ul>


<p>People have written plenty of applications that do scans of the entire Internet in days <a href="http://zmap.io/">or even hours</a>.  This is being scanned for constantly right now and you cannot hide in the four billion addresses out there.</p>

<p>If you are not vulnerable but you have used the same wireless password on an older router it is probably a good idea to change your password.  Nobody knows how long this has been in the wild.  It has been in the firmware for a long time.</p>

<p>If you need help post in the comments.  Good luck!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Fixing In-Page Analytics With Google Analytics]]></title>
    <link href="http://blog.timmattison.com/archives/2014/01/10/fixing-in-page-analytics-with-google-analytics/"/>
    <updated>2014-01-10T08:40:24-05:00</updated>
    <id>http://blog.timmattison.com/archives/2014/01/10/fixing-in-page-analytics-with-google-analytics</id>
    <content type="html"><![CDATA[<p>After migrating to Octopress I started getting interested in my site&rsquo;s analytics again.  A co-worker told me about in-page analytics with Google Analytics and how it would show you what people were doing on your site so you could tune your layout.  We tried loading it and ran into some problems.</p>

<p>First, we got the &ldquo;Loading&hellip;&rdquo; spinner for a long time:</p>

<p><img src="http://blog.timmattison.com/images/in-page-analytics/loading.png" alt="Loading..." /></p>

<p>Then we got the &ldquo;Still loading&hellip;&rdquo; message that didn&rsquo;t inspire much confidence:</p>

<p><img src="http://blog.timmattison.com/images/in-page-analytics/still-loading.png" alt="Still loading..." /></p>

<p>Finally, we got a popup that said &ldquo;Problem loading In-Page Analytics&rdquo;:</p>

<p><img src="http://blog.timmattison.com/images/in-page-analytics/problem-loading-in-page-analytics.png" alt="Problem loading In-Page Analytics" /></p>

<p>What the problem was in my case was that I told Google Analytics that I wanted to track timmattison.com but my site redirects to blog.timmattison.com.  My two options were to make my site actually be served from timmattison.com or to change my tracking code.  I opted to change my tracking code.  I&rsquo;ll walk you through how I did it.</p>

<p>NOTE: <em>You will lose your existing tracking data if you do this!</em>  If you want to keep your tracking data you&rsquo;ll need to find another way.  For me it wasn&rsquo;t a big deal because I just moved my site anyway and my analytics were reset a week or two ago already.</p>

<p>Here are the steps:</p>

<ul>
<li>Log into your analytics account</li>
</ul>


<p><img src="http://blog.timmattison.com/images/in-page-analytics/log-into-your-analytics-account.png" alt="Log into your analytics account" /></p>

<ul>
<li>Click the admin button</li>
</ul>


<p><img src="http://blog.timmattison.com/images/in-page-analytics/click-the-admin-button.png" alt="Click the admin button" /></p>

<ul>
<li>Click &ldquo;View Settings&rdquo;</li>
</ul>


<p><img src="http://blog.timmattison.com/images/in-page-analytics/click-view-settings.png" alt="Click &quot;View Settings&quot;" /></p>

<ul>
<li><p>Scroll all the way to the bottom of the page</p></li>
<li><p>Click &ldquo;Delete View&rdquo;</p></li>
</ul>


<p><img src="http://blog.timmattison.com/images/in-page-analytics/click-delete-view.png" alt="Click &quot;Delete View&quot;" /></p>

<ul>
<li>Click &ldquo;Delete View&rdquo; again.  <em>At this point you&rsquo;ll lose all of your analytics history!</em></li>
</ul>


<p><img src="http://blog.timmattison.com/images/in-page-analytics/click-delete-view-again.png" alt="Click &quot;Delete View&quot; again" /></p>

<ul>
<li>Click the admin button</li>
</ul>


<p><img src="http://blog.timmattison.com/images/in-page-analytics/click-the-admin-button.png" alt="Click the admin button" /></p>

<ul>
<li>Click the property drop down and then click &ldquo;Create new property&rdquo;</li>
</ul>


<p><img src="http://blog.timmattison.com/images/in-page-analytics/click-property-drop-down-and-click-create-new-property.png" alt="Click the property drop down and then click &quot;Create new property&quot;" /></p>

<ul>
<li><p>Re-create your property and make sure you use the site you redirect to.  In my case &ldquo;blog.timmattison.com&rdquo;, not &ldquo;timmattison.com&rdquo;.</p></li>
<li><p>Put your new tracking code into your site.  <em>Don&rsquo;t forget to do this or tracking won&rsquo;t work at all!</em></p></li>
</ul>


<p>And that should do it.  Let me know if it works for you or if you need some help.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Testing a Video Plugin]]></title>
    <link href="http://blog.timmattison.com/archives/2014/01/04/testing-a-video-plugin/"/>
    <updated>2014-01-04T13:54:46-05:00</updated>
    <id>http://blog.timmattison.com/archives/2014/01/04/testing-a-video-plugin</id>
    <content type="html"><![CDATA[<p>Just testing an Octopress plugin from github called <a href="https://github.com/optikfluffel/octopress-responsive-video-embed">Octopress responsive video embed</a>.</p>

<p>A Vimeo video:</p>

<div class="embed-video-container"><iframe src="http://player.vimeo.com/video/82648212 "></iframe></div>


<p>A YouTube video:</p>

<div class="embed-video-container"><iframe src="http://www.youtube.com/embed/T3gacnHb9TI "></iframe></div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[BeagleBone Black and Raspberry Pi SD Card Gotchas on Mac OS]]></title>
    <link href="http://blog.timmattison.com/archives/2014/01/02/beaglebone-black-and-raspberry-pi-sd-card-gotchas-on-mac-os/"/>
    <updated>2014-01-02T19:18:24-05:00</updated>
    <id>http://blog.timmattison.com/archives/2014/01/02/beaglebone-black-and-raspberry-pi-sd-card-gotchas-on-mac-os</id>
    <content type="html"><![CDATA[<p>If you&rsquo;re using dd on the command-line to write SD card images in Mac OS then you may have run into a weird issue where the image is starting to write and then dd comes back and says:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>dd: /dev/diskX: Resource busy
</span></code></pre></td></tr></table></div></figure>


<p>I ran into this multiple times when building Raspberry Pi and BeagleBone Black images.  What it turned out to be was that Mac OS needed me to set the block size for some reason.  I arbitrarily chose 1 MiB so my command looks like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo dd <span class="k">if</span><span class="o">=</span>image-file.img <span class="nv">of</span><span class="o">=</span>/dev/disk3 <span class="nv">bs</span><span class="o">=</span>1048576
</span></code></pre></td></tr></table></div></figure>


<p>After specifying the bs parameter it never happened to me again.  Let me know if you ran into the same thing and whether or not this fixed it on your system.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Building Asterisk With Support for SIPML5]]></title>
    <link href="http://blog.timmattison.com/archives/2014/01/02/building-asterisk-with-support-for-sipml5/"/>
    <updated>2014-01-02T19:06:58-05:00</updated>
    <id>http://blog.timmattison.com/archives/2014/01/02/building-asterisk-with-support-for-sipml5</id>
    <content type="html"><![CDATA[<p>If you are trying to use SIPML5 with Asterisk there are some gotchas that often come up.  If you&rsquo;re running it on Debian these tips below may help.</p>

<p>If you haven&rsquo;t gotten that far with Asterisk and don&rsquo;t care about your current configuration you can try this procedure that I use to build Asterisk myself:</p>

<ul>
<li>Download latest Asterisk, extract it, and cd into the directory it was extracted into</li>
<li>Install some necessary dependencies</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo apt-get install build-essential libncurses5-dev libxml2-dev libsqlite3-dev libssl-dev libsrtp0-dev
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Run the configuration script</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>./configure
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Build Asterisk.  NOTE: I have only had problems running a multi-job make so I would suggest you do not include a -jX option to take advantage of all of your cores.</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>make
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Install Asterisk</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo make install
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Build the samples and <strong>overwrite your current configuration</strong>.  <strong>You lose everything here so skip this step if you want to keep your config</strong>.</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo make samples
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Start Asterisk with crazy verbosity so you can see what is going on</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo /usr/sbin/asterisk -vvvvvvvvvvvvvvg
</span></code></pre></td></tr></table></div></figure>


<p>There are two issues I ran into when trying to use SIPML5.</p>

<h1>Error #1: no protocols out of &lsquo;sip&rsquo; supported &ndash; in Asterisk console</h1>

<p>In this case chan_sip.so probably isn&rsquo;t built.  Check in make menuconfig, add libssl-dev via apt-get, re-run ./configure, make menuselect, verify that resource module res_crypto is enabled.</p>

<h1>Error #2: SRTP issues</h1>

<p>If you are having SRTP issues you probably get one or more of these messages:</p>

<ul>
<li>In the browser &ndash; Not acceptable here</li>
<li>In the Asterisk console &ndash; Received SAVPF profile in audio offer but AVPF is not enabled</li>
<li>In the Asterisk console &ndash; Insufficient information in SDP</li>
<li>In the Asterisk console &ndash; No SRTP module loaded, can&rsquo;t setup SRTP session</li>
<li>In the Asterisk console &ndash; Rejecting secure audio stream without encryption details</li>
</ul>


<p>In this case res_srtp.so probably isn&rsquo;t built.  Check in make menuconfig, add libsrtp0-dev via apt-get, re-run ./configure, make menuselect, verify that resource module res_srtp is enabled.</p>

<p>Good luck and post in the comments if it worked for you or if you need some help.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[How to Get SIPML5 Working With Asterisk]]></title>
    <link href="http://blog.timmattison.com/archives/2014/01/02/how-to-get-sipml5-working-with-asterisk/"/>
    <updated>2014-01-02T18:59:44-05:00</updated>
    <id>http://blog.timmattison.com/archives/2014/01/02/how-to-get-sipml5-working-with-asterisk</id>
    <content type="html"><![CDATA[<p>Another &ldquo;all business&rdquo; post that has been sitting in Evernote for months.  Enjoy!</p>

<p>Assume Asterisk is running on localhost and Apache is installed and running with /var/www at the htdocs directory</p>

<p>http.conf changes:</p>

<ul>
<li>Set &ldquo;enabled=yes&rdquo; OR uncomment &ldquo;;enabled=yes&rdquo;</li>
<li>Set &ldquo;bindport=8088&rdquo; OR uncomment &ldquo;;bindport=8088&rdquo;</li>
</ul>


<p>sip.conf changes:</p>

<ul>
<li>Get the SIP code listening via TCP &ndash; set &ldquo;tcpenable=yes&rdquo;</li>
<li>Add web socket support for SIP &ndash; set &ldquo;transport=udp,ws&rdquo; OR add &ldquo;,ws&rdquo; to existing transport list</li>
<li>Uncomment xlite1 account</li>
<li>Add &ldquo;avpf=yes&rdquo; to xlite1 account</li>
<li>Add &ldquo;icesupport=yes&rdquo; to xlite1 account</li>
</ul>


<p>Steps to perform test call:</p>

<ul>
<li>Restart Asterisk</li>
<li>Get the source from Subversion</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>svn checkout http://sipml5.googlecode.com/svn/trunk/ sipml5-read-only</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Move the sipml5 source into /var/www</li>
<li>Open Chrome and point it to the SIPML5 index.html in /var/www (or the subdirectory you put it in)</li>
<li>Click &ldquo;Enjoy our live demo&rdquo;</li>
<li>Set these values in the &ldquo;Registration&rdquo; panel

<ul>
<li>Display Name: xlite1</li>
<li>Private Identity: xlite1</li>
<li>Public Identity: sip:xlite1@localhost</li>
<li>Realm: localhost</li>
<li>Password is left blank</li>
</ul>
</li>
<li>Click &ldquo;Expert Mode&rdquo;</li>
<li>Set these values in &ldquo;Expert settings&rdquo;

<ul>
<li>Disable Video: Checked</li>
<li>Enable RTCWeb Breaker: Unchecked</li>
<li>WebSocket Server URL: ws://localhost:8088/ws</li>
<li>SIP outbound Proxy URL: udp://localhost:5060</li>
<li>Click &ldquo;Save&rdquo;</li>
<li>Close &ldquo;Expert settings&rdquo; tab</li>
</ul>
</li>
<li>Enter &ldquo;sip:2@localhost&rdquo; in the &ldquo;Call control&rdquo; field</li>
<li>Click &ldquo;Call&rdquo;</li>
</ul>


<p>At this point you should hear audio coming from Asterisk in a few seconds and your first call is complete.  Now you can build out your server as you&rsquo;d want!</p>

<p>Here are some screenshots of the SIPML5 settings just in case you want to visually double-check.</p>

<p><img src="http://blog.timmattison.com/images/sipml5-asterisk/registration-and-call-control.png" alt="Registration and call control" /></p>

<p><img src="http://blog.timmattison.com/images/sipml5-asterisk/expert-settings.png" alt="Expert settings" /></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Installing Unison on a Synology NAS]]></title>
    <link href="http://blog.timmattison.com/archives/2014/01/02/installing-unison-on-a-synology-nas/"/>
    <updated>2014-01-02T18:53:31-05:00</updated>
    <id>http://blog.timmattison.com/archives/2014/01/02/installing-unison-on-a-synology-nas</id>
    <content type="html"><![CDATA[<p>This is all business.  I wrote this up a long time ago and never got a chance to put it online.  Enjoy!</p>

<p>First, install SSH:</p>

<ol>
<li>Go to Synology web GUI</li>
<li>Open Control Panel</li>
<li>Click &ldquo;Terminal&rdquo;</li>
<li>Check &ldquo;Enable SSH service&rdquo;</li>
<li>Click &ldquo;Apply&rdquo;</li>
</ol>


<p>Set up your users so they have a home directory:</p>

<ol>
<li>Go to Synology web GUI</li>
<li>Open Control Panel</li>
<li>Click &ldquo;User&rdquo;</li>
<li>Click &ldquo;User Home&rdquo; button at the top</li>
<li>Check &ldquo;Enable user home service&rdquo;</li>
<li>Select the volume on which the home directories should be stored</li>
<li>Click &ldquo;OK&rdquo;</li>
</ol>


<p>Connect via SSH and make sure it works:</p>

<ol>
<li>ssh as admin to the Synology box.  Use the same password you use as admin on the web GUI.  <strong>If you leave it blank, even if your password is blank, it will always fail.  You must have a non-blank password!</strong> This is to protect against your device getting compromised from having no password.</li>
<li>If you get the &ldquo;Diskstation>&rdquo; prompt then it is working</li>
</ol>


<p>Connect via SSH and make sure non-admin/non-root logins work:</p>

<ol>
<li>Connect as a regular user.  If you get permission denied SSH back in as root and change the desired user&rsquo;s shell from /sbin/nologin to /bin/ash in /etc/passwd.</li>
<li>Try logging in again as that user</li>
</ol>


<p>Bootstrap for ipkg:</p>

<ol>
<li><a href="http://forum.synology.com/wiki/index.php/Overview_on_modifying_the_Synology_Server,_bootstrap,_ipkg_etc">http://forum.synology.com/wiki/index.php/Overview_on_modifying_the_Synology_Server,_bootstrap,_ipkg_etc</a></li>
<li>Log in as root</li>
<li>If you have DSM 4 or greater:</li>
<li> Edit /root/.profile and comment out the lines that set and export the PATH variable</li>
<li> Log out</li>
<li> Log back in as root</li>
<li>Run &ldquo;ipkg&rdquo;.  You should see the options come up and not an error message that ipkg can&rsquo;t be found.</li>
</ol>


<p>Compile and install Unison &ndash; <a href="http://www.multigesture.net/articles/how-to-compile-unison-for-a-synology-ds212/">http://www.multigesture.net/articles/how-to-compile-unison-for-a-synology-ds212/</a>
This error is expected:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>if [ -f `which etags` ]; then \
</span><span class='line'>    etags *.mli */*.mli *.ml */*.ml */*.m *.c */*.c *.txt \
</span><span class='line'>          ; fi
</span><span class='line'>/bin/sh: etags: not found
</span><span class='line'>make[1]: [tags] Error 127 (ignored)</span></code></pre></td></tr></table></div></figure>


<p>Good luck and post success stories and issues in the comments and I&rsquo;ll help if I can.</p>
]]></content>
  </entry>
  
</feed>
