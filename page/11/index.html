
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Tim Mattison</title>
  <meta name="author" content="Tim Mattison">

  
  <meta name="description" content="After a reinstall of Gentoo the other day I noticed that when I checked my logs with dmesg that all I saw was a ton of information relating to usb- &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://blog.timmattison.com/page/11">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Tim Mattison" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-46746763-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Tim Mattison</a></h1>
  
    <h2>Hardcore tech</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:blog.timmattison.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/archives/2009/11/02/how-to-stop-usb-storage-messages-from-filling-your-logs/">How-To: Stop USB Storage Messages From Filling Your Logs</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-11-02T18:59:59-05:00" pubdate data-updated="true">Nov 2<span>nd</span>, 2009</time>
        
           | <a href="/archives/2009/11/02/how-to-stop-usb-storage-messages-from-filling-your-logs/#disqus_thread"
             data-disqus-identifier="http://blog.timmattison.com/archives/2009/11/02/how-to-stop-usb-storage-messages-from-filling-your-logs/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>After a reinstall of Gentoo the other day I noticed that when I checked my logs with dmesg that all I saw was a ton of information relating to usb-storage.  It turns out that the default kernel in some operating systems (and apparently the latest Gentoo is one of them) has the verbose USB storage debug logs enabled.</p>

<p>In order to disable it you&rsquo;ll need to rebuild your kernel.  The option you&rsquo;re looking for is deep in the menu system but you can find it by drilling down like this</p>

<ul>
<li><p>Device Drivers</p>

<ul>
<li><p>USB support</p>

<ul>
<li>USB Mass Storage verbose debug</li>
</ul>
</li>
</ul>
</li>
</ul>


<p>This option is also known as CONFIG_USB_STORAGE_DEBUG if you are editing your configuration manually.  Make sure this is unchecked in the menu (ie. no asterisk next to it) or set to &ldquo;=n&rdquo; in your configuration file.  Rebuild your kernel, reboot, and you&rsquo;ll never be bothered with these messages again.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/archives/2009/11/02/how-to-fix-importerror-no-module-named-webappconfig-config-on-gentoo/">How-To: Fix &#8220;ImportError: No Module Named WebappConfig.config&#8221; on Gentoo</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-11-02T18:59:59-05:00" pubdate data-updated="true">Nov 2<span>nd</span>, 2009</time>
        
           | <a href="/archives/2009/11/02/how-to-fix-importerror-no-module-named-webappconfig-config-on-gentoo/#disqus_thread"
             data-disqus-identifier="http://blog.timmattison.com/archives/2009/11/02/how-to-fix-importerror-no-module-named-webappconfig-config-on-gentoo/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I just tried to upgrade <a href="http://trac.edgewall.org/">trac</a> on my Gentoo box to get back into the swing of tracking and squashing bugs.  Gentoo was having none of it and reported &ldquo;ImportError: No module named WebappConfig.config&rdquo;. That error by itself isn&rsquo;t terribly helpful so in order to fix it I determined you usually need to do a few things. If you aren&rsquo;t installing trac, replace trac in these steps to the application you are trying to install.</p>

<p>Step 1) Run</p>

<pre><code>python-updater
</code></pre>

<p>This can take a LONG time so be ready to wait.</p>

<p>Step 2) Try to run trac.  If that doesn&rsquo;t work, go on to step 3.  If it does, you&rsquo;re done.</p>

<p>Step 3) Try to emerge trac again.  If that doesn&rsquo;t work, go on to step 4.</p>

<p>Step 4) Run</p>

<pre><code>emerge webapp-config
</code></pre>

<p>trac should be updated by python-updater but the three other steps are just a backup to be extra sure that everything is installed properly.  After jumping through those hoops you should be back online again.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/archives/2009/11/01/tip-perform-a-pvmove-without-calculating-the-start-and-end-extent-values/">Tip: Perform a Pvmove Without Calculating the Start and End Extent Values</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-11-01T18:59:59-05:00" pubdate data-updated="true">Nov 1<span>st</span>, 2009</time>
        
           | <a href="/archives/2009/11/01/tip-perform-a-pvmove-without-calculating-the-start-and-end-extent-values/#disqus_thread"
             data-disqus-identifier="http://blog.timmattison.com/archives/2009/11/01/tip-perform-a-pvmove-without-calculating-the-start-and-end-extent-values/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>If you&rsquo;re used pvmove before you might be in the habit of doing the following:</p>

<ul>
<li><p>Determining where you want to move an extent (new_start)</p></li>
<li><p>Getting the start and end of the existing extent to move (original_start, original_end)</p></li>
<li><p>Calculating the length of the extent from original_end &ndash; original_start (length)</p></li>
<li><p>Adding the length to new_start (new_end)</p></li>
<li><p>Running pvmove</p></li>
</ul>


<p>Well, there is an easier way.  Let&rsquo;s assume you originally would&rsquo;ve done this</p>

<pre><code>pvmove -v /dev/sdc:17067-29866 /dev/sdc:0-17066 --alloc anywhere
</code></pre>

<p>If you want to be lazy (and let LVM2 figure out whether you&rsquo;re doing the right thing or not) you can just do this instead</p>

<pre><code>pvmove -v /dev/sdc:17067-29866 /dev/sdc:0-`echo "0+29866-17067" | bc` --alloc anywhere
</code></pre>

<p>Basically, after you&rsquo;ve determined where you want the new extent to start you put that extent number (&ldquo;0&rdquo; in this case) and just follow it up with that bc recipe.  This tells bc to calculate the length and feed it to LVM2.</p>

<p>The bc formula should be new_start plus original_end minus original_start.  That will calculate the length and then add it to the new_start.</p>

<p>Isn&rsquo;t that what you&rsquo;d expect it to do anyway?  :)</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/archives/2009/11/01/how-to-fix-lvm2s-no-extents-available-for-allocation-errors-when-using-pvmove/">How-To: Fix LVM2&#8217;s &#8220;No Extents Available for Allocation&#8221; Errors When Using Pvmove</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-11-01T18:59:59-05:00" pubdate data-updated="true">Nov 1<span>st</span>, 2009</time>
        
           | <a href="/archives/2009/11/01/how-to-fix-lvm2s-no-extents-available-for-allocation-errors-when-using-pvmove/#disqus_thread"
             data-disqus-identifier="http://blog.timmattison.com/archives/2009/11/01/how-to-fix-lvm2s-no-extents-available-for-allocation-errors-when-using-pvmove/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I just started using LVM2 about two weeks ago.  I recently wanted to shuffle around some physical extents on my disks to keep them from becoming a mess as I added new logical volumes.  So in order to see how LVM2 laid out my logical volumes</p>

<p>I ran:</p>

<pre><code>pvdisplay -m
</code></pre>

<p>This roughly translates to &ldquo;show me the physical volume information including the mapping data&rdquo;.  On my machine this printed out something like this</p>

<pre><code>  --- Physical Segments ---
  Physical extent 0 to 17066:
    FREE

  Physical extent 17067 to 29866:
    Logical volume  /dev/vg-raid-array/work-area-1
    Logical extents 0 to 51199

  Physical extent 29867 to 31146:
    Logical volume  /dev/vg-raid-array/postgresql
    Logical extents 0 to 5119

  Physical extent 31147 to 59617:
    FREE

  --- Physical volume ---
  PV Name               /dev/sdc
  VG Name               vg-raid-array
  PV Size               232.89 GB / not usable 3.18 MB
  Allocatable           yes
  PE Size (KByte)       4096
  Total PE              59618
  Free PE               45538
  Allocated PE          14080
  PV UUID               xxxxxx-xxxx-xxxx-xxxx-xxxx-xxxx-xxxxxx
</code></pre>

<p>What you&rsquo;ll notice here is that my disk has my &ldquo;work-area-1&rdquo; volume starting at physical extent 17067 but the physical extents before that (0 &ndash; 17066) are empty.  What I wanted to do was move those extents to the beginning of the disk, then move the postgresql extents to the extents directly after that, so that I would have a large block of contiguous extents to add new partitions.  Here&rsquo;s what happened on my first try</p>

<pre><code># pvmove /dev/sdc:17067-29866 /dev/sdc:0-17066

  No extents available for allocation
</code></pre>

<p>After lots of digging I found that <a href="http://lists.alioth.debian.org/pipermail/pkg-lvm-maintainers/2007-August/001322.html">I needed a magical, seemingly undocumented flag</a> to get it to work.  So now my command-line looked like this</p>

<pre><code># pvmove -v /dev/sdc:17067-29866 /dev/sdc:0-17066 --alloc anywhere
</code></pre>

<p>After that I was off and running.  <strong>If you&rsquo;re doing this on a remote terminal make sure you use <em>screen</em></strong> so you can disconnect!  The command I used runs pvmove in the foreground so if you disconnect while it&rsquo;s doing it bad things may happen.  This process usually takes a long time since you&rsquo;re reading and writing from the same disk.  Moving my 50GB of data took about 35 minutes.  Alternatively you can specify the background option (&ldquo;-b&rdquo; or &ldquo;&mdash;background&rdquo;) and let it run silently.</p>

<p>Good luck!  Make sure you always back up your data before you start moving partitions around with LVM2.  It&rsquo;s fairly safe with all of it&rsquo;s fancy checkpointing code but it&rsquo;s never fun to be in the situation where you have to depend on it. rsyncing to a backup first is much easier than trying to wade through documentation later.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/archives/2009/10/28/how-to-fix-the-cannot-find-luuid-error-on-gentoo/">How-To: Fix the &#8220;Cannot Find -luuid&#8221; Error on Gentoo</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-10-28T22:11:26-04:00" pubdate data-updated="true">Oct 28<span>th</span>, 2009</time>
        
           | <a href="/archives/2009/10/28/how-to-fix-the-cannot-find-luuid-error-on-gentoo/#disqus_thread"
             data-disqus-identifier="http://blog.timmattison.com/archives/2009/10/28/how-to-fix-the-cannot-find-luuid-error-on-gentoo/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Recently the Gentoo project deprecated lots of system profiles.  What this meant for me what that I needed to do nearly an entire system rebuild with my usual &ldquo;emerge &mdash;update &mdash;deep &mdash;newuuse -av world&rdquo; magic.  After churning through about 200 of the 400+ ports that needed to be rebuilt my system started getting weird.  Notably mount/umount stopped working, and the emerge failed.  The error message I got after a bit of digging was that Gentoo &ldquo;cannot find -luuid&rdquo;.  Running mount or umount (and probably other e2fsprogs utilities) gave me the error &ldquo;error while loading shared libraries: libblkid.so.1: cannot open shared object file: No such file or directory&rdquo;.</p>

<p>When you get an error like this it&rsquo;s time to act fast since a power outage or a reboot can really hose the system.  I&rsquo;ve had it happen before and it&rsquo;s not pretty.  In this case you need to re-emerge e2fsprogs and util-linux.  I simply did this:</p>

<pre><code>emerge --update --deep --newuse -av e2fsprogs
</code></pre>

<p>That re-emerged both packages for me.  If it doesn&rsquo;t show that it will re-emerge both then you&rsquo;re best off doing this:</p>

<pre><code>emerge --update --deep --newuse -av util-linux e2fsprogs
</code></pre>

<p>After doing that you should have neither &ldquo;cannot find -luuid&rdquo; nor &ldquo;error while loading shared libraries: libblkid.so.1: cannot open shared object file: No such file or directory&rdquo; problems.  If you&rsquo;re extra paranoid like me you should also re-emerge dbus and then do a revdep-rebuild</p>

<pre><code>emerge --update --deep --newuse -av dbus
revdep-rebuild
</code></pre>

<p>If you don&rsquo;t have revdep-rebuild installed you can install it by running</p>

<pre><code>emerge gentoolkit
</code></pre>

<p>dbus tells you that you must run revdep-rebuild after emerging it and restart dbus.  Listen to it, it&rsquo;s not kidding.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/archives/2009/10/26/how-to-add-support-for-sha1-and-sha512-functions-in-postgresql/">How-To: Add Support for SHA1 and SHA512 Functions in PostgreSQL</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-10-26T18:51:03-04:00" pubdate data-updated="true">Oct 26<span>th</span>, 2009</time>
        
           | <a href="/archives/2009/10/26/how-to-add-support-for-sha1-and-sha512-functions-in-postgresql/#disqus_thread"
             data-disqus-identifier="http://blog.timmattison.com/archives/2009/10/26/how-to-add-support-for-sha1-and-sha512-functions-in-postgresql/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I was working on comparing some data in PostgreSQL today and I realized just how long it can take to compare millions of rows of bytea data in raw form. The bytea fields ranged from 30 bytes to several kilobytes so I figured that maybe pre-computing the hash and then comparing the hashes would be faster. PostgreSQL only has support for MD5 hashing and <a href="http://www.mathstat.dal.ca/~selinger/md5collision/">we all know how reliable that can be</a>. So, I fired up Google and set out to figure out the best way to do it.  It turns out that if you install pgcrypto.so via the contrib directory you can get SHA1 support and use it directly with the DIGEST function like this:</p>

<pre><code>CREATE OR REPLACE FUNCTION secure_hash(bytea) RETURNS character varying (128) AS $$
BEGIN
  RETURN ENCODE(DIGEST($1, 'sha1'), 'hex');
END;
</code></pre>

<p>There are some good reasons to do it this way but sometimes you want options.  If you&rsquo;re in an environment where installing pgcrypto.so it out of the question you may have some luck trying to do it using PL/Perl.  The caveat here is that <a href="http://www.postgresql.org/docs/8.4/interactive/plperl-trusted.html">PL/Perl must run in trusted mode</a> for this to work and you must have the Digest::SHA package for Perl installed.  If you can meet those criteria here&rsquo;s how you get it running.</p>

<p>Step 1: Add <em>trusted</em> PL/Perl support to your database</p>

<pre><code>createlang plperlu database_name
</code></pre>

<p>Step 2: Create the PL/Perl function that returns the SHA1/SHA512 hash (replace &ldquo;sha512_base64&rdquo; with &ldquo;sha1_base64&rdquo; if you want SHA1 instead)</p>

<pre><code>CREATE FUNCTION secure_digest(bytea) RETURNS character varying(128) AS $$
  use Digest::SHA qw(sha512_base64);
  my $digest = sha512_base64($_[0]);
  return $digest;
$$ LANGUAGE plperlu;
</code></pre>

<p>Step 3: Test the function</p>

<pre><code>database_name=# select secure_digest('timmattison.com');
                                     secure_digest
----------------------------------------------------------------------------------------
 D5/O3RbUhj+1xWfIoikashEo92zCHwna69ffz+koxoQdUTxe2FP5rPmMKeUBU7FbmhQ0+WMKJbCeayhCwANGhA
(1 row)
</code></pre>

<p>That&rsquo;s it, you&rsquo;re ready to start hashing/digesting away.  Is this the most efficient way to do a hash?  No.  The first method is best.  Will it work in a pinch?  Yes.  Some DBAs will not let you install random shared objects on their machine but will install functions like this for you.  Hopefully you either don&rsquo;t have to deal with a DBA or your DBA is nice enough to do one of these solutions.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/archives/2009/10/24/how-to-fix-the-dreaded-setup-was-unable-to-create-a-new-system-partition-error-in-windows-7-advanced/">How-To: Fix the Dreaded &#8220;Setup Was Unable to Create a New System Partition&#8221; Error in Windows 7 (Advanced)</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-10-24T01:15:08-04:00" pubdate data-updated="true">Oct 24<span>th</span>, 2009</time>
        
           | <a href="/archives/2009/10/24/how-to-fix-the-dreaded-setup-was-unable-to-create-a-new-system-partition-error-in-windows-7-advanced/#disqus_thread"
             data-disqus-identifier="http://blog.timmattison.com/archives/2009/10/24/how-to-fix-the-dreaded-setup-was-unable-to-create-a-new-system-partition-error-in-windows-7-advanced/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><em>This article is very brief since it requires some Linux expertise, if you haven&rsquo;t done this before you should ask your neighborhood __Linux geek for help</em></p>

<p>When I first tried to install Windows 7 I ran into the problem that my LSI MegaRAID 150-4 was not supported out of the box.  I fixed that by downloading the driver from <a href="http://www.lsi.com/storage_home/products_home/internal_raid/megaraid_sata/megaraid_sata_300_4xlp/index.html?locale=EN&amp;remote=1">the LSI Logic driver download page for MegaRAID SATA controllers</a>.  I chose the &ldquo;Windows Server 2003 (64-bit)&#8221; version since I&rsquo;m installing 64-bit Windows 7. I put those files onto a flash drive, told Windows to load the driver, and it immediately it saw my disks.  The problem I was now left with was that after I partitioned and formatted them Windows would tell me that it was &#8220;unable to create a new system partition&rdquo; and refused to install.</p>

<p>I didn&rsquo;t find much on the Internet that was too helpful since most people&rsquo;s problems surround the fact that their drives aren&rsquo;t recognized. After poking around on the drive with Linux I found out what the problem was&hellip;</p>

<p><strong>The Windows 7 installer doesn&rsquo;t always set the bootable flag on partitions after they&rsquo;re formatted</strong></p>

<p>The fix?  Here&rsquo;s what I did (some Linux knowledge required)&hellip;</p>

<p>Step 1: Boot off of a bootable Linux CD</p>

<p>Step 2: Start a root shell</p>

<p>Step 3: Find out which drive you should be modifying by running</p>

<pre><code>dmesg | grep sd
</code></pre>

<p>One of the lines in there will say something like</p>

<pre><code>[sdb] ... 1.00 TB
</code></pre>

<p>Where &ldquo;sdb&rdquo; is your disk name and &ldquo;1.00 TB&rdquo; reflects about how big your RAID array is.  I just used my actual values as an example.</p>

<p>Step 4: Run fdisk on the drive</p>

<pre><code>fdisk /dev/sdb
</code></pre>

<p>Step 5: Press &ldquo;a&rdquo; and then enter to toggle the bootable flag</p>

<p>Step 6: Enter the number of the corresponding partition (usually partition 1) and then enter</p>

<p>Step 7: Press &ldquo;w&rdquo; and then enter to write the partition table to disk</p>

<p>Step 8: Reboot and rerun the Windows installation.  You&rsquo;ll see that on the right side of the partition list your parition should now be marked as &ldquo;System&rdquo;.  This means that it worked.  Select the partition, click next, and let the installer churn away&hellip;</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/archives/2009/10/20/how-to-set-up-iscsi-between-linux-and-mac-os-tested-on-10-6-1/">How-To: Set Up iSCSI Between Linux and Mac OS (Tested on 10.6.1)</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-10-20T09:12:51-04:00" pubdate data-updated="true">Oct 20<span>th</span>, 2009</time>
        
           | <a href="/archives/2009/10/20/how-to-set-up-iscsi-between-linux-and-mac-os-tested-on-10-6-1/#disqus_thread"
             data-disqus-identifier="http://blog.timmattison.com/archives/2009/10/20/how-to-set-up-iscsi-between-linux-and-mac-os-tested-on-10-6-1/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Last week I read LinuxJournal magazine and it talked about all of the cool things you could do with two Linux machines and the open source iSCSI code that&rsquo;s floating around out there.  I do have two Linux machines but I really wanted to see if I could get iSCSI working on my MacBook Pro and iMac so I could easily offload some files from their main drives to my larger file server.  I did it and here&rsquo;s how you can do it too.</p>

<p>The terminology that you&rsquo;ll need to know here is target (the server that has the disk where you&rsquo;re putting the data) and initiator (the machine that wants access to the target).  In my scenario my Dell Linux machine is the target and my Mac is the initiator.  You should also know that the iSCSI volumes I created were not raw drives.  I created a file filled with zeroes that the iSCSI software treats as a raw disk.</p>

<p>There are other ways to do this but this way is really cool because the underlying system can be any mix of systems you want (ext2/&frac34;, ZFS, LVM RAID, etc.).  Using LVM gives you redundancy without your client having to worry about it.</p>

<p><strong>Disclaimer:</strong> I use Gentoo so your steps may be different.</p>

<p>Step 1: Install iSCSI target software on Linux.  I used the <a href="http://iscsitarget.sourceforge.net/">iSCSI Enterprise target</a> package.</p>

<pre><code>emerge -av iscsitarget
</code></pre>

<p>Step 2: Create a directory on your Linux machine where you want to store your iSCSI disk images.  I used &ldquo;/srv&rdquo;</p>

<pre><code>sudo mkdir /srv
</code></pre>

<p>Step 3: Create a file that will contain your first iSCSI volume with dd.  Don&rsquo;t go crazy here yet.  Let&rsquo;s create two 1GB disks for testing and you can recreate larger ones later.</p>

<pre><code>sudo dd if=/dev/zero of=/srv/iscsi.disk.0 bs=1 seek=1024M count=1
sudo dd if=/dev/zero of=/srv/iscsi.disk.1 bs=1 seek=1024M count=1
</code></pre>

<p>Step 4: Edit the iSCSI configuration files.  My system was a bit different than the one in LinuxJournal.  I had to edit only the /etc/ietd.conf file.  Here is my entire configuration file:</p>

<pre><code>Target iqn.2009-09.org.mattison:iscsi-target
        IncomingUser test secretpasswd
        OutgoingUser test secretpasswd
        Lun 0 Path=/srv/iscsi.disk.0,Type=fileio
        Lun 1 Path=/srv/iscsi.disk.1,Type=fileio
        Alias Test
</code></pre>

<p>Keep in mind that to comply with the standards your password must be twelve characters.  Also, don&rsquo;t forget to change the target name from iqn.2009-09.org.mattison:iscsi-target to something that makes more sense to you.  Typically the 2009-09 is the year and month in which the filesystem went live, org.mattison is just your domain name in reverse, and iscsi-target is what you want to call this target.</p>

<p>Step 5: Start the iSCSI target.</p>

<pre><code>/etc/init.d/ietd restart
</code></pre>

<p>Step 6: Install an iSCSI initiator on your Mac and reboot (it is required by the installer).  I used <a href="http://www.studionetworksolutions.com/products/product_detail.php?t=more&amp;pi=11">GlobalSAN&rsquo;s iSCSI Initiator for Mac OS X</a></p>

<p>Step 7: After the reboot open the GlobalSAN system preferences panel.  Then click on &ldquo;Portals&rdquo;, click the plus sign, and then enter in the DNS name or IP address of your Linux server.  The default port should be fine unless you changed it on the Linux machine.</p>

<p>Click &ldquo;OK&rdquo;.</p>

<p>Step 8: Click the &ldquo;Targets&rdquo; tab and you should see your &ldquo;iscsi-target&rdquo; item listed there.  Click the &ldquo;Connected&rdquo; checkbox.  Then, check the &ldquo;Use CHAP Login Information&rdquo; box, fill in the user name, target secret, and initiator secret fields. In my example the username was &ldquo;test&rdquo; and the passwords were both &ldquo;secretpasswd&rdquo;.  If you changed them then use your values here. The &ldquo;IncomingUser&rdquo; password is what GlobalSAN refers to as the &ldquo;Target Secret&rdquo;, the &ldquo;OutgoingUser&rdquo; password is what GlobalSAN refers to as the &ldquo;Initiator Secret&rdquo;.</p>

<p>Step 9: Now partition and use the disks just like any other disk.  They&rsquo;ll show up as iSCSI &ldquo;IET VIRTUAL-DISK Media&rdquo; in Apple&rsquo;s Disk Utility.</p>

<p>From here you can do all kinds of crazy things.  You can even set up a RAID, run iDefrag on them, use them for Time Machine, etc.  Of course a RAID over iSCSI in this setup will yield very low performance so it&rsquo;s not recommended for production, just for fun.  Defragging an iSCSI volume is also not worth it especially since the file that contains the whole filesystem on the Linux machine is most likely where the fragmentation is occurring.  Again, these two examples are just to show you that Mac OS really does treat these devices as a low-level block device.  Time Machine may not be such a bad idea actually&hellip;</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/archives/2009/10/15/how-to-clear-out-tomcats-cache-and-fix-outdated-jsp-problems/">How-To: Clear Out Tomcat&#8217;s Cache and Fix Outdated JSP Problems</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-10-15T14:38:40-04:00" pubdate data-updated="true">Oct 15<span>th</span>, 2009</time>
        
           | <a href="/archives/2009/10/15/how-to-clear-out-tomcats-cache-and-fix-outdated-jsp-problems/#disqus_thread"
             data-disqus-identifier="http://blog.timmattison.com/archives/2009/10/15/how-to-clear-out-tomcats-cache-and-fix-outdated-jsp-problems/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I was updating a web application last night and after uploading the WAR file to my server, moving it into the servlet container&rsquo;s (Tomcat&rsquo;s) webapps directory, and restarting it I still got an old copy of a JSP showing up.  This was a particularly bad problem because I had refactored some classes and now even the old, previously valid JSP would fail to run since the imports were now invalid.  I went so far as removing the webapps directory entirely and still couldn&rsquo;t get it to work.  I came back the next day and all was fixed.  I was safe, I thought&hellip;</p>

<p>The problem is this: My desktop&rsquo;s clock was correct and my server&rsquo;s clock was behind by a few minutes.  Tomcat keeps a cached copy of your JSPs in its &ldquo;work&rdquo; folder and only clears them out when it sees that the code in &ldquo;webapps&rdquo; is newer than the code in &ldquo;work&rdquo;.  The exception to that rule is when the code in &ldquo;webapps&rdquo; has a date in the future.  When that happens it doesn&rsquo;t update the code until that date passes.  This could be useful in some instances but for me it was a real problem.</p>

<p>My workaround is pedantic but that&rsquo;s my style.  This assumes your Tomcat works in the /var/lib/tomcat-6 directory.  If not, change that path accordingly.  We&rsquo;ll also assume that your web application is called &ldquo;app-with-jsps.war&rdquo;.  Change that, too, if you need to.  Here&rsquo;s what I do:</p>

<p>Step 1: Remove the WAR file from the webapps directory</p>

<pre><code>rm -rf /var/lib/tomcat-6/webapps/app-with-jsps*
</code></pre>

<p>Step 2: Remove the application&rsquo;s work directory.  The two stars in that command-line traverses the Catalina/localhost path on my machine but on your machine the names could be different.  This makes sure it gets the files and, since it has no trailing wildcards, it pretty safe since it can only delete a directory called &ldquo;app-with-jsps&rdquo;.</p>

<pre><code>rm -rf /var/lib/tomcat-6/work/*/*/app-with-jsps
</code></pre>

<p>Step 3: Copy your WAR file to the webapps directory</p>

<pre><code>cp app-with-jsps.war /var/lib/tomcat-6/webapps
</code></pre>

<p>Step 4: Restart the servlet container</p>

<pre><code>/etc/init.d/tomcat-6 restart
</code></pre>

<p>That should fix your cache problems.  A better long term solution is to sync your clocks but these steps come in handy when that&rsquo;s either difficult to do or completely out of your control.  Enjoy!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/archives/2009/10/15/update-nicer-formatting-for-cisco-twitter-timelines-and-direct-message-support/">Update: Nicer Formatting for Cisco Twitter Timelines and Direct Message Support</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-10-15T10:38:07-04:00" pubdate data-updated="true">Oct 15<span>th</span>, 2009</time>
        
           | <a href="/archives/2009/10/15/update-nicer-formatting-for-cisco-twitter-timelines-and-direct-message-support/#disqus_thread"
             data-disqus-identifier="http://blog.timmattison.com/archives/2009/10/15/update-nicer-formatting-for-cisco-twitter-timelines-and-direct-message-support/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>A <a href="https://twitter.com/nikonshooter62">savvy guy in Germany</a> gave me some pointers on what could be improved in my previous post <a href="http://blog.timmattison.com/blog/archives/2009/03/07/how-to-get-a-twitter-timeline-on-a-cisco-7960-updated-2009-03-10/">How-To: Get a Twitter timeline on a Cisco 7960</a>.  Rather than updating that one again and having it get lost I&rsquo;ll put the newest stuff in new posts as they come up.</p>

<p>First, rather than getting your friends timeline he suggested, and modified the script, to only pull the direct messages.  The change is straightforward and you can simply replace</p>

<pre><code>$timeline = $twit-&gt;friends_timeline();
</code></pre>

<p>with</p>

<pre><code>$timeline = $twit-&gt;direct_messages();
</code></pre>

<p>Second, the message formatting that comes from the API <a href="http://twitpic.com/llrfq">leaves a little bit to be desired</a>.  Therefore the two suggestions were to remove the &ldquo;+0000&rdquo; and move the year so it&rsquo;s between the date and time.  This change is a bit more tricky but can be done with regular expressions.  For the first I did this</p>

<pre><code>$input =~ s/ \+0000//g;
</code></pre>

<p>and for the second I did this</p>

<pre><code>$input =~ s/^([^ ]*) *([^ ]*) *([^ ]*) *([^ ]*) *([^ ]*) *([^ ]*) *([^ ]*):/$1 $2 $3 $4 $5 $7 $6:/;
</code></pre>

<p>Put whichever of these you&rsquo;d like (or both) right before</p>

<pre><code>return $input
</code></pre>

<p>in the fix_cisco_issues subroutine.  Make sure you copy them</p>

<p>exactly or they can break the script.</p>

<p>If you run into any trouble (ie. blank Cisco screen after doing the updates), run the script on the command-line and see if there are any errors showing up on STDERR. Usually, it&rsquo;s just a typo so pay attention to the error output and patch it up!</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/page/12/">&larr; Older</a>
    
    <a href="/archives">Archives</a>
    
    <a class="next" href="/page/10/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
	<h1>Like this site/article?  Donate with Bitcoin!</h1>
	<a href="bitcoin:1PcYJnuZPZFWUMUHzzBGHHshEbrVzYpY9Y"><img src="http://blockchain.info/qr?data=1PcYJnuZPZFWUMUHzzBGHHshEbrVzYpY9Y&size=200" alt="Bitcoin"></a>
	<a href="bitcoin:1PcYJnuZPZFWUMUHzzBGHHshEbrVzYpY9Y">1PcYJnuZPZFWUMUHzzBGHHshEbrVzYpY9Y</a>
</section>
<section>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Sidebar -->
<ins class="adsbygoogle"
     style="display:inline-block;width:120px;height:240px"
     data-ad-client="ca-pub-9307090849713032"
     data-ad-slot="1616086903"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/archives/2014/09/17/hacking-together-a-super-simple-webserver-with-netcat-on-a-raspberry-pi/">Hacking Together a Super Simple Webserver With Netcat on a Raspberry Pi</a>
      </li>
    
      <li class="post">
        <a href="/archives/2014/09/04/rid-yourself-of-smart-quotes-smart-dashes-and-automatic-spelling-correction-on-mac-os/">Rid Yourself of Smart Quotes, Smart Dashes, and Automatic Spelling Correction on Mac OS</a>
      </li>
    
      <li class="post">
        <a href="/archives/2014/09/04/using-ssh-agent-to-simplify-connecting-to-ec2/">Using SSH Agent to Simplify Connecting to EC2</a>
      </li>
    
      <li class="post">
        <a href="/archives/2014/09/02/full-example-code-showing-how-to-use-guice-and-jetty/">Full Example Code Showing How to Use Guice and Jetty</a>
      </li>
    
      <li class="post">
        <a href="/archives/2014/09/02/using-amazon-sts-credentials-inside-of-a-properties-file/">Using Amazon STS Credentials Inside of a Properties File</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/timmattison">@timmattison</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'timmattison',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>



<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/timmattison?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Tim Mattison -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'timmattison';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
