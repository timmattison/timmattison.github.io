
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Mini-hack: last.fm Music on Hold for FreeSWITCH - My Octopress Blog</title>
  <meta name="author" content="Your Name">

  
  <meta name="description" content="I started using FreeSWITCH quite a while back but only recently got into rebuilding my home PBX with it. One of the things that always bothered me &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://timmattison.github.io/archives/2009/02/24/mini-hack-last-fm-music-on-hold-for-freeswitch">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="My Octopress Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">My Octopress Blog</a></h1>
  
    <h2>A blogging framework for hackers.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:timmattison.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Mini-hack: last.fm Music on Hold for FreeSWITCH</h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-02-24T09:45:36-05:00" pubdate data-updated="true">Feb 24<span>th</span>, 2009</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>I started using FreeSWITCH quite a while back but only recently got into rebuilding my home PBX with it.  One of the things that always bothered me aboutÂ Asterisk, which may or may not have changed since the last time I looked, was that it wasn&rsquo;t straight-forward to get streaming MOH (music on hold) working.</p>

<p>Sure, I eventually got it to work but it wasn&rsquo;t fun and not really all that reliable.</p>

<p>Just this morning I decided to try to get some real variety in my MOH and came up with a quick hack that surprisingly only involves a few basic elements:</p>

<p>Step 1: Download Vidar Madsen&rsquo;s <a href="http://vidar.gimp.org/?page_id=50">LastFMProxy python application</a> onto your <a href="http://freeswitch.org">FreeSWITCH</a> server</p>

<p>Step 2: Update config.py with your username and password for last.fm</p>

<p>Step 3: Run <a href="http://www.gnu.org/software/screen/">screen</a>, start last.fm proxy&rsquo;s main.py, and then detach and leave it running in the background</p>

<p>Step 4: Find the hold_music variable and update it to look like this:</p>

<p>&lt;X-PRE-PROCESS cmd=&ldquo;set&rdquo; data=&ldquo;hold_music=shout://localhost:1881/lastfm.mp3&rdquo;/></p>

<p>Step 5: Point your browser (on the server directly or using X-forwarding over SSH) to one of the example links from the LastFMProxy README:</p>

<p><a href="http://localhost:1881/lastfm://globaltags/rock">http://localhost:1881/lastfm://globaltags/rock</a></p>

<p><a href="http://localhost:1881/lastfm://artist/Madonna/similarartists">http://localhost:1881/lastfm://artist/Madonna/similarartists</a></p>

<p><a href="http://localhost:1881/lastfm://user/vidarino/neighbours">http://localhost:1881/lastfm://user/vidarino/neighbours</a></p>

<p>Or you can build your own.  The format is somewhat obvious so I&rsquo;ll leave that as an exercise for the reader.</p>

<p>6: Restart FreeSWITCH when convenient and enjoy your new music on hold.  Disclaimer: I only use this internally for testing, not production.  I don&rsquo;t claim to know or understand the licensing issues here so proceed at your own risk.</p>

<p>One really nice thing about this hack is that you can change your music selection on-the-fly, programmatically.  If you hit one of the URLs from step 5 with wget or LWP then FreeSWITCH will seamlessly switch to the new music after the current track has finished.  You won&rsquo;t be jarred into the new music selection with an instant track change.  This is what I usually go for:</p>

<p>wget -O /dev/null <a href="http://localhost:1881/lastfm://artist/KMFDM/similarartists">http://localhost:1881/lastfm://artist/KMFDM/similarartists</a></p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">admin</span></span>

      








  


<time datetime="2009-02-24T09:45:36-05:00" pubdate data-updated="true">Feb 24<span>th</span>, 2009</time>
      

<span class="categories">
  
    <a class='category' href='/categories/mini-hacks/'>Mini Hacks</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://timmattison.github.io/archives/2009/02/24/mini-hack-last-fm-music-on-hold-for-freeswitch/" data-via="" data-counturl="http://timmattison.github.io/archives/2009/02/24/mini-hack-last-fm-music-on-hold-for-freeswitch/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
      
        <a class="basic-alignment right" href="/archives/2009/02/28/testing-out-disqus-for-comments/" title="Next Post: Testing out Disqus for comments">Testing out Disqus for comments &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/archives/2012/05/25/coming-soon-how-to-easily-enable-poe-power-over-ethernet-in-your-homebrew-projects/">Coming Soon: How to Easily Enable PoE (Power Over Ethernet) in Your Homebrew Projects</a>
      </li>
    
      <li class="post">
        <a href="/archives/2012/05/04/how-to-fix-vmware-kernel-module-compile-issues-with-vmware-workstation-8-0-3-and-linux-kernel-3-2-0/">How-To: Fix VMware Kernel Module Compile Issues With VMware Workstation 8.0.3 and Linux Kernel 3.2.0</a>
      </li>
    
      <li class="post">
        <a href="/archives/2012/04/19/tips-for-debugging-springs-transactional-annotation/">Tips for Debugging Spring's @Transactional Annotation</a>
      </li>
    
      <li class="post">
        <a href="/archives/2012/04/17/how-to-get-verizons-media-manager-to-read-content-from-a-network-location/">How-To: Get Verizon's Media Manager to Read Content From a Network Location</a>
      </li>
    
      <li class="post">
        <a href="/archives/2012/04/12/tip-fix-xterm-unknown-terminal-type-messages-in-debian/">Tip: Fix "'Xterm': Unknown Terminal Type" Messages in Debian</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Your Name -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
