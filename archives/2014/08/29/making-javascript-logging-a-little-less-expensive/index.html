
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Making Javascript Logging a Little Less Expensive - Tim Mattison</title>
  <meta name="author" content="Tim Mattison">

  
  <meta name="description" content="Disclaimer: I am not a Javascript expert. I don&rsquo;t even play one on TV. Everybody knows that logging isn&rsquo;t free, don&rsquo;t they? Well I &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://blog.timmattison.com/archives/2014/08/29/making-javascript-logging-a-little-less-expensive">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Tim Mattison" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-46746763-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Tim Mattison</a></h1>
  
    <h2>Hardcore tech</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:blog.timmattison.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Making Javascript Logging a Little Less Expensive</h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-08-29T07:54:45-04:00" pubdate data-updated="true">Aug 29<span>th</span>, 2014</time>
        
           | <a href="#disqus_thread"
             data-disqus-identifier="http://blog.timmattison.com">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>Disclaimer: I am not a Javascript expert.  I don&rsquo;t even play one on TV.</p>

<p>Everybody knows that <a href="http://blog.codinghorror.com/the-problem-with-logging/">logging isn&rsquo;t free</a>, don&rsquo;t they?  Well I don&rsquo;t think that they do and for a lot of beginner to intermediate level developers I can&rsquo;t really fault them for it.  While you&rsquo;re debugging it appears that log messages show up instantly so it is easy to forget that there is in fact a cost associated with producing them.</p>

<p>What is less obvious is that even when you &ldquo;disable&rdquo; your logging it still incurs a cost and that cost may be significantly larger than you think.  The two main issues I&rsquo;ve seen that often cause this large expense are:</p>

<ol>
<li>Methods that generate log messages</li>
<li>Inline generation of strings</li>
</ol>


<p>The first, methods that generate log messages, occurs when you need to do a bit of processing in order to make a meaningful log message.  For example, you might need to know how far you are through a loop so you write a function called <code>generateFormattedProgress</code> that takes the number of loops you&rsquo;re going to go through and the current loop counter as parameters.  <code>generateFormattedProgress</code> generates a tidy little string that might loop like this <code>[8% complete (currently on iteration 80,001 of 1,000,000)]</code>.</p>

<p>The second, inline generation of strings, happens when you need to do something a bit simpler like displaying a loop counter.  You might build a string like this <code>"Loop: " + loop_counter</code> and then log it.</p>

<p>In both of these cases you get bitten by the less obvious issue I mentioned above when you disable logging.  To be completely concrete about this imagine your logger is called like this:</p>

<p>Case #1:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>console.log(generateFormattedProgress(loop_counter, total_loops));</span></code></pre></td></tr></table></div></figure>


<p>Case #2:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>console.log("Loop:" + loop_counter);</span></code></pre></td></tr></table></div></figure>


<p>Even if you replace <code>console.log</code> with a function that just immediately returns you will, in most cases, still be forcing the machine to call <code>generateFormattedProgress</code> and perform the string concatenation only to throw the results away.  This is where the overhead comes in.</p>

<p>Borrowing from some other languages I came up with an idea to reduce this burden.  Unfortunately it is a bit ugly but it does give you a decent performance boost.  The idea is that instead of always calling the logging code at runtime you wrap your logging statements in anonymous functions and pass those to the logger.  The logger can then decide if it needs to run them and if it doesn&rsquo;t then it never calls the code inside of the anonymous function.</p>

<p>Your log statements go from looking like the statements above to statements like this:</p>

<p>Case #1:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>console.log(function(){ return generateFormattedProgress(loop_counter, total_loops);});</span></code></pre></td></tr></table></div></figure>


<p>Case #2:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>console.log(function(){ return "Loop:" + loop_counter; });</span></code></pre></td></tr></table></div></figure>


<p>Some test code is below to illustrate the difference in performance.  On my machine running 100,000 iterations I get the following results in Chrome 37.0.2062.94:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Console.log enabled
</span><span class='line'>Running: test_normal_console
</span><span class='line'>Total milliseconds: 1921
</span><span class='line'>Milliseconds per log: 0.01921
</span><span class='line'>Running: test_anonymous_function_console
</span><span class='line'>Total milliseconds: 1917
</span><span class='line'>Milliseconds per log: 0.01917
</span><span class='line'>Disabling console.log
</span><span class='line'>Running: test_normal_console
</span><span class='line'>Total milliseconds: 16
</span><span class='line'>Milliseconds per log: 0.00016
</span><span class='line'>Running: test_anonymous_function_console
</span><span class='line'>Total milliseconds: 5
</span><span class='line'>Milliseconds per log: 0.00005</span></code></pre></td></tr></table></div></figure>


<p>So here we see that we cut the runtime by at least two orders of magnitude going from a little over 1.9 seconds for each case to less than 20 milliseconds for each case.  Does logging affect your Javascript application enough to use this pattern?  Is this an anti-pattern?  Are you already doing this or something similar?  Post a message in the comments and lets discuss it!</p>

<p>Sample test code:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>var test_count = 100000;
</span><span class='line'>
</span><span class='line'>function get_timestamp() {
</span><span class='line'>    return new Date().getTime();
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>function write_newline() {
</span><span class='line'>    document.write("&lt;br/&gt;\n");
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>function display_function_name(caller) {
</span><span class='line'>    var myName = caller.callee.toString();
</span><span class='line'>    myName = myName.substr('function '.length);
</span><span class='line'>    myName = myName.substr(0, myName.indexOf('('));
</span><span class='line'>
</span><span class='line'>    document.write("Running: " + myName);
</span><span class='line'>    write_newline();
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>function show_results(start, stop, count) {
</span><span class='line'>    var totalMilliseconds = stop - start;
</span><span class='line'>    var millisecondsPerLog = totalMilliseconds / test_count;
</span><span class='line'>
</span><span class='line'>    document.write("Total milliseconds: " + totalMilliseconds);
</span><span class='line'>    write_newline();
</span><span class='line'>    document.write("Milliseconds per log: " + millisecondsPerLog);
</span><span class='line'>    write_newline();
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>function test_normal_console() {
</span><span class='line'>    display_function_name(arguments);
</span><span class='line'>
</span><span class='line'>    var start = get_timestamp();
</span><span class='line'>
</span><span class='line'>    for (var loop = 0; loop &lt; test_count; loop++) {
</span><span class='line'>        console.log("test! " + loop + "test!");
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    var stop = get_timestamp();
</span><span class='line'>
</span><span class='line'>    show_results(start, stop, test_count);
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>function test_anonymous_function_console() {
</span><span class='line'>    display_function_name(arguments);
</span><span class='line'>
</span><span class='line'>    var start = get_timestamp();
</span><span class='line'>
</span><span class='line'>    for (var loop = 0; loop &lt; test_count; loop++) {
</span><span class='line'>        console.log(function () {
</span><span class='line'>            return "test! " + loop + "test!";
</span><span class='line'>        });
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    var stop = get_timestamp();
</span><span class='line'>
</span><span class='line'>    show_results(start, stop, test_count);
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>// Store the original console.log function
</span><span class='line'>var original_console_log = console.log;
</span><span class='line'>
</span><span class='line'>// Call this to enable logging
</span><span class='line'>function enable_console_logging() {
</span><span class='line'>    console.log = function (input) {
</span><span class='line'>        // Why the bind(console)(input)?
</span><span class='line'>        //
</span><span class='line'>        // console.log expects "this" to refer to the console object or it crashes with an invocation exception
</span><span class='line'>        //   See: https://stackoverflow.com/questions/8904782/uncaught-typeerror-illegal-invocation-in-javascript
</span><span class='line'>
</span><span class='line'>        // Is this a function?
</span><span class='line'>        if (typeof input == "function") {
</span><span class='line'>            // Yes, call the function to get the data to log to the console
</span><span class='line'>            original_console_log.bind(console)(input());
</span><span class='line'>        }
</span><span class='line'>        else {
</span><span class='line'>            // No, just log it
</span><span class='line'>            original_console_log.bind(console)(input);
</span><span class='line'>        }
</span><span class='line'>    }
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>// Call this to disable logging
</span><span class='line'>function disable_console_logging() {
</span><span class='line'>    console.log = function () {
</span><span class='line'>    };
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>document.write("Console.log enabled");
</span><span class='line'>write_newline();
</span><span class='line'>
</span><span class='line'>enable_console_logging();
</span><span class='line'>
</span><span class='line'>test_normal_console();
</span><span class='line'>test_anonymous_function_console();
</span><span class='line'>
</span><span class='line'>document.write("Disabling console.log");
</span><span class='line'>write_newline();
</span><span class='line'>
</span><span class='line'>disable_console_logging();
</span><span class='line'>
</span><span class='line'>test_normal_console();
</span><span class='line'>test_anonymous_function_console();</span></code></pre></td></tr></table></div></figure>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Tim Mattison</span></span>

      








  


<time datetime="2014-08-29T07:54:45-04:00" pubdate data-updated="true">Aug 29<span>th</span>, 2014</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://blog.timmattison.com/archives/2014/08/29/making-javascript-logging-a-little-less-expensive/" data-via="timmattison" data-counturl="http://blog.timmattison.com/archives/2014/08/29/making-javascript-logging-a-little-less-expensive/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/archives/2014/08/05/using-guice-dependency-injection-with-quartz-schedulding/" title="Previous Post: Using Guice dependency injection with Quartz schedulding">&laquo; Using Guice dependency injection with Quartz schedulding</a>
      
      
        <a class="basic-alignment right" href="/archives/2014/08/29/deal-with-os-linux-zero-dot-cpp-related-jvm-crashes-without-using-the-oracle-jvm/" title="Next Post: Deal with os_linux_zero.cpp related JVM crashes without using the Oracle JVM">Deal with os_linux_zero.cpp related JVM crashes without using the Oracle JVM &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
	<h1>Like this site/article?  Donate with Bitcoin!</h1>
	<a href="bitcoin:1PcYJnuZPZFWUMUHzzBGHHshEbrVzYpY9Y"><img src="http://blockchain.info/qr?data=1PcYJnuZPZFWUMUHzzBGHHshEbrVzYpY9Y&size=200" alt="Bitcoin"></a>
	<a href="bitcoin:1PcYJnuZPZFWUMUHzzBGHHshEbrVzYpY9Y">1PcYJnuZPZFWUMUHzzBGHHshEbrVzYpY9Y</a>
</section>
<section>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Sidebar -->
<ins class="adsbygoogle"
     style="display:inline-block;width:120px;height:240px"
     data-ad-client="ca-pub-9307090849713032"
     data-ad-slot="1616086903"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/archives/2014/09/02/checking-postgresql-to-see-if-a-constraint-already-exists/">Checking PostgreSQL to See if a Constraint Already Exists</a>
      </li>
    
      <li class="post">
        <a href="/archives/2014/08/29/deal-with-os-linux-zero-dot-cpp-related-jvm-crashes-without-using-the-oracle-jvm/">Deal With os_linux_zero.cpp Related JVM Crashes Without Using the Oracle JVM</a>
      </li>
    
      <li class="post">
        <a href="/archives/2014/08/29/making-javascript-logging-a-little-less-expensive/">Making Javascript Logging a Little Less Expensive</a>
      </li>
    
      <li class="post">
        <a href="/archives/2014/08/05/using-guice-dependency-injection-with-quartz-schedulding/">Using Guice Dependency Injection With Quartz Schedulding</a>
      </li>
    
      <li class="post">
        <a href="/archives/2014/07/17/fenced-code-blocks-in-ordered-lists-in-octopress/">Fenced Code Blocks in Ordered Lists in Octopress</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/timmattison">@timmattison</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'timmattison',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>



<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/timmattison?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Tim Mattison -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'timmattison';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://blog.timmattison.com/archives/2014/08/29/making-javascript-logging-a-little-less-expensive/';
        var disqus_url = 'http://blog.timmattison.com/archives/2014/08/29/making-javascript-logging-a-little-less-expensive/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
